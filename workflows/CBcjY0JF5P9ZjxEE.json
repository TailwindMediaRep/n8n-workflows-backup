{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-02-04T15:14:52.000Z",
    "createdAt": "2026-02-04T15:14:51.305Z",
    "versionId": "57d925b8-b8c9-4a86-ad37-7f0f50606019",
    "workflowId": "CBcjY0JF5P9ZjxEE",
    "nodes": [
      {
        "parameters": {
          "httpRequestMethod": "POST",
          "graphApiVersion": "v23.0",
          "node": "17841470046184468",
          "edge": "media_publish",
          "options": {
            "queryParametersJson": "={\n  \"creation_id\": \"{{$json.id}}\"\n}"
          }
        },
        "type": "n8n-nodes-base.facebookGraphApi",
        "typeVersion": 1,
        "position": [
          368,
          464
        ],
        "id": "70f5be56-bcbd-45e8-b707-d1fe8cd7941a",
        "name": "Facebook Graph API1",
        "credentials": {
          "facebookGraphApi": {
            "id": "F7VbX8jWKCXdAM47",
            "name": "Facebook Graph account"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "url": "=https://graph.facebook.com/v20.0/{{ $json.id }}?fields=status,status_code",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "facebookGraphApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_token",
                "value": "EAF2z8nVLTA8BQVHL88vghg4RRZBH9svUgZCP93NSZAB9iSDKxTAMvz8DFby8KVqXp6DWFxfFDiSKOUXvXPVVrJcNxjFOmr0ZCXphOZBUUWRkP8sTZC9wwapmP8vlJQN4NHH2eW9zPRmg2SHrQ0AhjI3n2kx1vAa8nOtr6tbQMhcaP0X0eMtOComwFl3zR7zd7HowZDZD"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -112,
          480
        ],
        "id": "edf4ba47-a8ca-4343-8394-708f1e0f7712",
        "name": "HTTP Request3",
        "credentials": {
          "facebookGraphApi": {
            "id": "F7VbX8jWKCXdAM47",
            "name": "Facebook Graph account"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          48,
          480
        ],
        "id": "5579777d-f732-4b98-b233-233d14c7baeb",
        "name": "Wait2",
        "webhookId": "4e9e9bda-286b-4bd6-b112-9133762c2724"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "49c65dc4-2ebe-451b-9788-cd0999f268f1",
                "leftValue": "={{ $json.status_code }}",
                "rightValue": "FINISHED",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          208,
          480
        ],
        "id": "f2e57470-8cb6-4aff-a4f1-776c6d413c60",
        "name": "If1"
      },
      {
        "parameters": {
          "httpRequestMethod": "POST",
          "graphApiVersion": "v23.0",
          "node": "17841470046184468",
          "edge": "=media",
          "options": {
            "queryParametersJson": "={\n\"video_url\": \"{{ $('Webhook').item.json.query.idHistoria }}\",\n\"media_type\": \"STORIES\",\n\"is_story\": true\n}"
          }
        },
        "type": "n8n-nodes-base.facebookGraphApi",
        "typeVersion": 1,
        "position": [
          -448,
          480
        ],
        "id": "0bbfbe8d-31e9-41c6-8d53-89988526abf1",
        "name": "Facebook Graph API2",
        "credentials": {
          "facebookGraphApi": {
            "id": "F7VbX8jWKCXdAM47",
            "name": "Facebook Graph account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4fa17a3a-35cc-4f82-988a-32b82b6223e9",
                "name": "story_url",
                "value": "=https://res.cloudinary.com/dglub1vnw/video/upload/vc_h264,ac_aac,c_pad,w_1080,h_1920,b_blurred:400,du_30/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_black,e_outline:3/fl_layer_apply,g_north_west,x_10,y_670/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_white/fl_layer_apply,g_north_west,x_13,y_673/{{ $json.public_id }}.mp4",
                "type": "string"
              },
              {
                "id": "281cd629-07ec-4b26-bcb4-085d1a77c5f8",
                "name": "vista_previa",
                "value": "=https://res.cloudinary.com/dglub1vnw/video/upload/c_pad,w_1080,h_1920,b_black/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_black,e_outline:3/fl_layer_apply,g_north_west,x_10,y_670/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_white/fl_layer_apply,g_north_west,x_13,y_673/{{ $json.public_id }}.jpg",
                "type": "string"
              },
              {
                "id": "4dc0a51e-ecfb-43bb-9ea2-33faf1ebebda",
                "name": "=token único",
                "value": "={{ $now.toFormat('yyyyMMddHHmmss') + Math.floor(Math.random()*1000) }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          224,
          160
        ],
        "id": "8ec922b4-00bc-43fc-8fb3-48a2e73f92d2",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "uploadFile",
          "resource_type_file": "video",
          "additionalFieldsFile": {}
        },
        "type": "n8n-nodes-cloudinary.cloudinary",
        "typeVersion": 1,
        "position": [
          64,
          160
        ],
        "id": "4c85ba67-fb60-4a26-8c67-4a5bf0283b78",
        "name": "Upload an asset from file data",
        "credentials": {
          "cloudinaryApi": {
            "id": "YTnswF3cVMD8a6jX",
            "name": "Cuenta Cloudinary"
          }
        }
      },
      {
        "parameters": {
          "method": "HEAD",
          "url": "={{ $json.story_url }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "neverError": true,
                "responseFormat": "json"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          432,
          160
        ],
        "id": "4fecbe0c-ed05-4db3-aa2c-8e9977ab31c2",
        "name": "HTTP Request1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "23ffd565-77db-41aa-846e-6e4f54f021a7",
                "leftValue": "={{ $json.statusCode }}",
                "rightValue": 200,
                "operator": {
                  "type": "number",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          592,
          160
        ],
        "id": "4e3544c3-0642-49ef-82b2-ecd3367c560b",
        "name": "If"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          752,
          256
        ],
        "id": "cdd381ff-6ac2-45ba-9e2a-43a650f57753",
        "name": "Wait",
        "webhookId": "2ddadd9e-f14b-4c72-b341-f3ef721110ea"
      },
      {
        "parameters": {
          "url": "https://sierranevada.es/es/invierno/la-estacion/en-directo/webcams/",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -992,
          160
        ],
        "id": "2aaa757a-e4c6-4d1a-afa7-70d04f751c29",
        "name": "request_página_principal"
      },
      {
        "parameters": {
          "jsCode": "// 1. Obtenemos el HTML gigante\nconst html = items[0].json.data;\n\n// 2. Buscamos el script que tiene todos los datos de la página (Next.js data)\nconst regex = /<script id=\"__NEXT_DATA__\" type=\"application\\/json\">(.*?)<\\/script>/;\nconst match = html.match(regex);\n\nlet resultados = [];\n\nif (match && match[1]) {\n  // 3. Parseamos el texto a JSON real\n  const data = JSON.parse(match[1]);\n\n  // 4. Navegamos por la estructura compleja de Sierra Nevada para encontrar las webcams\n  // La ruta suele ser: props -> pageProps -> model -> MenuPrincipalCustom... o buscando bloques\n  // Para hacerlo fácil, vamos a buscar recursivamente cualquier objeto que parezca una webcam de Feratel\n  \n  // Convertimos todo el objeto a string para buscar patrones de feratel (truco rápido)\n  const jsonString = JSON.stringify(data);\n  \n  // Buscamos patrones de IDs de cámara (ej: cam=15111)\n  const camRegex = /cam=(\\d+)/g;\n  let camMatch;\n  const uniqueCams = new Set();\n\n  while ((camMatch = camRegex.exec(jsonString)) !== null) {\n    uniqueCams.add(camMatch[1]);\n  }\n\n  // Creamos el resultado\n  uniqueCams.forEach(id => {\n    resultados.push({\n      json: {\n        camera_id: id,\n        iframe_url: `https://webtv.feratel.com/webtv/?design=v5&cam=${id}`,\n        video_directo_mp4: `https://sts063.feratel.co.at/streams/stsstore055/1/${id}_vid.mp4` // URL estimada basada en tu ejemplo\n      }\n    });\n  });\n}\n\nreturn resultados;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -816,
          160
        ],
        "id": "182ae0c9-e916-4427-aec4-7a10a39e4a2c",
        "name": "extraer_url"
      },
      {
        "parameters": {
          "url": "={{ $json.iframe_url }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
              },
              {
                "name": "Referer",
                "value": "https://sierranevada.es/"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -640,
          160
        ],
        "id": "c8780df9-a109-4cee-b438-bbab9e0fdd02",
        "name": "request_página_cámaras"
      },
      {
        "parameters": {
          "jsCode": "// Obtenemos la fecha actual\nconst now = new Date();\nlet masCercano = null;\nlet menorDiferencia = Infinity; \n\nfor (const item of items) {\n  // Asegúrate de que item.json existe por seguridad\n  if (!item.json) continue;\n\n  const url = item.json.video_url;\n  \n  // --- BLOQUE DE SEGURIDAD NUEVO ---\n  // Si no hay url, o no es un texto, saltamos al siguiente item del bucle\n  if (!url || typeof url !== 'string') {\n    continue; \n  }\n  // ---------------------------------\n\n  // Ahora es seguro usar .match()\n  const match = url.match(/_([0-9a-fA-F]{8})[-_a-zA-Z]/);\n\n  if (match && match[1]) {\n    const hexTimestamp = match[1];\n    const unixSeconds = parseInt(hexTimestamp, 16);\n    \n    const videoDate = new Date(unixSeconds * 1000);\n    const diff = now - videoDate;\n\n    if (diff >= 0 && diff < menorDiferencia) {\n      menorDiferencia = diff;\n      masCercano = item;\n      masCercano.json.fecha_decodificada = videoDate.toISOString();\n      masCercano.json.segundos_atras = diff / 1000;\n    }\n  }\n}\n\nreturn masCercano ? [masCercano] : [];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -320,
          160
        ],
        "id": "f57b7f7e-dbe8-413c-a885-a19c5054e907",
        "name": "filtrar_url_reciente"
      },
      {
        "parameters": {
          "url": "={{ $json.video_url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -160,
          160
        ],
        "id": "777d5a4a-20a7-412f-bc9f-683c3b198f68",
        "name": "solicitud_url_reciente"
      },
      {
        "parameters": {
          "operation": "extractHtmlContent",
          "extractionValues": {
            "values": [
              {
                "key": "video_url",
                "cssSelector": "div#videoframe video source",
                "returnValue": "attribute",
                "attribute": "src"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          -480,
          160
        ],
        "id": "341861a2-cb91-4338-a739-df0b98b10862",
        "name": "extraer_url2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4fa17a3a-35cc-4f82-988a-32b82b6223e9",
                "name": "story_url",
                "value": "={{ $('Edit Fields').item.json.story_url }}",
                "type": "string"
              },
              {
                "id": "e218b35b-bee8-4b32-8bb5-70c1a571d9db",
                "name": "vista_previa",
                "value": "={{ $('Edit Fields').item.json.vista_previa }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          880,
          256
        ],
        "id": "e575ea56-dfa1-45c0-859f-96bb45cd6518",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "content": "OBTENER VÍDEO DE LA CÁMARA",
          "height": 288,
          "width": 1056,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1056,
          64
        ],
        "id": "6acdd7c5-d32a-4c6e-aca2-3acbb08403ea",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "SUBIR VÍDEO Y GENERAR URL",
          "height": 288,
          "width": 336,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          16,
          64
        ],
        "id": "c06ee7e0-d0ad-4922-9665-6e79c6076bc9",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "COMPROBAR SI SE HA PROCESADO\n",
          "height": 400,
          "width": 704,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          368,
          32
        ],
        "id": "c401de65-2a78-442b-8f19-88f31b8bfc8f",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "ENVIAR CORREO DE VERIFICACIÓN",
          "height": 192,
          "width": 336,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          736,
          32
        ],
        "id": "02064db4-3e3f-4cb6-b043-ba8e91701b76",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "SUBIDA A META\n",
          "height": 240,
          "width": 1600
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1056,
          448
        ],
        "id": "ab8be564-4726-443a-aae2-3afebc817eaa",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "path": "historiaCamara",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -1008,
          496
        ],
        "id": "fd225dd5-64bd-4381-b7cc-b9cb982c5975",
        "name": "Webhook",
        "webhookId": "720cdebd-a73a-47ae-a8c8-66fe82638f89"
      },
      {
        "parameters": {
          "sendTo": "adrianazorinsanchez@gmail.com",
          "subject": "HISTORIA CÁMARA",
          "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    /* Estilos Generales */\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f4f4f4;\n      margin: 0;\n      padding: 0;\n    }\n\n    /* Contenedor Principal */\n    .container {\n      max-width: 600px;\n      margin: 20px auto;\n      background-color: #ffffff;\n      border-radius: 8px;\n      overflow: hidden;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n    }\n\n    /* Cabecera */\n    .header {\n      background-color: #333333;\n      color: #ffffff;\n      padding: 20px;\n      text-align: center;\n    }\n\n    /* Contenido */\n    .content {\n      padding: 30px;\n      text-align: center;\n      color: #333333;\n    }\n\n    /* Caja de Previsualización */\n    .preview-box {\n      margin: 20px 0;\n      border: 1px solid #eeeeee;\n      padding: 10px;\n      border-radius: 5px;\n      background-color: #fafafa;\n    }\n\n    /* Imágenes */\n    img {\n      max-width: 100%;\n      height: auto;\n      border-radius: 4px;\n      display: block;\n      margin: 0 auto;\n    }\n\n    /* Botón de Confirmación */\n    .btn-confirmar {\n      display: inline-block;\n      background-color: #2ecc71;\n      color: #ffffff !important;\n      padding: 14px 28px;\n      text-decoration: none;\n      border-radius: 5px;\n      font-weight: bold;\n      margin-top: 20px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"container\">\n    \n    <div class=\"header\">\n      <h2 style=\"margin:0;\">Aprobación Requerida</h2>\n    </div>\n\n    <div class=\"content\">\n      <h3>Se requiere aprobación de una historia</h3>\n\n      <div class=\"preview-box\">\n        <p style=\"margin-top: 0; margin-bottom: 10px; font-weight: bold; color: #555;\">\n          Vista previa:\n        </p>\n        \n        <img src=\"{{ $('Edit Fields').item.json.vista_previa }}\" alt=\"Vista Previa\">\n      </div>\n\n      <a href=\"https://n8n.tailwind.es/webhook/historiaCamara?idHistoria={{ $('Edit Fields').item.json.story_url }}&requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Aprobar Historia\n      </a>\n      <a href=\"https://n8n.tailwind.es/webhook/historiaPospuesta?requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Posponer 30 minutos\n      </a>\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarHistoria?origen=historiaWebcam&contenido=HistoriaRechazada&idHistoria={{ $('Edit Fields').item.json.story_url }}&requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Rechazar\n      </a>\n    </div>\n\n    <div style=\"background-color: #eeeeee; padding: 10px; text-align: center; font-size: 12px; color: #777;\">\n      Enviado automáticamente desde n8n\n    </div>\n\n  </div>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          896,
          64
        ],
        "id": "73308a25-8f99-40b8-9ef3-0317f097cfcb",
        "name": "Send a message",
        "webhookId": "31557ff2-993c-4c43-854d-8f372d063b1c",
        "credentials": {
          "gmailOAuth2": {
            "id": "fha7KwAzrDSA7OXO",
            "name": "ventas@sierranevadagranada.com"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<style>\n  /* --- ESTILOS GENERALES --- */\n  body { \n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n    display: flex; justify-content: center; align-items: center; \n    height: 100vh; margin: 0; background-color: #0f172a; \n    color: #e2e8f0; overflow: hidden; \n  }\n  .snow-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }\n  .flake { position: absolute; top: -10px; background-color: rgba(255, 255, 255, 0.4); border-radius: 50%; animation: fall linear infinite; }\n  @keyframes fall { to { transform: translateY(110vh); } }\n  \n  /* La tarjeta (z-index 10) */\n  .card { background-color: #1e293b; padding: 80px 40px 40px; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8); text-align: center; max-width: 380px; width: 90%; position: relative; z-index: 10; margin-top: 50px; overflow: visible; }\n  .snow-svg { position: absolute; top: -1px; left: 0; width: 100%; height: auto; z-index: 20; filter: drop-shadow(0 3px 2px rgba(0,0,0,0.15)); pointer-events: none; border-radius: 16px 16px 0 0; }\n  h1 { color: #f1f5f9; margin: 10px 0; font-size: 28px; font-weight: bold; }\n  p { color: #94a3b8; font-size: 16px; line-height: 1.6; margin-bottom: 20px; }\n  hr { border: 0; border-top: 1px solid #334155; margin: 25px 0; }\n  .check-icon { font-size: 50px; color: #22c55e; position: relative; z-index: 25; margin-top: 20px; filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.4)); }\n\n  /* ========================================= */\n  /* --- PINGÜINO REALISTA EN SNOWBOARD --- */\n  /* ========================================= */\n  .sliding-penguin-container {\n    position: fixed;\n    bottom: 35%; \n    left: -150px; \n    width: 110px; \n    height: auto;\n    z-index: 5; /* Detrás de la tarjeta */\n    transform: rotate(-3deg);\n    /* Duración total 5s: \n       - 4.25s para llegar al centro (lento)\n       - 0.75s para salir disparado (rápido) */\n    animation: slideAcross 5s linear infinite; \n  }\n  .penguin-ref-svg {\n    width: 100%; height: auto;\n    filter: drop-shadow(0 5px 4px rgba(0,0,0,0.5));\n  }\n\n  /* AQUÍ ESTÁ EL TRUCO DE LA VELOCIDAD */\n  @keyframes slideAcross {\n    0%   { left: -150px; } \n    /* Hasta el 85% del tiempo, avanza lento hasta pasar un poco el centro (55vw) */\n    85%  { left: 55vw; } \n    /* En el 15% de tiempo restante, acelera hasta el final (110vw) */\n    100% { left: 110vw;  }\n  }\n</style>\n\n<div class=\"snow-bg\">\n  <div class=\"flake\" style=\"left: 10%; animation-duration: 5s; width: 6px; height: 6px;\"></div>\n  <div class=\"flake\" style=\"left: 30%; animation-duration: 8s; width: 4px; height: 4px;\"></div>\n  <div class=\"flake\" style=\"left: 60%; animation-duration: 4s; width: 8px; height: 8px;\"></div>\n  <div class=\"flake\" style=\"left: 80%; animation-duration: 6s; width: 5px; height: 5px;\"></div>\n</div>\n\n<div class=\"sliding-penguin-container\">\n  <svg class=\"penguin-ref-svg\" viewBox=\"0 0 220 260\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path fill=\"#f1f5f9\" opacity=\"0.9\" d=\"M 10,235 Q 30,220 50,230 Q 70,240 90,225 Q 110,210 130,225 Q 150,240 170,220 Q 190,200 210,230 L 220,250 Q 110,260 0,250 Z\" />\n    <circle fill=\"#f1f5f9\" cx=\"20\" cy=\"225\" r=\"5\" opacity=\"0.8\"/>\n    <circle fill=\"#f1f5f9\" cx=\"190\" cy=\"215\" r=\"6\" opacity=\"0.8\"/>\n    <g transform=\"translate(10, 210)\">\n        <path fill=\"#2dd4bf\" stroke=\"#0f766e\" stroke-width=\"2\" d=\"M 0,20 C 0,0 20,-10 40,-5 L 160,-5 C 180,-10 200,0 200,20 C 200,40 180,45 160,40 L 40,40 C 20,45 0,40 0,20 Z\" />\n        <path fill=\"#ef4444\" d=\"M 30,-2 Q 50,20 70,-2 L 100,-2 Q 80,25 60,35 L 30,35 Q 50,15 30,-2 Z\" />\n        <path fill=\"#ef4444\" d=\"M 130,-2 Q 150,20 170,-2 L 190,2 Q 170,30 150,38 L 120,38 Q 140,15 130,-2 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 65,0 Q 85,25 105,0 L 125,0 Q 105,30 85,38 L 55,38 Q 75,15 65,0 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 160,0 Q 175,15 190,0 L 195,5 Q 180,35 150,40 L 140,35 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 5,5 Q 20,25 5,35 L 15,38 Q 35,20 15,0 Z\" />\n    </g>\n    <g transform=\"translate(45, 15)\">\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"2\" d=\"M 35,210 C 25,210 15,205 15,195 C 15,185 25,180 40,185 C 55,190 65,195 65,205 C 65,215 55,220 35,210 Z\" />\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"2\" d=\"M 95,210 C 85,210 75,205 75,195 C 75,185 85,180 100,185 C 115,190 125,195 125,205 C 125,215 115,220 95,210 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 65,5 C 30,5 5,40 5,100 C 5,160 30,200 65,200 C 100,200 125,160 125,100 C 125,40 100,5 65,5 Z\" />\n        <ellipse fill=\"#f8fafc\" cx=\"65\" cy=\"130\" rx=\"45\" ry=\"55\" />\n        <path fill=\"#f8fafc\" d=\"M 65,35 C 50,35 40,45 40,65 C 40,85 50,95 65,95 C 80,95 90,85 90,65 C 90,45 80,35 65,35 Z\" />\n        <g>\n            <circle fill=\"#1f2937\" cx=\"52\" cy=\"65\" r=\"10\" /><circle fill=\"#1f2937\" cx=\"78\" cy=\"65\" r=\"10\" />\n            <circle fill=\"white\" cx=\"55\" cy=\"62\" r=\"4\" /><circle fill=\"white\" cx=\"75\" cy=\"62\" r=\"4\" />\n            <circle fill=\"white\" cx=\"50\" cy=\"68\" r=\"2\" /><circle fill=\"white\" cx=\"81\" cy=\"68\" r=\"2\" />\n        </g>\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"1\" d=\"M 65,85 L 55,92 Q 65,105 75,92 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 8,100 Q -10,130 10,160 L 20,145 Q 10,125 8,100 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 122,100 Q 140,130 120,160 L 110,145 Q 120,125 122,100 Z\" />\n    </g>\n  </svg>\n</div>\n\n<div class=\"card\">\n  <svg class=\"snow-svg\" viewBox=\"0 0 400 80\" xmlns=\"http://www.w3.org/2000/svg\" preserveAspectRatio=\"none\">\n    <path fill=\"#f1f5f9\" d=\"M0,0 L400,0 V30 Q385,60 370,30 Q355,20 340,30 Q310,75 280,30 Q260,20 240,30 Q200,80 160,35 Q140,25 120,35 Q85,65 50,30 Q35,20 20,35 Q0,60 0,30 Z\" />\n  </svg>\n  <div class=\"check-icon\">✔</div>\n  <h1>¡Confirmado!</h1>\n  <p>La historia ha sido aprobada correctamente.</p>\n  <hr>\n  <p style=\"font-size: 13px; opacity: 0.7;\">Ya puedes cerrar esta pestaña.</p>\n</div>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -272,
          480
        ],
        "id": "3d9447d2-f241-43a3-80ce-1688f72900e5",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Historia Pospuesta</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f4f7f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            color: #333;\n        }\n        .container {\n            text-align: center;\n            background: white;\n            padding: 3rem;\n            border-radius: 15px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            max-width: 500px;\n        }\n        h1 {\n            color: #e67e22;\n            margin-bottom: 1rem;\n            letter-spacing: 1px;\n        }\n        .message {\n            font-size: 1.1rem;\n            margin-bottom: 2rem;\n            line-height: 1.6;\n        }\n        #timer {\n            font-size: 3.5rem;\n            font-weight: bold;\n            color: #2c3e50;\n            margin: 20px 0;\n            font-variant-numeric: tabular-nums;\n        }\n        .footer-note {\n            color: #7f8c8d;\n            font-size: 0.9rem;\n            margin-top: 2rem;\n            border-top: 1px solid #eee;\n            padding-top: 1rem;\n        }\n    </style>\n</head>\n<body>\n\n<div class=\"container\">\n    <h1>HISTORIA POSPUESTA</h1>\n    \n    <div class=\"message\">\n        Dentro de 30 minutos se enviará otro correo con el estado de la webcam.\n    </div>\n\n    <div id=\"timer\">30:00</div>\n\n    <div class=\"footer-note\">\n        Ya puede salir de esta página.\n    </div>\n</div>\n\n<script>\n    function startTimer(durationInSeconds) {\n        let timer = durationInSeconds, minutes, seconds;\n        const display = document.querySelector('#timer');\n        \n        const countdown = setInterval(function () {\n            minutes = parseInt(timer / 60, 10);\n            seconds = parseInt(timer % 60, 10);\n\n            minutes = minutes < 10 ? \"0\" + minutes : minutes;\n            seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n            display.textContent = minutes + \":\" + seconds;\n\n            if (--timer < 0) {\n                clearInterval(countdown);\n                display.textContent = \"00:00\";\n            }\n        }, 1000);\n    }\n\n    // Inicia el contador con 30 minutos (1800 segundos)\n    window.onload = function () {\n        startTimer(30 * 60);\n    };\n</script>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -1392,
          512
        ],
        "id": "3a961a4f-a452-4c7d-adca-015e96491d83",
        "name": "Respond to Webhook1",
        "disabled": true
      },
      {
        "parameters": {
          "path": "historiaPospuesta",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -2016,
          528
        ],
        "id": "9a115c23-aedd-4865-bd46-2f851d98028c",
        "name": "posponer",
        "webhookId": "84cb83c6-97c7-470d-ae3c-9801d1eaa00e"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -1216,
          512
        ],
        "id": "35d19881-992b-4494-a591-18f39361266c",
        "name": "esperar 30 minutos",
        "webhookId": "746e61ef-777c-4de5-8dab-a2cfde26d891"
      },
      {
        "parameters": {
          "path": "rechazarHistoria",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -960,
          912
        ],
        "id": "7facb56f-f11a-4b0c-8a73-2a1872b6bcc7",
        "name": "rechazarHistoria",
        "webhookId": "b7eb3ca4-9700-4a4b-b1ae-cfbd33789ee9"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
                "name": "ORIGEN",
                "value": "={{ $('rechazarHistoria').item.json.query.origen }}",
                "type": "string"
              },
              {
                "id": "348d16fa-a017-44c5-9879-665a4936a387",
                "name": "CONTENIDO",
                "value": "={{ $('rechazarHistoria').item.json.query.contenido }}",
                "type": "string"
              },
              {
                "id": "43b297bb-9d8d-4af2-97b0-0ddb4711edd1",
                "name": "MAS",
                "value": "={{ $('rechazarHistoria').item.json.query.idHistoria }}",
                "type": "string"
              },
              {
                "id": "787399fb-18dd-4255-93a1-09ff792ba1de",
                "name": "requestId2",
                "value": "={{ $now.toFormat('yyyyMMddHHmmss') + Math.floor(Math.random()*1000) + 1 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -448,
          896
        ],
        "id": "a151d550-695a-4b66-8dc1-8b96ac126da1",
        "name": "datosRechazar"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Confirmación</title>\n  <style>\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n      background-color: #f3f4f6;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      margin: 0;\n    }\n    .card {\n      background: white;\n      padding: 40px;\n      border-radius: 12px;\n      box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n      text-align: center;\n      max-width: 400px;\n      border-top: 6px solid #ef4444;\n    }\n    h2 { color: #1f2937; margin-top: 0; font-size: 24px; }\n    p { color: #4b5563; margin: 10px 0; font-size: 16px; }\n    .warning { color: #ef4444; font-weight: bold; margin-bottom: 25px; display: block; }\n    .btn-container { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }\n    \n    /* Estilos de los botones (Enlaces) */\n    .btn {\n      text-decoration: none;\n      padding: 12px 30px;\n      border-radius: 6px;\n      font-weight: bold;\n      font-size: 16px;\n      transition: opacity 0.2s;\n      display: inline-block;\n    }\n    .btn:hover { opacity: 0.8; }\n    \n    /* Botón SI (Acción de Webhook) */\n    .btn-si { background-color: #ef4444; color: white; }\n    \n    /* Botón NO (Cancelar) */\n    .btn-no { background-color: #e5e7eb; color: #374151; }\n  </style>\n</head>\n<body>\n\n  <div class=\"card\">\n    <h2>⚠️ Atención</h2>\n    <p>Estás a punto de rechazar.</p>\n    <p>Esta acción no se puede deshacer.</p>\n    <span class=\"warning\">¿Estás seguro?</span>\n\n    <div class=\"btn-container\">\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarSi?origen={{ $('datosRechazar').item.json.ORIGEN }}&contenido={{ $('datosRechazar').item.json.CONTENIDO }}&estado=rechazado&requestId2={{ $json.requestId }}\" class=\"btn btn-si\">SÍ</a>\n\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarSi?origen={{ $('datosRechazar').item.json.ORIGEN }}&contenido={{ $('datosRechazar').item.json.CONTENIDO }}&idHistoria={{ $('datosRechazar').item.json.MAS }}&estado=noRechazado&requestId2={{ $json.requestId }}\" class=\"btn btn-no\">NO</a>\n    </div>\n  </div>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -112,
          896
        ],
        "id": "54afc9b8-4f0c-49bf-96af-f83d961af8a8",
        "name": "Respond to Webhook Rechazar"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "contador": "={{ $json.row_number + 1}}",
              "contador_no_rechazado": 0
            },
            "matchingColumns": [
              "contador"
            ],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          960,
          1296
        ],
        "id": "9b26fb52-e2b7-4b2a-9cdc-4e0e1f334c22",
        "name": "sumar contador"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
                "name": "ORIGEN",
                "value": "={{ $('si').item.json.query.origen }}",
                "type": "string"
              },
              {
                "id": "348d16fa-a017-44c5-9879-665a4936a387",
                "name": "CONTENIDO",
                "value": "={{ $('si').item.json.query.contenido }}",
                "type": "string"
              },
              {
                "id": "1e3fccd6-21e4-48d2-af81-a5372f6807eb",
                "name": "CONTADOR",
                "value": "={{ $json.contador }}",
                "type": "number"
              },
              {
                "id": "5bbb4b39-9485-415b-a1ea-7fac0e20f99f",
                "name": "token_unico",
                "value": "",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          608,
          1296
        ],
        "id": "5a228376-6e29-480e-b480-f2efb1ca87ca",
        "name": "datos"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1kE01W7ucOTrCpfrN_bC8b4WMvE9tTgQf9lBvjLPwj50",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Rechazados",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $json.CONTADOR }}",
              "ORIGEN": "={{ $json.ORIGEN }}",
              "CONTENIDO": "={{ $json.CONTENIDO }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "ORIGEN",
                "displayName": "ORIGEN",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "CONTENIDO",
                "displayName": "CONTENIDO",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          800,
          1296
        ],
        "id": "5a709dcd-83fe-4fa9-a663-a33d0c1dae45",
        "name": "escribir datos",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RCuKUCifcA4jENcY",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "path": "rechazarSi",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -960,
          1472
        ],
        "id": "34425f3d-064a-4a05-a5ee-152a7d25b887",
        "name": "si",
        "webhookId": "8d74fb79-3a60-4b85-8eae-63028c20ecb5"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          240,
          1296
        ],
        "id": "b626e203-21c2-4c8a-9cff-385723289213",
        "name": "obtener contador"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "FnOKQ90bd0CxI2H5",
            "mode": "list",
            "cachedResultName": "nothingbox",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/FnOKQ90bd0CxI2H5"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "contador": "={{ $('obtener contador1').item.json.contador }}",
              "contador_no_rechazados": "={{ $json.row_number + 1}}"
            },
            "matchingColumns": [
              "contador"
            ],
            "schema": [
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador_no_rechazados",
                "displayName": "contador_no_rechazados",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          736,
          1584
        ],
        "id": "a6e39b97-25d6-4978-b2f6-c7b390801524",
        "name": "sumar contador1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
                "name": "ORIGEN",
                "value": "={{ $('si').item.json.query.origen }}",
                "type": "string"
              },
              {
                "id": "348d16fa-a017-44c5-9879-665a4936a387",
                "name": "CONTENIDO",
                "value": "={{ $('si').item.json.query.contenido }}",
                "type": "string"
              },
              {
                "id": "1e3fccd6-21e4-48d2-af81-a5372f6807eb",
                "name": "CONTADOR",
                "value": "={{ $json.contador_no_rechazados }}",
                "type": "number"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          400,
          1584
        ],
        "id": "0ccd4143-6dc7-4a5e-a34e-bc8be3cd37b6",
        "name": "datos2"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1kE01W7ucOTrCpfrN_bC8b4WMvE9tTgQf9lBvjLPwj50",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "No Rechazados",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $json.CONTADOR }}",
              "ORIGEN": "={{ $json.ORIGEN }}",
              "CONTENIDO": "={{ $json.CONTENIDO }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "ORIGEN",
                "displayName": "ORIGEN",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "CONTENIDO",
                "displayName": "CONTENIDO",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          560,
          1584
        ],
        "id": "427cb2ff-b459-4736-95ab-2e372b34dfa5",
        "name": "escribir datos1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RCuKUCifcA4jENcY",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          224,
          1584
        ],
        "id": "f901e8c3-08ec-4bdf-9470-803fbbf9847e",
        "name": "obtener contador1"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Selección de Acción</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 450px; /* Un poco más ancho para que quepan los textos */\n            width: 90%;\n            border-top: 6px solid #3b82f6; /* Azul Informativo */\n        }\n        .icon {\n            font-size: 50px;\n            margin-bottom: 15px;\n            display: block;\n        }\n        h2 { \n            color: #1f2937; \n            margin-top: 0; \n            font-size: 24px; \n        }\n        p { \n            color: #4b5563; \n            margin: 10px 0 30px 0; \n            font-size: 18px; \n        }\n        .btn-container { \n            display: flex; \n            flex-direction: column; /* Botones uno encima de otro para mejor lectura en móvil */\n            gap: 15px; \n            justify-content: center; \n        }\n        \n        /* Estilos Base de Botones */\n        .btn {\n            text-decoration: none;\n            padding: 15px 20px;\n            border-radius: 8px;\n            font-weight: bold;\n            font-size: 16px;\n            transition: transform 0.1s, opacity 0.2s;\n            display: block;\n            text-align: center;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .btn:hover { opacity: 0.9; transform: translateY(-1px); }\n        .btn:active { transform: translateY(1px); }\n        \n        /* Botón Posponer (Naranja - Tiempo) */\n        .btn-posponer { \n            background-color: #f59e0b; \n            color: white; \n        }\n        \n        /* Botón Aceptar (Azul - Acción Principal) */\n        .btn-aceptar { \n            background-color: #3b82f6; \n            color: white; \n        }\n\n    </style>\n</head>\n<body>\n\n    <div class=\"card\">\n        <span class=\"icon\">🤔</span>\n        \n        <h2>No se ha rechazado</h2>\n        <p>¿Qué quieres hacer?</p>\n\n        <div class=\"btn-container\">\n            <a href=\"https://n8n.tailwind.es/webhook/historiaPospuesta?requestId={{ $json.requestId }}&idHistoria={{ $('si').item.json.query.idHistoria }}\" class=\"btn btn-posponer\">\n                ⏱️ POSPONER 30 MINUTOS\n            </a>\n\n            <a href=\"https://n8n.tailwind.es/webhook/historiaCamara?requestId={{ $json.requestId }}&idHistoria={{ $('si').item.json.query.idHistoria }}\" class=\"btn btn-aceptar\">\n                ✅ ACEPTAR HISTORIA\n            </a>\n        </div>\n    </div>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          48,
          1584
        ],
        "id": "271a6a4d-599d-455c-b699-86c5d10eed12",
        "name": "Respond to Webhook2"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "eb37d92a-214b-46d4-9bab-842c86e8e860",
                "leftValue": "={{ $('si').item.json.query.estado }}",
                "rightValue": "rechazado",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -128,
          1456
        ],
        "id": "b0625766-366e-4d16-8e08-d72254e31bca",
        "name": "If2"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Acción Completada</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 400px;\n            border-top: 6px solid #10b981; /* Verde Éxito */\n        }\n        .icon {\n            font-size: 50px;\n            margin-bottom: 20px;\n            display: block;\n        }\n        h2 { \n            color: #1f2937; \n            margin-top: 0; \n            margin-bottom: 15px;\n            font-size: 24px; \n        }\n        p { \n            color: #4b5563; \n            margin: 10px 0; \n            line-height: 1.5;\n            font-size: 16px; \n        }\n        .doc-name {\n            background-color: #f3f4f6;\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-family: monospace;\n            color: #374151;\n            font-weight: bold;\n        }\n        button {\n            background-color: #10b981;\n            color: white;\n            border: none;\n            padding: 12px 40px;\n            border-radius: 6px;\n            font-weight: bold;\n            font-size: 16px;\n            cursor: pointer;\n            margin-top: 25px;\n            transition: background 0.2s;\n        }\n        button:hover {\n            background-color: #059669;\n        }\n    </style>\n</head>\n<body>\n\n    <div class=\"card\">\n        <span class=\"icon\">✅</span>\n        \n        <h2>Rechazado con éxito</h2>\n        \n        <p>\n            El fallo quedará apuntado en el documento <span class=\"doc-name\">nothingbox</span> de Drive.\n        </p>\n        \n        <button onclick=\"cerrarPestana()\">ACEPTAR</button>\n    </div>\n\n    <script>\n        function cerrarPestana() {\n            // Intenta cerrar la ventana\n            window.close();\n            \n            // Truco adicional para navegadores que bloquean window.close()\n            // si la pestaña no fue abierta por script\n            window.open('','_parent','');\n            window.close();\n\n            // Si el navegador bloquea el cierre (medida de seguridad común),\n            // mostramos un mensaje final.\n            setTimeout(function() {\n                document.body.innerHTML = \"<div style='text-align:center; padding:50px; font-family:sans-serif; color:#4b5563;'><h3>Puedes cerrar esta pestaña manualmente.</h3></div>\";\n            }, 100);\n        }\n    </script>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          48,
          1296
        ],
        "id": "4568449c-95d0-4ca1-9824-cee5dae22b44",
        "name": "Respond to Webhook3"
      },
      {
        "parameters": {
          "content": "Rechazar la historia",
          "height": 368,
          "width": 1120,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1008,
          832
        ],
        "id": "b393dd20-107f-48c5-ac15-36dc31f38403",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "content": "No rechazar",
          "height": 192,
          "width": 1136,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          0,
          1552
        ],
        "id": "f9957b2d-da8a-4e68-a24a-bb35a129a80b",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "content": "Rechazar\n",
          "height": 192,
          "width": 1136,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          0,
          1264
        ],
        "id": "16b3166a-3479-405e-aa50-c151195bf1e4",
        "name": "Sticky Note8"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 21
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.3,
        "position": [
          -1424,
          32
        ],
        "id": "49fa25e5-f301-4918-84b1-47aa1e2acd37",
        "name": "Ejecución diaria"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Workflow Activado</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f4f7f9;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 2rem;\n            border-radius: 12px;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 400px;\n        }\n        .icon {\n            font-size: 50px;\n            color: #4CAF50;\n            margin-bottom: 1rem;\n        }\n        h1 {\n            color: #333;\n            font-size: 24px;\n            margin-bottom: 10px;\n        }\n        p {\n            color: #666;\n            line-height: 1.6;\n            margin-bottom: 20px;\n        }\n        .footer-text {\n            font-size: 0.9rem;\n            color: #999;\n            border-top: 1px solid #eee;\n            padding-top: 15px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"card\">\n        <div class=\"icon\">✅</div>\n        <h1>Se ha activado el workflow</h1>\n        <p>Se te enviará un correo con la información necesaria.</p>\n        <div class=\"footer-text\">\n            Ya puedes cerrar esta página de forma segura.\n        </div>\n    </div>\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -1568,
          304
        ],
        "id": "7ceb85e6-bb7d-47fd-b8d6-af1d92d4cfb0",
        "name": "Respond to Webhook4"
      },
      {
        "parameters": {
          "path": "activarHistoriaCamara",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -1760,
          304
        ],
        "id": "df127ed2-3c87-4160-830d-2ab6edc39580",
        "name": "Activación manual remota",
        "webhookId": "2cc4c66e-9fae-4eb2-a1f9-6fbe1abec15e"
      },
      {
        "parameters": {
          "amount": 1
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -1408,
          304
        ],
        "id": "5454579a-3c68-4fb2-8967-515db88c6f90",
        "name": "Wait1",
        "webhookId": "2cd1ba59-5dcf-4ec3-a263-ca35ab61909c"
      },
      {
        "parameters": {
          "content": "CONDICIÓN RECHAZAR\nEs lo que sale en la página de \"Estás seguro de que quieres rechazar la historia?\"",
          "height": 592,
          "width": 2160,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1008,
          1216
        ],
        "id": "934684ff-df35-424b-a3a4-87186ad5bf38",
        "name": "Sticky Note9"
      },
      {
        "parameters": {
          "content": "Esta es la página de cuando le das a rechazar historia en la página principal, está enlazada directamente al flow de justo abajo, donde se decide si realmente estás seguro de rechazarla",
          "height": 368,
          "width": 304,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          144,
          832
        ],
        "id": "e1a41ebd-fd17-46fd-a8fc-435f4908ac65",
        "name": "Sticky Note10"
      },
      {
        "parameters": {
          "content": "Esta parte gestiona si el usuario está seguro de rechazar la historia.\nLa opción de rechazar apunta la acción en el informe y no hace nada más.\nLa opción de no rechazar redirige a otra página en la que se elige que se quiere hacer con la historia, si posponerla o subirla, cada uno de esos botones está enlazado por medio de webhooks con las opciones correspondientes para cada uno",
          "height": 368,
          "width": 480,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          464,
          832
        ],
        "id": "146710dc-5953-449c-9284-7287154ae1fb",
        "name": "Sticky Note11"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "requestId": "={{ $('Edit Fields').item.json[\"token único\"] }}",
              "Estado": "Pendiente"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          752,
          64
        ],
        "id": "437682ee-5a25-49aa-a87c-95bceec4456f",
        "name": "escribir pendiente requestId"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Enlace no válido</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            color: #1f2937;\n        }\n        .container {\n            background-color: #ffffff;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.05);\n            text-align: center;\n            max-width: 450px;\n            width: 90%;\n            border-top: 5px solid #ef4444; /* Borde rojo superior */\n        }\n        .icon {\n            font-size: 60px;\n            margin-bottom: 15px;\n        }\n        h1 {\n            font-size: 24px;\n            margin-bottom: 10px;\n            color: #111827;\n        }\n        p {\n            font-size: 16px;\n            color: #4b5563;\n            line-height: 1.6;\n            margin-bottom: 25px;\n        }\n        .button {\n            display: inline-block;\n            background-color: #3b82f6;\n            color: #ffffff;\n            padding: 12px 24px;\n            text-decoration: none;\n            border-radius: 8px;\n            font-weight: 600;\n            transition: background-color 0.3s;\n        }\n        .button:hover {\n            background-color: #2563eb;\n        }\n    </style>\n</head>\n<body>\n\n    <div class=\"container\">\n        <div class=\"icon\">🔗🚫</div>\n        \n        <h1>Este link ya ha sido utilizado</h1>\n        \n        <p>Por motivos de seguridad, este enlace es de un solo uso y la acción ya se ha completado anteriormente. No es posible volver a utilizarlo.</p>\n\n    </div>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -1520,
          1056
        ],
        "id": "22844fce-9827-448c-98c2-3fc53ba79dfb",
        "name": "link usado"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
                "leftValue": "={{ $json.Estado }}",
                "rightValue": "Pendiente",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -640,
          912
        ],
        "id": "a8f2261d-1f85-466a-82c9-bea578ef845b",
        "name": "If4"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "requestId",
                "keyValue": "={{ $json.query.requestId }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -784,
          912
        ],
        "id": "6ed9fc83-3de6-4eb1-90c0-b3ece5c31121",
        "name": "Get row(s)"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
                "leftValue": "={{ $json.Estado }}",
                "rightValue": "Pendiente",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -736,
          496
        ],
        "id": "bc9646ee-9aa2-49e9-98c3-d2129c4d40ed",
        "name": "If6"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
                "leftValue": "={{ $json.Estado }}",
                "rightValue": "Pendiente",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -1728,
          528
        ],
        "id": "82bf3a57-5a60-4aa3-855b-22c03e5fac1b",
        "name": "If5"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
                "leftValue": "={{ $json.Estado }}",
                "rightValue": "Pendiente",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -672,
          1472
        ],
        "id": "a29ad6e0-9684-41a9-a35d-b330be843b65",
        "name": "If7"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "2"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "requestId": "={{ $json.requestId2 }}",
              "Estado": "Pendiente"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -288,
          896
        ],
        "id": "a80b5b0e-b7a7-447d-89b4-27c34e21d766",
        "name": "generar segunda clave"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "requestId",
                "keyValue": "={{ $json.query.requestId2 }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -800,
          1472
        ],
        "id": "abf5bd4f-80a9-4601-9f5e-b06433f6d1ec",
        "name": "comprobar segunda clave"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "2"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "requestId": "={{ $json.requestId }}",
              "Estado": "Procesado"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -496,
          1456
        ],
        "id": "d8e2fa43-6737-4dc6-b59d-743744cf89b5",
        "name": "bloquear segunda clave"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "contador_no_rechazado": "={{ $json.contador_no_rechazado }}",
              "Estado": "Procesado",
              "contador": "={{ $json.contador }}",
              "requestId": "={{ $json.requestId }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          432,
          1296
        ],
        "id": "2108798b-f3e0-49a9-8b66-d1717b5b0ac0",
        "name": "bloquear primera clave"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "requestId",
                "keyValue": "={{ $json.query.requestId }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -1872,
          528
        ],
        "id": "aefe1f33-7e4b-412a-acb8-f38b9d5a7615",
        "name": "obtener primera clave"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Estado": "Procesado",
              "requestId": "={{ $json.requestId }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -1568,
          512
        ],
        "id": "a722f57b-1ff2-404b-8135-97b8d6f398bc",
        "name": "bloquear primera clave1"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "requestId",
                "keyValue": "={{ $json.query.requestId }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -864,
          496
        ],
        "id": "1fe830b2-137f-49c4-a4b4-0b2d4c88b6ed",
        "name": "obtener primera clave1"
      },
      {
        "parameters": {
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Estado": "Procesado",
              "requestId": "={{ $json.requestId }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "requestId",
                "displayName": "requestId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "contador",
                "displayName": "contador",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "contador_no_rechazado",
                "displayName": "contador_no_rechazado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -592,
          480
        ],
        "id": "1bf076e3-c508-4c08-a928-cf2a6474b24b",
        "name": "bloquear primera clave2"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "7t1UIjvma8hSpdjP",
            "mode": "list",
            "cachedResultName": "historia_camaras",
            "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "1"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1.1,
        "position": [
          -304,
          1456
        ],
        "id": "5042cd7e-02a3-4049-bb41-97b12a5dc9aa",
        "name": "obtener primera clave2"
      },
      {
        "parameters": {
          "content": "TRIGGERS",
          "height": 496,
          "width": 848,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1920,
          -48
        ],
        "id": "4f4375d0-41c4-41ed-a3b6-c741343a0498",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "content": "POSPONER",
          "height": 224,
          "width": 992,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -2064,
          464
        ],
        "id": "006a245b-7fa0-4621-8d25-93e86638b47d",
        "name": "Sticky Note12"
      },
      {
        "parameters": {
          "content": "LINK USADO\n\nEste Repond To Webhook es el que se ejecuta cuando el link se clica más de una vez",
          "height": 288,
          "width": 320,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1568,
          912
        ],
        "id": "8e61f5c8-2e86-4d6d-9de9-7b6b787d5cdc",
        "name": "Sticky Note13"
      },
      {
        "parameters": {
          "content": "░░░░░░░░░░░░░░░░░░░▒▓▓█████████████▓▓▒░░░░░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░▒████▓▓▒▒░▒▒▒░▒▒▒▒▒▒▓▓████▓▒░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░▒███▓░░░░░░░░░░░░░░░░░░░░░░▒███████▓▓▒░░░░░░░░░░░\n░░░░░░░░░▒██▓░░░░▒▒███▓▓▒░░░░░░░░░░░░░▓▓▒▒▒▒▒▓██████▓░░░░░░░\n░░░░░░░▒██▓░░░▓███▓▒░░░░░░░░▒▒▒▒▒▒▒▒▒▒░░░░░░▒▓▓███▓████▒▒░░░\n░░░░░░██▓░░▒▓██▓░░▒▓██████▓░░░░░░░▒░░░░░░▒██▓▒░░░▓███▒▓▒░░░░\n░░░░░██░░▓███▒░░▒██▒░░░░▒▒██▓░░░░░░░░░░░██▒░░░░▒████▒█░░░░░░\n░░░░██░▒▓▒▓▓░░░██░░░░░░░░░░░█▓░░░░░░░░░██░░░░░░▒███░░█▒░░░░░\n░░░▓█░░░░░░░░░██░░░░░░░░░░░░▓█░░░░░░░░██░░░░░░░░░░░░░█▒░░░░░\n░░░█▓░░░░░░░░░█▒░░████░░░░░░░█▒░░░░░░░██░░░░░░░░░░░░███░░░░░\n░░▒█░░░░░░░▒▓▒█▓░▓████▓░░░░░▒█░░░░░░░░▒█▒░░░░░░░░░░██░█▒░░░░\n░░██░░░░░▒▓▒▓▒██▒▒▓▓▓░░░░░░░██░░░░░░░░░▒████▓███████▓░█▒░░░░\n░░█▓░░░░░▒░░░▒░▒██▓▒░░░░░▒██▓░░░░░░░░░░░░░░██▓░░░░░░▒██▓░░░░\n░░█░░░░░░░░░▓▒░░░░▒▓██████▓░░░░░░░░░░░░░░▒██░░░▓█▓▓▒░░░██░░░\n░▒█░░░░░░░░░░░░░░░░░░░░░░░░░░▓▒▓▒▒▒▒▒▓▓▓▓██░░▓█▓░▒▒██▒░░██░░\n░▓█░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▓▓▒░░██░░██▓░▒░▒░██░░▒█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▒▒░░░██░░▓█░█▓░█▒█▓█▓░░█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒░▒▒░░▓█▓░░██░█▒▒█▒█▒▓█░░█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░░▒░░░░░░░░░░▓█░░░█▒░░░░▒▒░░▒█░▓█░░\n░▒█░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒░░█▒░░█▒░░░░░░░░▓█░█▓░░\n░░█▓░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓█░░█▒░░░░░░░░█░▒█░░░\n░░▓█░░▒░░▒▒░░▒░░░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░░█▓░█▓░░░\n░░░█▒░░▒░░▒░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░▓█░░█░░░░\n░░░██░░░▒░▒░░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░██░░█░░░░\n░░░░█▓░░░▒░▒░░░░▒▒░░░░░▒▒▒▒▒▒░░░░░░░░░░▒█░▒█░░░░░░░█▒░░█▓░░░\n░░░░▓█░░░░▒▒░░░░░▒▒░░░░░░▒▒▒▓▓▓▒░░░░░░░██░██░░░░░░░██░░▓█░░░\n░░░░░██░░░▒░▒░░░░░▒░░░░░░░░▒░▒▒▓█▒░░░░▒█░░█▓▒▓▓▓▒░░▓█░░░█▒░░\n░░░░░▒█▒░░░▒▒▒░░░░▒░░░░░░░░░░▒▒▒░▒▓░░░██░▒█░░░░▒▓▓░░██░░█▒░░\n░░░░░░▒█▒░░░▒░▒░░░▒░░░░░░▒▒▒░░░░▒▒░░░▒█░░██░░░░░░░█░▒█░░█▒░░\n░░░░░░░▓█░░░▒░▒░░░░▒▒░░░░▓▒▒▓▓▓▒░░▓▒░██░░██▒▒▒▒▓▒▓▓███░░█▒░░\n░░░░░░░░██░░░▒░▒░░░░░▒▒░░░░░░░░▓█▓░░░█▓░░██░▓█░█░█░░█▒░░█▒░░\n░░░░░░░░░██░░░░▒▒░░░░░░▒▒░░░░░░░░▒█▓░█▓░░▓█▒▒█▒█░█▒██░░▒█░░░\n░░░░░░░░░░██▒░░░░▒░░░▒░░░▒▒░░░░░░░░▒▓██░░░██░░░░▒▒██░░░██░░░\n░░░░░░░░░░░▓██░░░░░░░░▒▒░░░▒░░░░░░░░░▓█░░░░▓███▓▓██░░░██░░░░\n░░░░░░░░░░░░░▓██▒░░░░░░▒▒▒▒▒░░░░░░░░░░██░░░░░░▒▒▒░░░░██░░░░░\n░░░░░░░░░░░░░░░▓███▒░░░░░░░▒▒▒▒▒▒▒▒░░░░▓██▒░░░░░░░▒███░░░░░░\n░░░░░░░░░░░░░░░░░▒▓███▓▒░░░░░░░▒░░▒▒▒▒░░░▒██▓██████▓░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░▒████▓▒▒░░░░░░░░░░░░░░░▓██▒░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░▒▓████▓░░░░░░░▓█████▒░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒█████████▒░░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒░░░░░░░░░░░░░░░░░░░░░░░\n",
          "height": 784,
          "width": 624,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -3552,
          288
        ],
        "id": "a4b1565b-ed05-444f-b416-395c6c8a5828",
        "name": "Sticky Note14"
      }
    ],
    "connections": {
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "Wait2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait2": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Facebook Graph API1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Facebook Graph API2": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload an asset from file data": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request1": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "escribir pendiente requestId",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "request_página_principal": {
        "main": [
          [
            {
              "node": "extraer_url",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "extraer_url": {
        "main": [
          [
            {
              "node": "request_página_cámaras",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "request_página_cámaras": {
        "main": [
          [
            {
              "node": "extraer_url2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "filtrar_url_reciente": {
        "main": [
          [
            {
              "node": "solicitud_url_reciente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "solicitud_url_reciente": {
        "main": [
          [
            {
              "node": "Upload an asset from file data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "extraer_url2": {
        "main": [
          [
            {
              "node": "filtrar_url_reciente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message": {
        "main": [
          []
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "obtener primera clave1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Facebook Graph API1": {
        "main": [
          []
        ]
      },
      "Respond to Webhook": {
        "main": [
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respond to Webhook1": {
        "main": [
          [
            {
              "node": "esperar 30 minutos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "posponer": {
        "main": [
          [
            {
              "node": "obtener primera clave",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "esperar 30 minutos": {
        "main": [
          [
            {
              "node": "request_página_principal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "rechazarHistoria": {
        "main": [
          [
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "datosRechazar": {
        "main": [
          [
            {
              "node": "generar segunda clave",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "datos": {
        "main": [
          [
            {
              "node": "escribir datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "escribir datos": {
        "main": [
          [
            {
              "node": "sumar contador",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "si": {
        "main": [
          [
            {
              "node": "comprobar segunda clave",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "obtener contador": {
        "main": [
          [
            {
              "node": "bloquear primera clave",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "datos2": {
        "main": [
          []
        ]
      },
      "escribir datos1": {
        "main": [
          [
            {
              "node": "sumar contador1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "obtener contador1": {
        "main": [
          [
            {
              "node": "datos2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respond to Webhook2": {
        "main": [
          [
            {
              "node": "obtener contador1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Respond to Webhook3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Respond to Webhook2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respond to Webhook3": {
        "main": [
          [
            {
              "node": "obtener contador",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ejecución diaria": {
        "main": [
          [
            {
              "node": "request_página_principal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respond to Webhook4": {
        "main": [
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Activación manual remota": {
        "main": [
          [
            {
              "node": "Respond to Webhook4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "request_página_principal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "escribir pendiente requestId": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If4": {
        "main": [
          [
            {
              "node": "datosRechazar",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "link usado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          [
            {
              "node": "If4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If6": {
        "main": [
          [
            {
              "node": "bloquear primera clave2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "link usado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If5": {
        "main": [
          [
            {
              "node": "bloquear primera clave1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "link usado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If7": {
        "main": [
          [
            {
              "node": "bloquear segunda clave",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "link usado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "generar segunda clave": {
        "main": [
          [
            {
              "node": "Respond to Webhook Rechazar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "comprobar segunda clave": {
        "main": [
          [
            {
              "node": "If7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "bloquear segunda clave": {
        "main": [
          [
            {
              "node": "obtener primera clave2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "bloquear primera clave": {
        "main": [
          [
            {
              "node": "datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "obtener primera clave": {
        "main": [
          [
            {
              "node": "If5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "bloquear primera clave1": {
        "main": [
          [
            {
              "node": "Respond to Webhook1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "obtener primera clave1": {
        "main": [
          [
            {
              "node": "If6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "bloquear primera clave2": {
        "main": [
          [
            {
              "node": "Facebook Graph API2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "obtener primera clave2": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Tailwind Media",
    "name": "Version 57d925b8",
    "description": "",
    "autosaved": false
  },
  "activeVersionId": "57d925b8-b8c9-4a86-ad37-7f0f50606019",
  "connections": {
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Facebook Graph API1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook Graph API2": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload an asset from file data": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "escribir pendiente requestId",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "request_página_principal": {
      "main": [
        [
          {
            "node": "extraer_url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extraer_url": {
      "main": [
        [
          {
            "node": "request_página_cámaras",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "request_página_cámaras": {
      "main": [
        [
          {
            "node": "extraer_url2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "filtrar_url_reciente": {
      "main": [
        [
          {
            "node": "solicitud_url_reciente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "solicitud_url_reciente": {
      "main": [
        [
          {
            "node": "Upload an asset from file data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extraer_url2": {
      "main": [
        [
          {
            "node": "filtrar_url_reciente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        []
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "obtener primera clave1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook Graph API1": {
      "main": [
        []
      ]
    },
    "Respond to Webhook": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook1": {
      "main": [
        [
          {
            "node": "esperar 30 minutos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "posponer": {
      "main": [
        [
          {
            "node": "obtener primera clave",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "esperar 30 minutos": {
      "main": [
        [
          {
            "node": "request_página_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rechazarHistoria": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "datosRechazar": {
      "main": [
        [
          {
            "node": "generar segunda clave",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "datos": {
      "main": [
        [
          {
            "node": "escribir datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "escribir datos": {
      "main": [
        [
          {
            "node": "sumar contador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "si": {
      "main": [
        [
          {
            "node": "comprobar segunda clave",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener contador": {
      "main": [
        [
          {
            "node": "bloquear primera clave",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "datos2": {
      "main": [
        []
      ]
    },
    "escribir datos1": {
      "main": [
        [
          {
            "node": "sumar contador1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener contador1": {
      "main": [
        [
          {
            "node": "datos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook2": {
      "main": [
        [
          {
            "node": "obtener contador1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook3": {
      "main": [
        [
          {
            "node": "obtener contador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ejecución diaria": {
      "main": [
        [
          {
            "node": "request_página_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook4": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Activación manual remota": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "request_página_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "escribir pendiente requestId": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "datosRechazar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "link usado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "bloquear primera clave2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "link usado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "bloquear primera clave1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "link usado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "bloquear segunda clave",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "link usado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generar segunda clave": {
      "main": [
        [
          {
            "node": "Respond to Webhook Rechazar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "comprobar segunda clave": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloquear segunda clave": {
      "main": [
        [
          {
            "node": "obtener primera clave2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloquear primera clave": {
      "main": [
        [
          {
            "node": "datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener primera clave": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloquear primera clave1": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener primera clave1": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "bloquear primera clave2": {
      "main": [
        [
          {
            "node": "Facebook Graph API2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener primera clave2": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-11T11:14:07.985Z",
  "id": "CBcjY0JF5P9ZjxEE",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Historia_Camaras",
  "nodes": [
    {
      "parameters": {
        "httpRequestMethod": "POST",
        "graphApiVersion": "v23.0",
        "node": "17841470046184468",
        "edge": "media_publish",
        "options": {
          "queryParametersJson": "={\n  \"creation_id\": \"{{$json.id}}\"\n}"
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        368,
        464
      ],
      "id": "70f5be56-bcbd-45e8-b707-d1fe8cd7941a",
      "name": "Facebook Graph API1",
      "credentials": {
        "facebookGraphApi": {
          "id": "F7VbX8jWKCXdAM47",
          "name": "Facebook Graph account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v20.0/{{ $json.id }}?fields=status,status_code",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_token",
              "value": "EAF2z8nVLTA8BQVHL88vghg4RRZBH9svUgZCP93NSZAB9iSDKxTAMvz8DFby8KVqXp6DWFxfFDiSKOUXvXPVVrJcNxjFOmr0ZCXphOZBUUWRkP8sTZC9wwapmP8vlJQN4NHH2eW9zPRmg2SHrQ0AhjI3n2kx1vAa8nOtr6tbQMhcaP0X0eMtOComwFl3zR7zd7HowZDZD"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        480
      ],
      "id": "edf4ba47-a8ca-4343-8394-708f1e0f7712",
      "name": "HTTP Request3",
      "credentials": {
        "facebookGraphApi": {
          "id": "F7VbX8jWKCXdAM47",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        48,
        480
      ],
      "id": "5579777d-f732-4b98-b233-233d14c7baeb",
      "name": "Wait2",
      "webhookId": "4e9e9bda-286b-4bd6-b112-9133762c2724"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "49c65dc4-2ebe-451b-9788-cd0999f268f1",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": "FINISHED",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        208,
        480
      ],
      "id": "f2e57470-8cb6-4aff-a4f1-776c6d413c60",
      "name": "If1"
    },
    {
      "parameters": {
        "httpRequestMethod": "POST",
        "graphApiVersion": "v23.0",
        "node": "17841470046184468",
        "edge": "=media",
        "options": {
          "queryParametersJson": "={\n\"video_url\": \"{{ $('Webhook').item.json.query.idHistoria }}\",\n\"media_type\": \"STORIES\",\n\"is_story\": true\n}"
        }
      },
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        -448,
        480
      ],
      "id": "0bbfbe8d-31e9-41c6-8d53-89988526abf1",
      "name": "Facebook Graph API2",
      "credentials": {
        "facebookGraphApi": {
          "id": "F7VbX8jWKCXdAM47",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4fa17a3a-35cc-4f82-988a-32b82b6223e9",
              "name": "story_url",
              "value": "=https://res.cloudinary.com/dglub1vnw/video/upload/vc_h264,ac_aac,c_pad,w_1080,h_1920,b_blurred:400,du_30/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_black,e_outline:3/fl_layer_apply,g_north_west,x_10,y_670/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_white/fl_layer_apply,g_north_west,x_13,y_673/{{ $json.public_id }}.mp4",
              "type": "string"
            },
            {
              "id": "281cd629-07ec-4b26-bcb4-085d1a77c5f8",
              "name": "vista_previa",
              "value": "=https://res.cloudinary.com/dglub1vnw/video/upload/c_pad,w_1080,h_1920,b_black/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_black,e_outline:3/fl_layer_apply,g_north_west,x_10,y_670/l_text:Courier_45_bold:ZONA%20BORREGUILES,co_white/fl_layer_apply,g_north_west,x_13,y_673/{{ $json.public_id }}.jpg",
              "type": "string"
            },
            {
              "id": "4dc0a51e-ecfb-43bb-9ea2-33faf1ebebda",
              "name": "=token único",
              "value": "={{ $now.toFormat('yyyyMMddHHmmss') + Math.floor(Math.random()*1000) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        160
      ],
      "id": "8ec922b4-00bc-43fc-8fb3-48a2e73f92d2",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "uploadFile",
        "resource_type_file": "video",
        "additionalFieldsFile": {}
      },
      "type": "n8n-nodes-cloudinary.cloudinary",
      "typeVersion": 1,
      "position": [
        64,
        160
      ],
      "id": "4c85ba67-fb60-4a26-8c67-4a5bf0283b78",
      "name": "Upload an asset from file data",
      "credentials": {
        "cloudinaryApi": {
          "id": "YTnswF3cVMD8a6jX",
          "name": "Cuenta Cloudinary"
        }
      }
    },
    {
      "parameters": {
        "method": "HEAD",
        "url": "={{ $json.story_url }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true,
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        432,
        160
      ],
      "id": "4fecbe0c-ed05-4db3-aa2c-8e9977ab31c2",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "23ffd565-77db-41aa-846e-6e4f54f021a7",
              "leftValue": "={{ $json.statusCode }}",
              "rightValue": 200,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        592,
        160
      ],
      "id": "4e3544c3-0642-49ef-82b2-ecd3367c560b",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        752,
        256
      ],
      "id": "cdd381ff-6ac2-45ba-9e2a-43a650f57753",
      "name": "Wait",
      "webhookId": "2ddadd9e-f14b-4c72-b341-f3ef721110ea"
    },
    {
      "parameters": {
        "url": "https://sierranevada.es/es/invierno/la-estacion/en-directo/webcams/",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -992,
        160
      ],
      "id": "2aaa757a-e4c6-4d1a-afa7-70d04f751c29",
      "name": "request_página_principal"
    },
    {
      "parameters": {
        "jsCode": "// 1. Obtenemos el HTML gigante\nconst html = items[0].json.data;\n\n// 2. Buscamos el script que tiene todos los datos de la página (Next.js data)\nconst regex = /<script id=\"__NEXT_DATA__\" type=\"application\\/json\">(.*?)<\\/script>/;\nconst match = html.match(regex);\n\nlet resultados = [];\n\nif (match && match[1]) {\n  // 3. Parseamos el texto a JSON real\n  const data = JSON.parse(match[1]);\n\n  // 4. Navegamos por la estructura compleja de Sierra Nevada para encontrar las webcams\n  // La ruta suele ser: props -> pageProps -> model -> MenuPrincipalCustom... o buscando bloques\n  // Para hacerlo fácil, vamos a buscar recursivamente cualquier objeto que parezca una webcam de Feratel\n  \n  // Convertimos todo el objeto a string para buscar patrones de feratel (truco rápido)\n  const jsonString = JSON.stringify(data);\n  \n  // Buscamos patrones de IDs de cámara (ej: cam=15111)\n  const camRegex = /cam=(\\d+)/g;\n  let camMatch;\n  const uniqueCams = new Set();\n\n  while ((camMatch = camRegex.exec(jsonString)) !== null) {\n    uniqueCams.add(camMatch[1]);\n  }\n\n  // Creamos el resultado\n  uniqueCams.forEach(id => {\n    resultados.push({\n      json: {\n        camera_id: id,\n        iframe_url: `https://webtv.feratel.com/webtv/?design=v5&cam=${id}`,\n        video_directo_mp4: `https://sts063.feratel.co.at/streams/stsstore055/1/${id}_vid.mp4` // URL estimada basada en tu ejemplo\n      }\n    });\n  });\n}\n\nreturn resultados;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -816,
        160
      ],
      "id": "182ae0c9-e916-4427-aec4-7a10a39e4a2c",
      "name": "extraer_url"
    },
    {
      "parameters": {
        "url": "={{ $json.iframe_url }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
            },
            {
              "name": "Referer",
              "value": "https://sierranevada.es/"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -640,
        160
      ],
      "id": "c8780df9-a109-4cee-b438-bbab9e0fdd02",
      "name": "request_página_cámaras"
    },
    {
      "parameters": {
        "jsCode": "// Obtenemos la fecha actual\nconst now = new Date();\nlet masCercano = null;\nlet menorDiferencia = Infinity; \n\nfor (const item of items) {\n  // Asegúrate de que item.json existe por seguridad\n  if (!item.json) continue;\n\n  const url = item.json.video_url;\n  \n  // --- BLOQUE DE SEGURIDAD NUEVO ---\n  // Si no hay url, o no es un texto, saltamos al siguiente item del bucle\n  if (!url || typeof url !== 'string') {\n    continue; \n  }\n  // ---------------------------------\n\n  // Ahora es seguro usar .match()\n  const match = url.match(/_([0-9a-fA-F]{8})[-_a-zA-Z]/);\n\n  if (match && match[1]) {\n    const hexTimestamp = match[1];\n    const unixSeconds = parseInt(hexTimestamp, 16);\n    \n    const videoDate = new Date(unixSeconds * 1000);\n    const diff = now - videoDate;\n\n    if (diff >= 0 && diff < menorDiferencia) {\n      menorDiferencia = diff;\n      masCercano = item;\n      masCercano.json.fecha_decodificada = videoDate.toISOString();\n      masCercano.json.segundos_atras = diff / 1000;\n    }\n  }\n}\n\nreturn masCercano ? [masCercano] : [];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -320,
        160
      ],
      "id": "f57b7f7e-dbe8-413c-a885-a19c5054e907",
      "name": "filtrar_url_reciente"
    },
    {
      "parameters": {
        "url": "={{ $json.video_url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -160,
        160
      ],
      "id": "777d5a4a-20a7-412f-bc9f-683c3b198f68",
      "name": "solicitud_url_reciente"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "video_url",
              "cssSelector": "div#videoframe video source",
              "returnValue": "attribute",
              "attribute": "src"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        -480,
        160
      ],
      "id": "341861a2-cb91-4338-a739-df0b98b10862",
      "name": "extraer_url2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4fa17a3a-35cc-4f82-988a-32b82b6223e9",
              "name": "story_url",
              "value": "={{ $('Edit Fields').item.json.story_url }}",
              "type": "string"
            },
            {
              "id": "e218b35b-bee8-4b32-8bb5-70c1a571d9db",
              "name": "vista_previa",
              "value": "={{ $('Edit Fields').item.json.vista_previa }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        256
      ],
      "id": "e575ea56-dfa1-45c0-859f-96bb45cd6518",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "content": "OBTENER VÍDEO DE LA CÁMARA",
        "height": 288,
        "width": 1056,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1056,
        64
      ],
      "id": "6acdd7c5-d32a-4c6e-aca2-3acbb08403ea",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "SUBIR VÍDEO Y GENERAR URL",
        "height": 288,
        "width": 336,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        16,
        64
      ],
      "id": "c06ee7e0-d0ad-4922-9665-6e79c6076bc9",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "COMPROBAR SI SE HA PROCESADO\n",
        "height": 400,
        "width": 704,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        368,
        32
      ],
      "id": "c401de65-2a78-442b-8f19-88f31b8bfc8f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "ENVIAR CORREO DE VERIFICACIÓN",
        "height": 192,
        "width": 336,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        736,
        32
      ],
      "id": "02064db4-3e3f-4cb6-b043-ba8e91701b76",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "SUBIDA A META\n",
        "height": 240,
        "width": 1600
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1056,
        448
      ],
      "id": "ab8be564-4726-443a-aae2-3afebc817eaa",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "path": "historiaCamara",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1008,
        496
      ],
      "id": "fd225dd5-64bd-4381-b7cc-b9cb982c5975",
      "name": "Webhook",
      "webhookId": "720cdebd-a73a-47ae-a8c8-66fe82638f89"
    },
    {
      "parameters": {
        "sendTo": "adrianazorinsanchez@gmail.com",
        "subject": "HISTORIA CÁMARA",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    /* Estilos Generales */\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f4f4f4;\n      margin: 0;\n      padding: 0;\n    }\n\n    /* Contenedor Principal */\n    .container {\n      max-width: 600px;\n      margin: 20px auto;\n      background-color: #ffffff;\n      border-radius: 8px;\n      overflow: hidden;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n    }\n\n    /* Cabecera */\n    .header {\n      background-color: #333333;\n      color: #ffffff;\n      padding: 20px;\n      text-align: center;\n    }\n\n    /* Contenido */\n    .content {\n      padding: 30px;\n      text-align: center;\n      color: #333333;\n    }\n\n    /* Caja de Previsualización */\n    .preview-box {\n      margin: 20px 0;\n      border: 1px solid #eeeeee;\n      padding: 10px;\n      border-radius: 5px;\n      background-color: #fafafa;\n    }\n\n    /* Imágenes */\n    img {\n      max-width: 100%;\n      height: auto;\n      border-radius: 4px;\n      display: block;\n      margin: 0 auto;\n    }\n\n    /* Botón de Confirmación */\n    .btn-confirmar {\n      display: inline-block;\n      background-color: #2ecc71;\n      color: #ffffff !important;\n      padding: 14px 28px;\n      text-decoration: none;\n      border-radius: 5px;\n      font-weight: bold;\n      margin-top: 20px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"container\">\n    \n    <div class=\"header\">\n      <h2 style=\"margin:0;\">Aprobación Requerida</h2>\n    </div>\n\n    <div class=\"content\">\n      <h3>Se requiere aprobación de una historia</h3>\n\n      <div class=\"preview-box\">\n        <p style=\"margin-top: 0; margin-bottom: 10px; font-weight: bold; color: #555;\">\n          Vista previa:\n        </p>\n        \n        <img src=\"{{ $('Edit Fields').item.json.vista_previa }}\" alt=\"Vista Previa\">\n      </div>\n\n      <a href=\"https://n8n.tailwind.es/webhook/historiaCamara?idHistoria={{ $('Edit Fields').item.json.story_url }}&requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Aprobar Historia\n      </a>\n      <a href=\"https://n8n.tailwind.es/webhook/historiaPospuesta?requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Posponer 30 minutos\n      </a>\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarHistoria?origen=historiaWebcam&contenido=HistoriaRechazada&idHistoria={{ $('Edit Fields').item.json.story_url }}&requestId={{ $('Edit Fields').item.json['token único'] }}\" class=\"btn-confirmar\">\n        Rechazar\n      </a>\n    </div>\n\n    <div style=\"background-color: #eeeeee; padding: 10px; text-align: center; font-size: 12px; color: #777;\">\n      Enviado automáticamente desde n8n\n    </div>\n\n  </div>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        896,
        64
      ],
      "id": "73308a25-8f99-40b8-9ef3-0317f097cfcb",
      "name": "Send a message",
      "webhookId": "31557ff2-993c-4c43-854d-8f372d063b1c",
      "credentials": {
        "gmailOAuth2": {
          "id": "fha7KwAzrDSA7OXO",
          "name": "ventas@sierranevadagranada.com"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<style>\n  /* --- ESTILOS GENERALES --- */\n  body { \n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n    display: flex; justify-content: center; align-items: center; \n    height: 100vh; margin: 0; background-color: #0f172a; \n    color: #e2e8f0; overflow: hidden; \n  }\n  .snow-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }\n  .flake { position: absolute; top: -10px; background-color: rgba(255, 255, 255, 0.4); border-radius: 50%; animation: fall linear infinite; }\n  @keyframes fall { to { transform: translateY(110vh); } }\n  \n  /* La tarjeta (z-index 10) */\n  .card { background-color: #1e293b; padding: 80px 40px 40px; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8); text-align: center; max-width: 380px; width: 90%; position: relative; z-index: 10; margin-top: 50px; overflow: visible; }\n  .snow-svg { position: absolute; top: -1px; left: 0; width: 100%; height: auto; z-index: 20; filter: drop-shadow(0 3px 2px rgba(0,0,0,0.15)); pointer-events: none; border-radius: 16px 16px 0 0; }\n  h1 { color: #f1f5f9; margin: 10px 0; font-size: 28px; font-weight: bold; }\n  p { color: #94a3b8; font-size: 16px; line-height: 1.6; margin-bottom: 20px; }\n  hr { border: 0; border-top: 1px solid #334155; margin: 25px 0; }\n  .check-icon { font-size: 50px; color: #22c55e; position: relative; z-index: 25; margin-top: 20px; filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.4)); }\n\n  /* ========================================= */\n  /* --- PINGÜINO REALISTA EN SNOWBOARD --- */\n  /* ========================================= */\n  .sliding-penguin-container {\n    position: fixed;\n    bottom: 35%; \n    left: -150px; \n    width: 110px; \n    height: auto;\n    z-index: 5; /* Detrás de la tarjeta */\n    transform: rotate(-3deg);\n    /* Duración total 5s: \n       - 4.25s para llegar al centro (lento)\n       - 0.75s para salir disparado (rápido) */\n    animation: slideAcross 5s linear infinite; \n  }\n  .penguin-ref-svg {\n    width: 100%; height: auto;\n    filter: drop-shadow(0 5px 4px rgba(0,0,0,0.5));\n  }\n\n  /* AQUÍ ESTÁ EL TRUCO DE LA VELOCIDAD */\n  @keyframes slideAcross {\n    0%   { left: -150px; } \n    /* Hasta el 85% del tiempo, avanza lento hasta pasar un poco el centro (55vw) */\n    85%  { left: 55vw; } \n    /* En el 15% de tiempo restante, acelera hasta el final (110vw) */\n    100% { left: 110vw;  }\n  }\n</style>\n\n<div class=\"snow-bg\">\n  <div class=\"flake\" style=\"left: 10%; animation-duration: 5s; width: 6px; height: 6px;\"></div>\n  <div class=\"flake\" style=\"left: 30%; animation-duration: 8s; width: 4px; height: 4px;\"></div>\n  <div class=\"flake\" style=\"left: 60%; animation-duration: 4s; width: 8px; height: 8px;\"></div>\n  <div class=\"flake\" style=\"left: 80%; animation-duration: 6s; width: 5px; height: 5px;\"></div>\n</div>\n\n<div class=\"sliding-penguin-container\">\n  <svg class=\"penguin-ref-svg\" viewBox=\"0 0 220 260\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path fill=\"#f1f5f9\" opacity=\"0.9\" d=\"M 10,235 Q 30,220 50,230 Q 70,240 90,225 Q 110,210 130,225 Q 150,240 170,220 Q 190,200 210,230 L 220,250 Q 110,260 0,250 Z\" />\n    <circle fill=\"#f1f5f9\" cx=\"20\" cy=\"225\" r=\"5\" opacity=\"0.8\"/>\n    <circle fill=\"#f1f5f9\" cx=\"190\" cy=\"215\" r=\"6\" opacity=\"0.8\"/>\n    <g transform=\"translate(10, 210)\">\n        <path fill=\"#2dd4bf\" stroke=\"#0f766e\" stroke-width=\"2\" d=\"M 0,20 C 0,0 20,-10 40,-5 L 160,-5 C 180,-10 200,0 200,20 C 200,40 180,45 160,40 L 40,40 C 20,45 0,40 0,20 Z\" />\n        <path fill=\"#ef4444\" d=\"M 30,-2 Q 50,20 70,-2 L 100,-2 Q 80,25 60,35 L 30,35 Q 50,15 30,-2 Z\" />\n        <path fill=\"#ef4444\" d=\"M 130,-2 Q 150,20 170,-2 L 190,2 Q 170,30 150,38 L 120,38 Q 140,15 130,-2 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 65,0 Q 85,25 105,0 L 125,0 Q 105,30 85,38 L 55,38 Q 75,15 65,0 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 160,0 Q 175,15 190,0 L 195,5 Q 180,35 150,40 L 140,35 Z\" />\n        <path fill=\"#1e3a8a\" d=\"M 5,5 Q 20,25 5,35 L 15,38 Q 35,20 15,0 Z\" />\n    </g>\n    <g transform=\"translate(45, 15)\">\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"2\" d=\"M 35,210 C 25,210 15,205 15,195 C 15,185 25,180 40,185 C 55,190 65,195 65,205 C 65,215 55,220 35,210 Z\" />\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"2\" d=\"M 95,210 C 85,210 75,205 75,195 C 75,185 85,180 100,185 C 115,190 125,195 125,205 C 125,215 115,220 95,210 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 65,5 C 30,5 5,40 5,100 C 5,160 30,200 65,200 C 100,200 125,160 125,100 C 125,40 100,5 65,5 Z\" />\n        <ellipse fill=\"#f8fafc\" cx=\"65\" cy=\"130\" rx=\"45\" ry=\"55\" />\n        <path fill=\"#f8fafc\" d=\"M 65,35 C 50,35 40,45 40,65 C 40,85 50,95 65,95 C 80,95 90,85 90,65 C 90,45 80,35 65,35 Z\" />\n        <g>\n            <circle fill=\"#1f2937\" cx=\"52\" cy=\"65\" r=\"10\" /><circle fill=\"#1f2937\" cx=\"78\" cy=\"65\" r=\"10\" />\n            <circle fill=\"white\" cx=\"55\" cy=\"62\" r=\"4\" /><circle fill=\"white\" cx=\"75\" cy=\"62\" r=\"4\" />\n            <circle fill=\"white\" cx=\"50\" cy=\"68\" r=\"2\" /><circle fill=\"white\" cx=\"81\" cy=\"68\" r=\"2\" />\n        </g>\n        <path fill=\"#fb923c\" stroke=\"#c2410c\" stroke-width=\"1\" d=\"M 65,85 L 55,92 Q 65,105 75,92 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 8,100 Q -10,130 10,160 L 20,145 Q 10,125 8,100 Z\" />\n        <path fill=\"#374151\" stroke=\"#1f2937\" stroke-width=\"2\" d=\"M 122,100 Q 140,130 120,160 L 110,145 Q 120,125 122,100 Z\" />\n    </g>\n  </svg>\n</div>\n\n<div class=\"card\">\n  <svg class=\"snow-svg\" viewBox=\"0 0 400 80\" xmlns=\"http://www.w3.org/2000/svg\" preserveAspectRatio=\"none\">\n    <path fill=\"#f1f5f9\" d=\"M0,0 L400,0 V30 Q385,60 370,30 Q355,20 340,30 Q310,75 280,30 Q260,20 240,30 Q200,80 160,35 Q140,25 120,35 Q85,65 50,30 Q35,20 20,35 Q0,60 0,30 Z\" />\n  </svg>\n  <div class=\"check-icon\">✔</div>\n  <h1>¡Confirmado!</h1>\n  <p>La historia ha sido aprobada correctamente.</p>\n  <hr>\n  <p style=\"font-size: 13px; opacity: 0.7;\">Ya puedes cerrar esta pestaña.</p>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -272,
        480
      ],
      "id": "3d9447d2-f241-43a3-80ce-1688f72900e5",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Historia Pospuesta</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f4f7f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            color: #333;\n        }\n        .container {\n            text-align: center;\n            background: white;\n            padding: 3rem;\n            border-radius: 15px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            max-width: 500px;\n        }\n        h1 {\n            color: #e67e22;\n            margin-bottom: 1rem;\n            letter-spacing: 1px;\n        }\n        .message {\n            font-size: 1.1rem;\n            margin-bottom: 2rem;\n            line-height: 1.6;\n        }\n        #timer {\n            font-size: 3.5rem;\n            font-weight: bold;\n            color: #2c3e50;\n            margin: 20px 0;\n            font-variant-numeric: tabular-nums;\n        }\n        .footer-note {\n            color: #7f8c8d;\n            font-size: 0.9rem;\n            margin-top: 2rem;\n            border-top: 1px solid #eee;\n            padding-top: 1rem;\n        }\n    </style>\n</head>\n<body>\n\n<div class=\"container\">\n    <h1>HISTORIA POSPUESTA</h1>\n    \n    <div class=\"message\">\n        Dentro de 30 minutos se enviará otro correo con el estado de la webcam.\n    </div>\n\n    <div id=\"timer\">30:00</div>\n\n    <div class=\"footer-note\">\n        Ya puede salir de esta página.\n    </div>\n</div>\n\n<script>\n    function startTimer(durationInSeconds) {\n        let timer = durationInSeconds, minutes, seconds;\n        const display = document.querySelector('#timer');\n        \n        const countdown = setInterval(function () {\n            minutes = parseInt(timer / 60, 10);\n            seconds = parseInt(timer % 60, 10);\n\n            minutes = minutes < 10 ? \"0\" + minutes : minutes;\n            seconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n            display.textContent = minutes + \":\" + seconds;\n\n            if (--timer < 0) {\n                clearInterval(countdown);\n                display.textContent = \"00:00\";\n            }\n        }, 1000);\n    }\n\n    // Inicia el contador con 30 minutos (1800 segundos)\n    window.onload = function () {\n        startTimer(30 * 60);\n    };\n</script>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -1392,
        512
      ],
      "id": "3a961a4f-a452-4c7d-adca-015e96491d83",
      "name": "Respond to Webhook1",
      "disabled": true
    },
    {
      "parameters": {
        "path": "historiaPospuesta",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2016,
        528
      ],
      "id": "9a115c23-aedd-4865-bd46-2f851d98028c",
      "name": "posponer",
      "webhookId": "84cb83c6-97c7-470d-ae3c-9801d1eaa00e"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1216,
        512
      ],
      "id": "35d19881-992b-4494-a591-18f39361266c",
      "name": "esperar 30 minutos",
      "webhookId": "746e61ef-777c-4de5-8dab-a2cfde26d891"
    },
    {
      "parameters": {
        "path": "rechazarHistoria",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -960,
        912
      ],
      "id": "7facb56f-f11a-4b0c-8a73-2a1872b6bcc7",
      "name": "rechazarHistoria",
      "webhookId": "b7eb3ca4-9700-4a4b-b1ae-cfbd33789ee9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
              "name": "ORIGEN",
              "value": "={{ $('rechazarHistoria').item.json.query.origen }}",
              "type": "string"
            },
            {
              "id": "348d16fa-a017-44c5-9879-665a4936a387",
              "name": "CONTENIDO",
              "value": "={{ $('rechazarHistoria').item.json.query.contenido }}",
              "type": "string"
            },
            {
              "id": "43b297bb-9d8d-4af2-97b0-0ddb4711edd1",
              "name": "MAS",
              "value": "={{ $('rechazarHistoria').item.json.query.idHistoria }}",
              "type": "string"
            },
            {
              "id": "787399fb-18dd-4255-93a1-09ff792ba1de",
              "name": "requestId2",
              "value": "={{ $now.toFormat('yyyyMMddHHmmss') + Math.floor(Math.random()*1000) + 1 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -448,
        896
      ],
      "id": "a151d550-695a-4b66-8dc1-8b96ac126da1",
      "name": "datosRechazar"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Confirmación</title>\n  <style>\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n      background-color: #f3f4f6;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      margin: 0;\n    }\n    .card {\n      background: white;\n      padding: 40px;\n      border-radius: 12px;\n      box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n      text-align: center;\n      max-width: 400px;\n      border-top: 6px solid #ef4444;\n    }\n    h2 { color: #1f2937; margin-top: 0; font-size: 24px; }\n    p { color: #4b5563; margin: 10px 0; font-size: 16px; }\n    .warning { color: #ef4444; font-weight: bold; margin-bottom: 25px; display: block; }\n    .btn-container { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }\n    \n    /* Estilos de los botones (Enlaces) */\n    .btn {\n      text-decoration: none;\n      padding: 12px 30px;\n      border-radius: 6px;\n      font-weight: bold;\n      font-size: 16px;\n      transition: opacity 0.2s;\n      display: inline-block;\n    }\n    .btn:hover { opacity: 0.8; }\n    \n    /* Botón SI (Acción de Webhook) */\n    .btn-si { background-color: #ef4444; color: white; }\n    \n    /* Botón NO (Cancelar) */\n    .btn-no { background-color: #e5e7eb; color: #374151; }\n  </style>\n</head>\n<body>\n\n  <div class=\"card\">\n    <h2>⚠️ Atención</h2>\n    <p>Estás a punto de rechazar.</p>\n    <p>Esta acción no se puede deshacer.</p>\n    <span class=\"warning\">¿Estás seguro?</span>\n\n    <div class=\"btn-container\">\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarSi?origen={{ $('datosRechazar').item.json.ORIGEN }}&contenido={{ $('datosRechazar').item.json.CONTENIDO }}&estado=rechazado&requestId2={{ $json.requestId }}\" class=\"btn btn-si\">SÍ</a>\n\n      <a href=\"https://n8n.tailwind.es/webhook/rechazarSi?origen={{ $('datosRechazar').item.json.ORIGEN }}&contenido={{ $('datosRechazar').item.json.CONTENIDO }}&idHistoria={{ $('datosRechazar').item.json.MAS }}&estado=noRechazado&requestId2={{ $json.requestId }}\" class=\"btn btn-no\">NO</a>\n    </div>\n  </div>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -112,
        896
      ],
      "id": "54afc9b8-4f0c-49bf-96af-f83d961af8a8",
      "name": "Respond to Webhook Rechazar"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "contador": "={{ $json.row_number + 1}}",
            "contador_no_rechazado": 0
          },
          "matchingColumns": [
            "contador"
          ],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        960,
        1296
      ],
      "id": "9b26fb52-e2b7-4b2a-9cdc-4e0e1f334c22",
      "name": "sumar contador"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
              "name": "ORIGEN",
              "value": "={{ $('si').item.json.query.origen }}",
              "type": "string"
            },
            {
              "id": "348d16fa-a017-44c5-9879-665a4936a387",
              "name": "CONTENIDO",
              "value": "={{ $('si').item.json.query.contenido }}",
              "type": "string"
            },
            {
              "id": "1e3fccd6-21e4-48d2-af81-a5372f6807eb",
              "name": "CONTADOR",
              "value": "={{ $json.contador }}",
              "type": "number"
            },
            {
              "id": "5bbb4b39-9485-415b-a1ea-7fac0e20f99f",
              "name": "token_unico",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        608,
        1296
      ],
      "id": "5a228376-6e29-480e-b480-f2efb1ca87ca",
      "name": "datos"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1kE01W7ucOTrCpfrN_bC8b4WMvE9tTgQf9lBvjLPwj50",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Rechazados",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.CONTADOR }}",
            "ORIGEN": "={{ $json.ORIGEN }}",
            "CONTENIDO": "={{ $json.CONTENIDO }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "ORIGEN",
              "displayName": "ORIGEN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "CONTENIDO",
              "displayName": "CONTENIDO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        800,
        1296
      ],
      "id": "5a709dcd-83fe-4fa9-a663-a33d0c1dae45",
      "name": "escribir datos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RCuKUCifcA4jENcY",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "path": "rechazarSi",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -960,
        1472
      ],
      "id": "34425f3d-064a-4a05-a5ee-152a7d25b887",
      "name": "si",
      "webhookId": "8d74fb79-3a60-4b85-8eae-63028c20ecb5"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        240,
        1296
      ],
      "id": "b626e203-21c2-4c8a-9cff-385723289213",
      "name": "obtener contador"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "FnOKQ90bd0CxI2H5",
          "mode": "list",
          "cachedResultName": "nothingbox",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/FnOKQ90bd0CxI2H5"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "contador": "={{ $('obtener contador1').item.json.contador }}",
            "contador_no_rechazados": "={{ $json.row_number + 1}}"
          },
          "matchingColumns": [
            "contador"
          ],
          "schema": [
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador_no_rechazados",
              "displayName": "contador_no_rechazados",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        736,
        1584
      ],
      "id": "a6e39b97-25d6-4978-b2f6-c7b390801524",
      "name": "sumar contador1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1fc1ee34-829a-45a3-a4af-fa95470d9512",
              "name": "ORIGEN",
              "value": "={{ $('si').item.json.query.origen }}",
              "type": "string"
            },
            {
              "id": "348d16fa-a017-44c5-9879-665a4936a387",
              "name": "CONTENIDO",
              "value": "={{ $('si').item.json.query.contenido }}",
              "type": "string"
            },
            {
              "id": "1e3fccd6-21e4-48d2-af81-a5372f6807eb",
              "name": "CONTADOR",
              "value": "={{ $json.contador_no_rechazados }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        400,
        1584
      ],
      "id": "0ccd4143-6dc7-4a5e-a34e-bc8be3cd37b6",
      "name": "datos2"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1kE01W7ucOTrCpfrN_bC8b4WMvE9tTgQf9lBvjLPwj50",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "No Rechazados",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.CONTADOR }}",
            "ORIGEN": "={{ $json.ORIGEN }}",
            "CONTENIDO": "={{ $json.CONTENIDO }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "ORIGEN",
              "displayName": "ORIGEN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "CONTENIDO",
              "displayName": "CONTENIDO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        560,
        1584
      ],
      "id": "427cb2ff-b459-4736-95ab-2e372b34dfa5",
      "name": "escribir datos1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RCuKUCifcA4jENcY",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        224,
        1584
      ],
      "id": "f901e8c3-08ec-4bdf-9470-803fbbf9847e",
      "name": "obtener contador1"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Selección de Acción</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 450px; /* Un poco más ancho para que quepan los textos */\n            width: 90%;\n            border-top: 6px solid #3b82f6; /* Azul Informativo */\n        }\n        .icon {\n            font-size: 50px;\n            margin-bottom: 15px;\n            display: block;\n        }\n        h2 { \n            color: #1f2937; \n            margin-top: 0; \n            font-size: 24px; \n        }\n        p { \n            color: #4b5563; \n            margin: 10px 0 30px 0; \n            font-size: 18px; \n        }\n        .btn-container { \n            display: flex; \n            flex-direction: column; /* Botones uno encima de otro para mejor lectura en móvil */\n            gap: 15px; \n            justify-content: center; \n        }\n        \n        /* Estilos Base de Botones */\n        .btn {\n            text-decoration: none;\n            padding: 15px 20px;\n            border-radius: 8px;\n            font-weight: bold;\n            font-size: 16px;\n            transition: transform 0.1s, opacity 0.2s;\n            display: block;\n            text-align: center;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .btn:hover { opacity: 0.9; transform: translateY(-1px); }\n        .btn:active { transform: translateY(1px); }\n        \n        /* Botón Posponer (Naranja - Tiempo) */\n        .btn-posponer { \n            background-color: #f59e0b; \n            color: white; \n        }\n        \n        /* Botón Aceptar (Azul - Acción Principal) */\n        .btn-aceptar { \n            background-color: #3b82f6; \n            color: white; \n        }\n\n    </style>\n</head>\n<body>\n\n    <div class=\"card\">\n        <span class=\"icon\">🤔</span>\n        \n        <h2>No se ha rechazado</h2>\n        <p>¿Qué quieres hacer?</p>\n\n        <div class=\"btn-container\">\n            <a href=\"https://n8n.tailwind.es/webhook/historiaPospuesta?requestId={{ $json.requestId }}&idHistoria={{ $('si').item.json.query.idHistoria }}\" class=\"btn btn-posponer\">\n                ⏱️ POSPONER 30 MINUTOS\n            </a>\n\n            <a href=\"https://n8n.tailwind.es/webhook/historiaCamara?requestId={{ $json.requestId }}&idHistoria={{ $('si').item.json.query.idHistoria }}\" class=\"btn btn-aceptar\">\n                ✅ ACEPTAR HISTORIA\n            </a>\n        </div>\n    </div>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        48,
        1584
      ],
      "id": "271a6a4d-599d-455c-b699-86c5d10eed12",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "eb37d92a-214b-46d4-9bab-842c86e8e860",
              "leftValue": "={{ $('si').item.json.query.estado }}",
              "rightValue": "rechazado",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -128,
        1456
      ],
      "id": "b0625766-366e-4d16-8e08-d72254e31bca",
      "name": "If2"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Acción Completada</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 400px;\n            border-top: 6px solid #10b981; /* Verde Éxito */\n        }\n        .icon {\n            font-size: 50px;\n            margin-bottom: 20px;\n            display: block;\n        }\n        h2 { \n            color: #1f2937; \n            margin-top: 0; \n            margin-bottom: 15px;\n            font-size: 24px; \n        }\n        p { \n            color: #4b5563; \n            margin: 10px 0; \n            line-height: 1.5;\n            font-size: 16px; \n        }\n        .doc-name {\n            background-color: #f3f4f6;\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-family: monospace;\n            color: #374151;\n            font-weight: bold;\n        }\n        button {\n            background-color: #10b981;\n            color: white;\n            border: none;\n            padding: 12px 40px;\n            border-radius: 6px;\n            font-weight: bold;\n            font-size: 16px;\n            cursor: pointer;\n            margin-top: 25px;\n            transition: background 0.2s;\n        }\n        button:hover {\n            background-color: #059669;\n        }\n    </style>\n</head>\n<body>\n\n    <div class=\"card\">\n        <span class=\"icon\">✅</span>\n        \n        <h2>Rechazado con éxito</h2>\n        \n        <p>\n            El fallo quedará apuntado en el documento <span class=\"doc-name\">nothingbox</span> de Drive.\n        </p>\n        \n        <button onclick=\"cerrarPestana()\">ACEPTAR</button>\n    </div>\n\n    <script>\n        function cerrarPestana() {\n            // Intenta cerrar la ventana\n            window.close();\n            \n            // Truco adicional para navegadores que bloquean window.close()\n            // si la pestaña no fue abierta por script\n            window.open('','_parent','');\n            window.close();\n\n            // Si el navegador bloquea el cierre (medida de seguridad común),\n            // mostramos un mensaje final.\n            setTimeout(function() {\n                document.body.innerHTML = \"<div style='text-align:center; padding:50px; font-family:sans-serif; color:#4b5563;'><h3>Puedes cerrar esta pestaña manualmente.</h3></div>\";\n            }, 100);\n        }\n    </script>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        48,
        1296
      ],
      "id": "4568449c-95d0-4ca1-9824-cee5dae22b44",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "content": "Rechazar la historia",
        "height": 368,
        "width": 1120,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1008,
        832
      ],
      "id": "b393dd20-107f-48c5-ac15-36dc31f38403",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "No rechazar",
        "height": 192,
        "width": 1136,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        1552
      ],
      "id": "f9957b2d-da8a-4e68-a24a-bb35a129a80b",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "Rechazar\n",
        "height": 192,
        "width": 1136,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        1264
      ],
      "id": "16b3166a-3479-405e-aa50-c151195bf1e4",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 21
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1424,
        32
      ],
      "id": "49fa25e5-f301-4918-84b1-47aa1e2acd37",
      "name": "Ejecución diaria"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Workflow Activado</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f4f7f9;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .card {\n            background: white;\n            padding: 2rem;\n            border-radius: 12px;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n            text-align: center;\n            max-width: 400px;\n        }\n        .icon {\n            font-size: 50px;\n            color: #4CAF50;\n            margin-bottom: 1rem;\n        }\n        h1 {\n            color: #333;\n            font-size: 24px;\n            margin-bottom: 10px;\n        }\n        p {\n            color: #666;\n            line-height: 1.6;\n            margin-bottom: 20px;\n        }\n        .footer-text {\n            font-size: 0.9rem;\n            color: #999;\n            border-top: 1px solid #eee;\n            padding-top: 15px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"card\">\n        <div class=\"icon\">✅</div>\n        <h1>Se ha activado el workflow</h1>\n        <p>Se te enviará un correo con la información necesaria.</p>\n        <div class=\"footer-text\">\n            Ya puedes cerrar esta página de forma segura.\n        </div>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -1568,
        304
      ],
      "id": "7ceb85e6-bb7d-47fd-b8d6-af1d92d4cfb0",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "path": "activarHistoriaCamara",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1760,
        304
      ],
      "id": "df127ed2-3c87-4160-830d-2ab6edc39580",
      "name": "Activación manual remota",
      "webhookId": "2cc4c66e-9fae-4eb2-a1f9-6fbe1abec15e"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1408,
        304
      ],
      "id": "5454579a-3c68-4fb2-8967-515db88c6f90",
      "name": "Wait1",
      "webhookId": "2cd1ba59-5dcf-4ec3-a263-ca35ab61909c"
    },
    {
      "parameters": {
        "content": "CONDICIÓN RECHAZAR\nEs lo que sale en la página de \"Estás seguro de que quieres rechazar la historia?\"",
        "height": 592,
        "width": 2160,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1008,
        1216
      ],
      "id": "934684ff-df35-424b-a3a4-87186ad5bf38",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "Esta es la página de cuando le das a rechazar historia en la página principal, está enlazada directamente al flow de justo abajo, donde se decide si realmente estás seguro de rechazarla",
        "height": 368,
        "width": 304,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        144,
        832
      ],
      "id": "e1a41ebd-fd17-46fd-a8fc-435f4908ac65",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "Esta parte gestiona si el usuario está seguro de rechazar la historia.\nLa opción de rechazar apunta la acción en el informe y no hace nada más.\nLa opción de no rechazar redirige a otra página en la que se elige que se quiere hacer con la historia, si posponerla o subirla, cada uno de esos botones está enlazado por medio de webhooks con las opciones correspondientes para cada uno",
        "height": 368,
        "width": 480,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        464,
        832
      ],
      "id": "146710dc-5953-449c-9284-7287154ae1fb",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "requestId": "={{ $('Edit Fields').item.json[\"token único\"] }}",
            "Estado": "Pendiente"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        752,
        64
      ],
      "id": "437682ee-5a25-49aa-a87c-95bceec4456f",
      "name": "escribir pendiente requestId"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Enlace no válido</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f3f4f6;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            color: #1f2937;\n        }\n        .container {\n            background-color: #ffffff;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 25px rgba(0,0,0,0.05);\n            text-align: center;\n            max-width: 450px;\n            width: 90%;\n            border-top: 5px solid #ef4444; /* Borde rojo superior */\n        }\n        .icon {\n            font-size: 60px;\n            margin-bottom: 15px;\n        }\n        h1 {\n            font-size: 24px;\n            margin-bottom: 10px;\n            color: #111827;\n        }\n        p {\n            font-size: 16px;\n            color: #4b5563;\n            line-height: 1.6;\n            margin-bottom: 25px;\n        }\n        .button {\n            display: inline-block;\n            background-color: #3b82f6;\n            color: #ffffff;\n            padding: 12px 24px;\n            text-decoration: none;\n            border-radius: 8px;\n            font-weight: 600;\n            transition: background-color 0.3s;\n        }\n        .button:hover {\n            background-color: #2563eb;\n        }\n    </style>\n</head>\n<body>\n\n    <div class=\"container\">\n        <div class=\"icon\">🔗🚫</div>\n        \n        <h1>Este link ya ha sido utilizado</h1>\n        \n        <p>Por motivos de seguridad, este enlace es de un solo uso y la acción ya se ha completado anteriormente. No es posible volver a utilizarlo.</p>\n\n    </div>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -1520,
        1056
      ],
      "id": "22844fce-9827-448c-98c2-3fc53ba79dfb",
      "name": "link usado"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
              "leftValue": "={{ $json.Estado }}",
              "rightValue": "Pendiente",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -640,
        912
      ],
      "id": "a8f2261d-1f85-466a-82c9-bea578ef845b",
      "name": "If4"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "requestId",
              "keyValue": "={{ $json.query.requestId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -784,
        912
      ],
      "id": "6ed9fc83-3de6-4eb1-90c0-b3ece5c31121",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
              "leftValue": "={{ $json.Estado }}",
              "rightValue": "Pendiente",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -736,
        496
      ],
      "id": "bc9646ee-9aa2-49e9-98c3-d2129c4d40ed",
      "name": "If6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
              "leftValue": "={{ $json.Estado }}",
              "rightValue": "Pendiente",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1728,
        528
      ],
      "id": "82bf3a57-5a60-4aa3-855b-22c03e5fac1b",
      "name": "If5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bb4ead3b-31e0-42d9-9723-16b6693cfa68",
              "leftValue": "={{ $json.Estado }}",
              "rightValue": "Pendiente",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -672,
        1472
      ],
      "id": "a29ad6e0-9684-41a9-a35d-b330be843b65",
      "name": "If7"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "2"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "requestId": "={{ $json.requestId2 }}",
            "Estado": "Pendiente"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -288,
        896
      ],
      "id": "a80b5b0e-b7a7-447d-89b4-27c34e21d766",
      "name": "generar segunda clave"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "requestId",
              "keyValue": "={{ $json.query.requestId2 }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -800,
        1472
      ],
      "id": "abf5bd4f-80a9-4601-9f5e-b06433f6d1ec",
      "name": "comprobar segunda clave"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "2"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "requestId": "={{ $json.requestId }}",
            "Estado": "Procesado"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -496,
        1456
      ],
      "id": "d8e2fa43-6737-4dc6-b59d-743744cf89b5",
      "name": "bloquear segunda clave"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "contador_no_rechazado": "={{ $json.contador_no_rechazado }}",
            "Estado": "Procesado",
            "contador": "={{ $json.contador }}",
            "requestId": "={{ $json.requestId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        432,
        1296
      ],
      "id": "2108798b-f3e0-49a9-8b66-d1717b5b0ac0",
      "name": "bloquear primera clave"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "requestId",
              "keyValue": "={{ $json.query.requestId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -1872,
        528
      ],
      "id": "aefe1f33-7e4b-412a-acb8-f38b9d5a7615",
      "name": "obtener primera clave"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Estado": "Procesado",
            "requestId": "={{ $json.requestId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -1568,
        512
      ],
      "id": "a722f57b-1ff2-404b-8135-97b8d6f398bc",
      "name": "bloquear primera clave1"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "requestId",
              "keyValue": "={{ $json.query.requestId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -864,
        496
      ],
      "id": "1fe830b2-137f-49c4-a4b4-0b2d4c88b6ed",
      "name": "obtener primera clave1"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Estado": "Procesado",
            "requestId": "={{ $json.requestId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "contador",
              "displayName": "contador",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "contador_no_rechazado",
              "displayName": "contador_no_rechazado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -592,
        480
      ],
      "id": "1bf076e3-c508-4c08-a928-cf2a6474b24b",
      "name": "bloquear primera clave2"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "7t1UIjvma8hSpdjP",
          "mode": "list",
          "cachedResultName": "historia_camaras",
          "cachedResultUrl": "/projects/x5UZcmGQw2OWHuXb/datatables/7t1UIjvma8hSpdjP"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "1"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -304,
        1456
      ],
      "id": "5042cd7e-02a3-4049-bb41-97b12a5dc9aa",
      "name": "obtener primera clave2"
    },
    {
      "parameters": {
        "content": "TRIGGERS",
        "height": 496,
        "width": 848,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1920,
        -48
      ],
      "id": "4f4375d0-41c4-41ed-a3b6-c741343a0498",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "POSPONER",
        "height": 224,
        "width": 992,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2064,
        464
      ],
      "id": "006a245b-7fa0-4621-8d25-93e86638b47d",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "LINK USADO\n\nEste Repond To Webhook es el que se ejecuta cuando el link se clica más de una vez",
        "height": 288,
        "width": 320,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1568,
        912
      ],
      "id": "8e61f5c8-2e86-4d6d-9de9-7b6b787d5cdc",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "content": "░░░░░░░░░░░░░░░░░░░▒▓▓█████████████▓▓▒░░░░░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░▒████▓▓▒▒░▒▒▒░▒▒▒▒▒▒▓▓████▓▒░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░▒███▓░░░░░░░░░░░░░░░░░░░░░░▒███████▓▓▒░░░░░░░░░░░\n░░░░░░░░░▒██▓░░░░▒▒███▓▓▒░░░░░░░░░░░░░▓▓▒▒▒▒▒▓██████▓░░░░░░░\n░░░░░░░▒██▓░░░▓███▓▒░░░░░░░░▒▒▒▒▒▒▒▒▒▒░░░░░░▒▓▓███▓████▒▒░░░\n░░░░░░██▓░░▒▓██▓░░▒▓██████▓░░░░░░░▒░░░░░░▒██▓▒░░░▓███▒▓▒░░░░\n░░░░░██░░▓███▒░░▒██▒░░░░▒▒██▓░░░░░░░░░░░██▒░░░░▒████▒█░░░░░░\n░░░░██░▒▓▒▓▓░░░██░░░░░░░░░░░█▓░░░░░░░░░██░░░░░░▒███░░█▒░░░░░\n░░░▓█░░░░░░░░░██░░░░░░░░░░░░▓█░░░░░░░░██░░░░░░░░░░░░░█▒░░░░░\n░░░█▓░░░░░░░░░█▒░░████░░░░░░░█▒░░░░░░░██░░░░░░░░░░░░███░░░░░\n░░▒█░░░░░░░▒▓▒█▓░▓████▓░░░░░▒█░░░░░░░░▒█▒░░░░░░░░░░██░█▒░░░░\n░░██░░░░░▒▓▒▓▒██▒▒▓▓▓░░░░░░░██░░░░░░░░░▒████▓███████▓░█▒░░░░\n░░█▓░░░░░▒░░░▒░▒██▓▒░░░░░▒██▓░░░░░░░░░░░░░░██▓░░░░░░▒██▓░░░░\n░░█░░░░░░░░░▓▒░░░░▒▓██████▓░░░░░░░░░░░░░░▒██░░░▓█▓▓▒░░░██░░░\n░▒█░░░░░░░░░░░░░░░░░░░░░░░░░░▓▒▓▒▒▒▒▒▓▓▓▓██░░▓█▓░▒▒██▒░░██░░\n░▓█░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▓▓▒░░██░░██▓░▒░▒░██░░▒█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░▒▓▒▒▒▒▒▒▒▒░░░██░░▓█░█▓░█▒█▓█▓░░█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒░▒▒░░▓█▓░░██░█▒▒█▒█▒▓█░░█░░\n░██░░░░░░░░░░░░░░░░░░░░░░░░▒░░░░░░░░░░▓█░░░█▒░░░░▒▒░░▒█░▓█░░\n░▒█░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒░░█▒░░█▒░░░░░░░░▓█░█▓░░\n░░█▓░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓█░░█▒░░░░░░░░█░▒█░░░\n░░▓█░░▒░░▒▒░░▒░░░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░░█▓░█▓░░░\n░░░█▒░░▒░░▒░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░▓█░░█░░░░\n░░░██░░░▒░▒░░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░█░░█▒░░░░░░██░░█░░░░\n░░░░█▓░░░▒░▒░░░░▒▒░░░░░▒▒▒▒▒▒░░░░░░░░░░▒█░▒█░░░░░░░█▒░░█▓░░░\n░░░░▓█░░░░▒▒░░░░░▒▒░░░░░░▒▒▒▓▓▓▒░░░░░░░██░██░░░░░░░██░░▓█░░░\n░░░░░██░░░▒░▒░░░░░▒░░░░░░░░▒░▒▒▓█▒░░░░▒█░░█▓▒▓▓▓▒░░▓█░░░█▒░░\n░░░░░▒█▒░░░▒▒▒░░░░▒░░░░░░░░░░▒▒▒░▒▓░░░██░▒█░░░░▒▓▓░░██░░█▒░░\n░░░░░░▒█▒░░░▒░▒░░░▒░░░░░░▒▒▒░░░░▒▒░░░▒█░░██░░░░░░░█░▒█░░█▒░░\n░░░░░░░▓█░░░▒░▒░░░░▒▒░░░░▓▒▒▓▓▓▒░░▓▒░██░░██▒▒▒▒▓▒▓▓███░░█▒░░\n░░░░░░░░██░░░▒░▒░░░░░▒▒░░░░░░░░▓█▓░░░█▓░░██░▓█░█░█░░█▒░░█▒░░\n░░░░░░░░░██░░░░▒▒░░░░░░▒▒░░░░░░░░▒█▓░█▓░░▓█▒▒█▒█░█▒██░░▒█░░░\n░░░░░░░░░░██▒░░░░▒░░░▒░░░▒▒░░░░░░░░▒▓██░░░██░░░░▒▒██░░░██░░░\n░░░░░░░░░░░▓██░░░░░░░░▒▒░░░▒░░░░░░░░░▓█░░░░▓███▓▓██░░░██░░░░\n░░░░░░░░░░░░░▓██▒░░░░░░▒▒▒▒▒░░░░░░░░░░██░░░░░░▒▒▒░░░░██░░░░░\n░░░░░░░░░░░░░░░▓███▒░░░░░░░▒▒▒▒▒▒▒▒░░░░▓██▒░░░░░░░▒███░░░░░░\n░░░░░░░░░░░░░░░░░▒▓███▓▒░░░░░░░▒░░▒▒▒▒░░░▒██▓██████▓░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░▒████▓▒▒░░░░░░░░░░░░░░░▓██▒░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░▒▓████▓░░░░░░░▓█████▒░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒█████████▒░░░░░░░░░░░░░░░░░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒░░░░░░░░░░░░░░░░░░░░░░░\n",
        "height": 784,
        "width": 624,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3552,
        288
      ],
      "id": "a4b1565b-ed05-444f-b416-395c6c8a5828",
      "name": "Sticky Note14"
    }
  ],
  "pinData": {
    "si": [
      {
        "json": {
          "headers": {
            "connection": "upgrade",
            "host": "n8n.tailwind.es",
            "x-forwarded-for": "2.136.43.122",
            "x-forwarded-proto": "https",
            "sec-ch-ua": "\"Brave\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "upgrade-insecure-requests": "1",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
            "sec-gpc": "1",
            "accept-language": "es-ES,es;q=0.6",
            "sec-fetch-site": "cross-site",
            "sec-fetch-mode": "navigate",
            "sec-fetch-user": "?1",
            "sec-fetch-dest": "document",
            "accept-encoding": "gzip, deflate, br, zstd",
            "cookie": "rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX19G9hj2oHUljiLMDFDD4NPAhx36zLECAVM%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX19DZj0rYYRDnJqpinHJ5WdeJvAQiTnyTb4%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22%24device_id%22%3A%22019b59c2-251b-7f9d-94c9-0e7af88287b0%22%2C%22distinct_id%22%3A%220f6825be298b3a005d52154ed2c929ac7758de54b6ab4a8d7eb7a8e83f623918%2308853e58-b9e7-4eaa-a226-f2a3e30187ec%22%2C%22%24sesid%22%3A%5B1768377126820%2C%22019bbb68-e0bb-712c-934e-b5fd44a85811%22%2C1768375771320%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fn8n.tailwind.es%2Fsignin%3Fredirect%3D%25252F%22%7D%7D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2B2XkCoj75cgZm9OxVywFa4DDsUIfmfNSRo06nN%2B3HqIl%2FoJ8jzekklJ7X4rnNLtdPHYAEEL5Ic8A%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX19WWhBBX2s7uD0JrIHBIahGmAouPQxLoDhELsiKGN60aby9F1Xkl%2BokZ43TqxhOry33l%2BIWr1dui6acPPN3YWAjTr5hZVlxngcjzsLKcGhwEegYq%2FeVX8pWk5sD2Ac1feSMEiCStL7DYpTDnbO2UqvoTYv1cFBfrFM%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19J4H8jPTQ9kVE1aa8bs476oQ8rjLQ9JqKKz12x628SOMKvykFWpOsbH68QDUrJJ4AtQgDsbaHJMi%2BM%2BgBQfJAXECXbiu52uBBG%2BBR%2FiYDQDiyuihOpWgLF1wk1zuvHM2zPmJpxPb%2Fyx8mUu94DLmMWF%2BQAYFP%2FP1o%3D; rl_session=RudderEncrypt%3AU2FsdGVkX1%2FVHYPulftiB6yrpulwZ2ywc2qjr%2FYElplbI1Ma1iDwSBN%2BF7BSAS3ubah15PdLWEYxzrWDJaOCgXlDScFYBrNYvrF5%2FndX%2BuN0GS5DCg0%2F0exhSaockJGD8e1tTO4pWlrBYG8ViRI2vg%3D%3D"
          },
          "params": {},
          "query": {
            "origen": "historiaWebcam",
            "contenido": "HistoriaRechazada",
            "idHistoria": "https://res.cloudinary.com/dglub1vnw/video/upload/vc_h264,ac_aac,c_pad,w_1080,h_1920,b_blurred:400,du_30/l_text:Courier_45_bold:ZONA BORREGUILES,co_black,e_outline:3/fl_layer_apply,g_north_west,x_10,y_670/l_text:Courier_45_bold:ZONA BORREGUILES,co_white/fl_layer_apply,g_north_west,x_13,y_673/rh4cddsdrekdf71s6ixn.mp4",
            "estado": "noRechazado",
            "requestId2": "202602030348411971"
          },
          "body": {},
          "webhookUrl": "https://n8n.tailwind.es/webhook/rechazarSi",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-12-11T11:14:07.991Z",
      "createdAt": "2025-12-11T11:14:07.991Z",
      "role": "workflow:owner",
      "workflowId": "CBcjY0JF5P9ZjxEE",
      "projectId": "x5UZcmGQw2OWHuXb"
    }
  ],
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    },
    "node:Ejecución diaria": {
      "recurrenceRules": []
    }
  },
  "tags": [],
  "triggerCount": 6,
  "updatedAt": "2026-02-04T15:14:51.303Z",
  "versionId": "57d925b8-b8c9-4a86-ad37-7f0f50606019"
}