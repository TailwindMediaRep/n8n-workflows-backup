{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-01-30T10:45:50.000Z",
    "createdAt": "2026-01-30T10:45:42.486Z",
    "versionId": "70ae61e7-3847-4bc7-a755-381a42e04c37",
    "workflowId": "cnuDKnZrHmDy4QDh",
    "nodes": [
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "documentId": {
            "__rl": true,
            "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
            "mode": "list",
            "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 512939465,
            "mode": "list",
            "cachedResultName": "Respuestas de formulario",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
          },
          "event": "rowAdded",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTrigger",
        "typeVersion": 1,
        "position": [
          -752,
          -240
        ],
        "id": "7ad34ec0-9110-48cf-90b6-691ccbf01cbd",
        "name": "Google Sheets Trigger",
        "credentials": {
          "googleSheetsTriggerOAuth2Api": {
            "id": "4HkdJcbjLdqN2Ie3",
            "name": "Google Sheets Trigger info@tailwind.es"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "d56c1a5f-1dc2-4a0d-86fb-e47d652cbd19",
                "name": "nombre_codificado",
                "value": "={{ ($json[\"Nombre\"]) }}",
                "type": "string"
              },
              {
                "id": "e4352ddf-8332-45d5-8e3b-397216fa0b9c",
                "name": "apellido_codificado",
                "value": "={{ $json[\"Apellido\"] }}",
                "type": "string"
              },
              {
                "id": "d74065a3-f051-49f0-ae26-f4412aefdd88",
                "name": "telefono",
                "value": "={{ $json[\"Tel√©fono M√≥vil\"] }}",
                "type": "number"
              },
              {
                "id": "a50d5b0a-c301-4ff3-916e-8c2a0508d9ef",
                "name": "link_aprobar",
                "value": "==https://n8n.tailwind.es/webhook/aprobar-profesor?email={{ $json[\"Correo Electr√≥nico\"] }}&nombre={{ encodeURIComponent($json.Nombre) }}&apellido={{ encodeURIComponent($json.Apellido) }}&telefono={{ encodeURIComponent($json[\"Tel√©fono M√≥vil\"]) }}&expiracion={{ $now.plus({hours: 48}).toMillis() }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -544,
          -240
        ],
        "id": "7166c0e6-3862-4388-aab4-3633ecfc45a4",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "path": "aprobar-profesor",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -800,
          160
        ],
        "id": "0257e178-b89d-423f-adcc-f1054d17ebac",
        "name": "Webhook",
        "webhookId": "920a92c4-3002-455f-8e74-4289a8aee57c"
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
          "query": "mutation customerCreate($input: CustomerInput!) {\n  customerCreate(input: $input) {\n    customer {\n      id\n      email\n      phone\n      firstName\n      lastName\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"input\": {\n    \"firstName\": \"{{ $json.Nombre }}\",\n    \"lastName\": \"{{ $json.Apellido }}\",\n    \"email\": \"{{ $json[\"Correo Electr√≥nico\"] }}\",\n    \"phone\": \"{{ $json[\"Tel√©fono M√≥vil\"] }}\",\n    \"tags\": [\"Profesor\", \"DescuentoProfesor\"],\n    \"emailMarketingConsent\": {\n      \"marketingState\": \"SUBSCRIBED\",\n      \"marketingOptInLevel\": \"SINGLE_OPT_IN\"\n    },\n    \"note\": \"Alta validada autom√°ticamente v√≠a WhatsApp el {{ $now.toFormat('dd/MM/yyyy') }}\"\n  }\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          -96,
          128
        ],
        "id": "e9db9940-52f1-4808-b41a-190c763d237e",
        "name": "GraphQL",
        "credentials": {
          "httpHeaderAuth": {
            "id": "THkhgrtze1uBo6Ft",
            "name": "Token Informes Shopify"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Confirmaci√≥n</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f0fdf4;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 10px;\">‚úÖ</div>\n\n        <h1 style=\"color: #16a34a; margin: 0 0 15px 0; font-size: 28px;\">¬°Hecho!</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Se ha creado la cuenta en Shopify para:\n        </p>\n\n        <div style=\"background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">\n            <h3 style=\"margin: 0; color: #1f2937; font-size: 18px; word-wrap: break-word;\">\n                {{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}\n            </h3>\n        </div>\n\n        <p style=\"color: #6b7280; font-size: 14px; margin: 0;\">\n            üì© Se le ha enviado el correo de bienvenida.\n        </p>\n    </div>\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          720,
          192
        ],
        "id": "7093e262-a20b-4d2a-af66-afb1179f1e76",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://services.leadconnectorhq.com/hooks/50G0wYa58T0KnxpEocxd/webhook-trigger/343b67dc-f4a0-4162-843d-9dd404db2b05",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nombre\": \"{{ $json.nombre_codificado }}\",\n  \"apellido\": \"{{ $json.apellido_codificado }}\",\n  \"nombre_completo\": \"{{ $json.nombre_codificado }} {{ $json.apellido_codificado }}\",\n  \"email\": \"{{ $('Google Sheets Trigger').item.json['Correo Electr√≥nico'] }}\",\n  \"telefono\": \"{{ $('Google Sheets Trigger').item.json['Tel√©fono M√≥vil'] }}\",\n  \"doc_vida_laboral\": \"{{ $('Google Sheets Trigger').item.json['Adjuntar Vida Laboral Actual'] }}\",\n  \"doc_titulo\": \"{{ $('Google Sheets Trigger').item.json['Adjuntar T√≠tulo / Certificaci√≥n de Profesor'] }}\",\n  \"link_aprobar\": \"{{ $json.link_aprobar }}\"\n}\n",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -352,
          -240
        ],
        "id": "a6c03a51-6008-4851-940e-89f821e808d6",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "content": "## Respuesta Formulario Google\n**Coge la respuesta mediante una hoja de calculo de info@tailwind.es y manda los datos de GoHighLevel (crm) para que mande el mensaje de Whatsapp desde ah√≠**",
          "height": 288,
          "width": 1136,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -848,
          -368
        ],
        "id": "6e93fbd5-e446-4120-b6bf-7ed09395520c",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "## Validaci√≥n Aprobada\n**Aprueba el link de validaci√≥n, crea la cuenta de Shopify para que pueda usar el 40%PROFESOR y le manda un mensaje de que ha sido aceptado mediante correo electr√≥nico**",
          "height": 528,
          "width": 2368,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -848,
          -64
        ],
        "id": "43e75f41-d3b7-4d36-89d8-d17b3659dc10",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Confirmaci√≥n</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f0fdf4;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 10px;\">‚úÖ</div>\n\n        <h1 style=\"color: #16a34a; margin: 0 0 15px 0; font-size: 28px;\">¬°Hecho!</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Se ha actualizado la cuenta en Shopify para:\n        </p>\n\n        <div style=\"background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">\n            <h3 style=\"margin: 0; color: #1f2937; font-size: 18px; word-wrap: break-word;\">\n                {{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}\n            </h3>\n        </div>\n\n        <p style=\"color: #6b7280; font-size: 14px; margin: 0;\">\n            üì© Se le ha enviado el correo de bienvenida.\n        </p>\n    </div>\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          1296,
          32
        ],
        "id": "08ff5ebf-0680-4bce-a7d0-904cdb8e5f35",
        "name": "Respond to Webhook1"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Webhook').item.json.query.email }}",
          "subject": "‚úÖ Alta Aprobada: Cuenta Profesional Rules Shop",
          "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">\n    <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">\n        \n        <div style=\"background-color: #000000; padding: 20px; text-align: center;\">\n            <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>\n        </div>\n\n        <div style=\"padding: 40px 30px;\">\n            <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $json.data.customerUpdate.customer.firstName }} {{ $json.data.customerUpdate.customer.lastName }}</strong>,</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">¬°Todo listo! Hemos <strong>actualizado tu ficha de cliente</strong> correctamente.</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">Al comprobar tus datos, vimos que ya ten√≠as una cuenta con nosotros. Tu perfil ha sido marcado como <strong style=\"color: #16a34a;\">AUTORIZADO ‚úÖ</strong> en tu usuario actual.</p>\n\n            <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">\n                <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #166534;\">Tu nivel de descuento</p>\n                \n                <div style=\"font-size: 24px; font-weight: bold; color: #15803d; margin: 15px 0; line-height: 1.3;\">\n                    40% en OAKLEY y<br>THE NORTH FACE\n                </div>\n                \n                <div style=\"border-top: 1px solid #bbf7d0; width: 60%; margin: 10px auto;\"></div>\n                \n                <div style=\"font-size: 20px; font-weight: bold; color: #15803d; margin-top: 10px;\">\n                    20% en Equipamiento\n                </div>\n            </div>\n            <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #d1d5db;\">\n                <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">‚ö†Ô∏è RESTRICCIONES DEL PROGRAMA:</h3>\n                <ul style=\"padding-left: 20px; margin-bottom: 0;\">\n                    <li style=\"margin-bottom: 8px;\">Este programa es un privilegio personal e intransferible.</li>\n                    <li style=\"margin-bottom: 8px;\">No permite compras para amigos, familiares ni regalos a terceros.</li>\n                    <li>Queda prohibida la reventa de productos adquiridos con este descuento.</li>\n                </ul>\n                <p style=\"margin-top: 15px; margin-bottom: 0; font-weight: bold; font-size: 12px;\">AL PARTICIPAR EN ESTE PROGRAMA, USTED ACEPTA ESTOS T√âRMINOS.</p>\n            </div>\n\n            <p style=\"margin-top: 30px; font-size: 16px;\">¬°Nos vemos en la nieve! ‚ùÑÔ∏è</p>\n            <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>\n        </div>\n        \n        <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">\n            <p style=\"margin: 0;\">Mensaje autom√°tico enviado desde Rules Shop.</p>\n        </div>\n    </div>\n</div>",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          912,
          32
        ],
        "id": "90dec506-0a68-4200-9fd4-bf78490b83b7",
        "name": "cuenta_existente",
        "webhookId": "1693779c-aabc-4da9-b317-e9623a9166d2",
        "credentials": {
          "gmailOAuth2": {
            "id": "2piqh63wCF24vapD",
            "name": "profesionales@rules-shop.es"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('Webhook').item.json.query.email }}",
          "subject": "‚úÖ Alta Aprobada: Cuenta Profesional Rules Shop",
          "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">\n    <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">\n        \n        <div style=\"background-color: #000000; padding: 20px; text-align: center;\">\n            <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>\n        </div>\n\n        <div style=\"padding: 40px 30px;\">\n            <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}</strong>,</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">¬°Traemos buenas noticias! Tu perfil profesional ha sido <strong style=\"color: #16a34a;\">AUTORIZADO ‚úÖ</strong>.</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">Ya puedes usar este mismo correo electr√≥nico para identificarte. Tu tarifa especial se aplicar√° autom√°ticamente.</p>\n\n            <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">\n                <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #166534;\">Tu nivel de descuento</p>\n                \n                <div style=\"font-size: 24px; font-weight: bold; color: #15803d; margin: 15px 0; line-height: 1.3;\">\n                    40% en OAKLEY y<br>THE NORTH FACE\n                </div>\n                \n                <div style=\"border-top: 1px solid #bbf7d0; width: 60%; margin: 10px auto;\"></div>\n                \n                <div style=\"font-size: 20px; font-weight: bold; color: #15803d; margin-top: 10px;\">\n                    20% en Equipamiento\n                </div>\n            </div>\n            <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #d1d5db;\">\n                <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">‚ö†Ô∏è RESTRICCIONES DEL PROGRAMA:</h3>\n                <ul style=\"padding-left: 20px; margin-bottom: 0;\">\n                    <li style=\"margin-bottom: 8px;\">Este programa es un privilegio personal e intransferible.</li>\n                    <li style=\"margin-bottom: 8px;\">No permite compras para amigos, familiares ni regalos a terceros.</li>\n                    <li>Queda prohibida la reventa de productos adquiridos con este descuento.</li>\n                </ul>\n                <p style=\"margin-top: 15px; margin-bottom: 0; font-weight: bold; font-size: 12px;\">AL PARTICIPAR EN ESTE PROGRAMA, USTED ACEPTA ESTOS T√âRMINOS.</p>\n            </div>\n\n            <p style=\"margin-top: 30px; font-size: 16px;\">¬°Nos vemos en la nieve! ‚ùÑÔ∏è</p>\n            <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>\n        </div>\n        \n        <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">\n            <p style=\"margin: 0;\">Mensaje autom√°tico enviado desde Rules Shop.</p>\n        </div>\n    </div>\n</div>",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          272,
          192
        ],
        "id": "c9751bd3-9bd1-41cd-85cc-4aaee7940a73",
        "name": "cuenta_creada",
        "webhookId": "1693779c-aabc-4da9-b317-e9623a9166d2",
        "credentials": {
          "gmailOAuth2": {
            "id": "2piqh63wCF24vapD",
            "name": "profesionales@rules-shop.es"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "8b16a42d-b5d8-4566-b621-148f30b39911",
                "leftValue": "={{ $('Webhook').item.json.query.expiracion.toNumber() }}",
                "rightValue": "={{ $now.toMillis() }}",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -304,
          288
        ],
        "id": "084ffaf6-da30-4f74-92e7-d169a22b429b",
        "name": "Verificar_Caducidad"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Enlace Caducado</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #fef2f2;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 15px;\">‚è≥</div>\n        \n        <h1 style=\"color: #dc2626; margin: 0 0 15px 0; font-size: 24px;\">Tiempo Agotado</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Este enlace de validaci√≥n ha caducado porque han pasado m√°s de 48 horas.\n        </p>\n        \n        <div style=\"background-color: #fee2e2; padding: 15px; border-radius: 8px; color: #991b1b; font-size: 14px; line-height: 1.4;\">\n            üîí Por seguridad, los documentos ya no pueden ser procesados mediante este link.\n        </div>\n    </div>\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          80,
          304
        ],
        "id": "201815e8-520f-4f99-a1dc-389365815099",
        "name": "Respond to Webhook2"
      },
      {
        "parameters": {
          "sendTo": "={{ $json.query.email }}",
          "subject": "üìÑ Actualizaci√≥n sobre tu solicitud: Cuenta Profesional Rules Shop",
          "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">     <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">                  <div style=\"background-color: #000000; padding: 20px; text-align: center;\">             <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>         </div>          <div style=\"padding: 40px 30px;\">             <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $json.query.nombre }} {{ $json.query.apellido }}</strong>,</p>                          <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">                 Gracias por tu inter√©s en formar parte del programa de profesionales de Rules Shop y por enviarnos tu documentaci√≥n.             </p>                          <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">                 Nuestro equipo ha revisado tu solicitud detalladamente. En esta ocasi√≥n, <strong>no hemos podido validar tu perfil</strong> para acceder a las tarifas especiales del programa PRO.             </p>              <div style=\"background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">                 <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #991b1b;\">Estado de la solicitud</p>                 <div style=\"font-size: 24px; font-weight: bold; color: #dc2626; margin: 10px 0;\">NO APROBADA ‚úã</div>                 <p style=\"font-size: 14px; color: #7f1d1d; margin: 0;\">La documentaci√≥n aportada no cumple con los requisitos actuales.</p>             </div>              <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #9ca3af;\">                 <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">¬øCrees que es un error?</h3>                 <p style=\"margin: 0; line-height: 1.5;\">                     Si consideras que ha habido una equivocaci√≥n o dispones de documentaci√≥n actualizada (T√≠tulo vigente o Vida laboral reciente), te invitamos a responder a este correo adjuntando los nuevos archivos para una segunda revisi√≥n.                 </p>             </div>              <p style=\"margin-top: 30px; font-size: 16px;\">                 Sigues siendo bienvenido en nuestra tienda y comunidad. ¬°Esperamos verte pronto disfrutando de la temporada!             </p>                          <p style=\"margin-top: 30px; font-size: 16px;\">Un saludo,</p>             <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>         </div>                  <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">             <p style=\"margin: 0;\">&copy; Rules Shop. Sierra Nevada.</p>         </div>     </div> </div>",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -96,
          304
        ],
        "id": "46434455-9b52-49de-adf3-98a0321ae548",
        "name": "Send a message",
        "webhookId": "a8ec28c0-85f5-441d-9bcd-a3152df9be95",
        "credentials": {
          "gmailOAuth2": {
            "id": "2piqh63wCF24vapD",
            "name": "profesionales@rules-shop.es"
          }
        }
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
          "query": "query findCustomer($busqueda_shopify: String!) {\n  customers(first: 1, query: $busqueda_shopify) {\n    edges {\n      node {\n        id\n        tags\n        email\n        phone\n      }\n    }\n  }\n}",
          "variables": "={\n  \"busqueda_shopify\": \"{{ [ $json['mi_email'] ? 'email:' + $json['mi_email'] : null, $json['mi_telefono'] ? 'phone:' + $json['mi_telefono'] : null ].filter(v => v).join(' OR ') }}\"\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          480,
          32
        ],
        "id": "7884e8ab-01e6-4870-ae2f-c9a0f6ec816b",
        "name": "Buscar_ID_Cliente",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OPt2Cl0dnwcU4qRk",
            "name": "ShopifyInformes"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
            "mode": "list",
            "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 512939465,
            "mode": "list",
            "cachedResultName": "Respuestas de formulario",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "Correo Electr√≥nico",
                "lookupValue": "={{ $json.query.email.trim() }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -640,
          160
        ],
        "id": "43538da5-809f-446e-9cb2-dc0405cb3bb7",
        "name": "Get row(s) in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RCuKUCifcA4jENcY",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Enlace Ya Utilizado</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #fffbeb; /* Fondo Crema */\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 15px;\">‚ö†Ô∏è</div>\n        \n        <h1 style=\"color: #b45309; margin: 0 0 15px 0; font-size: 24px;\">Enlace ya utilizado</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Esta solicitud ya fue validada anteriormente.\n        </p>\n        \n        <div style=\"background-color: #fef3c7; padding: 15px; border-radius: 8px; color: #92400e; font-size: 14px; line-height: 1.4;\">\n            ‚úÖ El profesor ya deber√≠a tener sus permisos activos en Shopify. No es necesaria ninguna acci√≥n adicional.\n        </div>\n    </div>\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          -304,
          64
        ],
        "id": "16d5d421-37ed-4c9a-be44-d0f46e8c3694",
        "name": "Respond to Webhook3"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "b1e06889-96b0-4a31-b619-398f5d8c9105",
                "leftValue": "={{ $json[\"Estado Validaci√≥n\"] }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -480,
          160
        ],
        "id": "71288c43-1b35-4991-9617-83dfe097af79",
        "name": "Estado_Validacion"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "9bf25cb0-2a3d-4f83-87e2-9c615918f2ea",
                "leftValue": "={{ $json.data.customerCreate.userErrors[0].message }}",
                "rightValue": "Email has already been taken",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              },
              {
                "id": "8943729c-107b-4206-aff1-cb17e33e5eeb",
                "leftValue": "={{ $json.data.customerCreate.userErrors[0].message }}",
                "rightValue": "Phone has already been taken",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          80,
          128
        ],
        "id": "e471444b-f471-49d9-bb4f-de659a9ebae7",
        "name": "Si_Existe"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
            "mode": "list",
            "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 512939465,
            "mode": "list",
            "cachedResultName": "Respuestas de formulario",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $('Get row(s) in sheet').item.json.row_number}}",
              "Estado Validaci√≥n": "VALIDADO"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Marca temporal",
                "displayName": "Marca temporal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Apellido",
                "displayName": "Apellido",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Correo Electr√≥nico",
                "displayName": "Correo Electr√≥nico",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Tel√©fono M√≥vil",
                "displayName": "Tel√©fono M√≥vil",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Adjuntar Vida Laboral Actual",
                "displayName": "Adjuntar Vida Laboral Actual",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
                "displayName": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Aceptaci√≥n de condiciones",
                "displayName": "Aceptaci√≥n de condiciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Estado Validaci√≥n",
                "displayName": "Estado Validaci√≥n",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1120,
          32
        ],
        "id": "40ba9e2d-8950-4fa2-bf34-1a3e5221bcc6",
        "name": "Update row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RCuKUCifcA4jENcY",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
            "mode": "list",
            "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 512939465,
            "mode": "list",
            "cachedResultName": "Respuestas de formulario",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $('Get row(s) in sheet').item.json.row_number }}",
              "Estado Validaci√≥n": "VALIDADO"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Marca temporal",
                "displayName": "Marca temporal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Apellido",
                "displayName": "Apellido",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Correo Electr√≥nico",
                "displayName": "Correo Electr√≥nico",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Tel√©fono M√≥vil",
                "displayName": "Tel√©fono M√≥vil",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Adjuntar Vida Laboral Actual",
                "displayName": "Adjuntar Vida Laboral Actual",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
                "displayName": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Aceptaci√≥n de condiciones",
                "displayName": "Aceptaci√≥n de condiciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Estado Validaci√≥n",
                "displayName": "Estado Validaci√≥n",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          480,
          192
        ],
        "id": "88c9b20b-20c3-462a-b6c6-acf00666d7ee",
        "name": "Update row in sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RCuKUCifcA4jENcY",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
          "query": "mutation customerUpdate($input: CustomerInput!) {\n  customerUpdate(input: $input) {\n    customer {\n      id\n      email\n      firstName\n      lastName\n      tags\n      phone\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"input\": {\n    \"id\": \"{{ $('Buscar_ID_Cliente').item.json.data.customers.edges[0].node.id }}\",\n    \"firstName\": \"{{ $('Webhook').item.json.query.nombre }}\",\n    \"lastName\": \"{{ $('Webhook').item.json.query.apellido }}\",\n    \n    \"tags\": \"{{ ($('Buscar_ID_Cliente').item.json.data.customers.edges[0].node.tags || []).concat(['Profesor', 'DescuentoProfesor']) }}\",\n    \n    \"note\": \"Perfil actualizado y validado autom√°ticamente v√≠a WhatsApp el {{ $now.toFormat('dd/MM/yyyy') }}\",\n    \"phone\": \"{{ $('Webhook').item.json.query.telefono && $('Webhook').item.json.query.telefono.toString().replace(/\\D/g,'').length > 8 ? ($('Webhook').item.json.query.telefono.toString().includes('+') ? $('Webhook').item.json.query.telefono.toString().replace(/ /g,'') : '+34' + $('Webhook').item.json.query.telefono.toString().replace(/\\D/g,'')) : null }}\"\n  }\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          720,
          32
        ],
        "id": "20b324c0-a79a-434e-864f-8aeb88eb1a38",
        "name": "Actualizar_Cliente",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OPt2Cl0dnwcU4qRk",
            "name": "ShopifyInformes"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Capturamos los datos limpios\nconst email = $('Webhook').item.json.query.email;\nconst telefono = $('Webhook').item.json.query.telefono;\n\nreturn {\n  // Estas dos son para que t√∫ las veas separadas en el output:\n  \"mi_email\": email,\n  \"mi_telefono\": telefono,\n  \n  // Esta es la variable combinada que OBLIGATORIAMENTE necesita Shopify:\n  \"busqueda_shopify\": `email:${email} OR phone:${telefono}`\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          272,
          32
        ],
        "id": "dc4ffbab-3b2b-4f6f-86e8-e0b06b329928",
        "name": "Code in JavaScript"
      }
    ],
    "connections": {
      "Google Sheets Trigger": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GraphQL": {
        "main": [
          [
            {
              "node": "Si_Existe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "cuenta_existente": {
        "main": [
          [
            {
              "node": "Update row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "cuenta_creada": {
        "main": [
          [
            {
              "node": "Update row in sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verificar_Caducidad": {
        "main": [
          [
            {
              "node": "GraphQL",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Send a message": {
        "main": [
          [
            {
              "node": "Respond to Webhook2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Buscar_ID_Cliente": {
        "main": [
          [
            {
              "node": "Actualizar_Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet": {
        "main": [
          [
            {
              "node": "Estado_Validacion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Estado_Validacion": {
        "main": [
          [
            {
              "node": "Respond to Webhook3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Verificar_Caducidad",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si_Existe": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "cuenta_creada",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet": {
        "main": [
          [
            {
              "node": "Respond to Webhook1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet1": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar_Cliente": {
        "main": [
          [
            {
              "node": "cuenta_existente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Buscar_ID_Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Tailwind Media",
    "name": "Version 70ae61e7",
    "description": "",
    "autosaved": false
  },
  "activeVersionId": "70ae61e7-3847-4bc7-a755-381a42e04c37",
  "connections": {
    "Google Sheets Trigger": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GraphQL": {
      "main": [
        [
          {
            "node": "Si_Existe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cuenta_existente": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cuenta_creada": {
      "main": [
        [
          {
            "node": "Update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar_Caducidad": {
      "main": [
        [
          {
            "node": "GraphQL",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar_ID_Cliente": {
      "main": [
        [
          {
            "node": "Actualizar_Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Estado_Validacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Estado_Validacion": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verificar_Caducidad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si_Existe": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "cuenta_creada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_Cliente": {
      "main": [
        [
          {
            "node": "cuenta_existente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Buscar_ID_Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-12T07:23:55.975Z",
  "id": "cnuDKnZrHmDy4QDh",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Validacion_Profesores",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
          "mode": "list",
          "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 512939465,
          "mode": "list",
          "cachedResultName": "Respuestas de formulario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
        },
        "event": "rowAdded",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        -752,
        -240
      ],
      "id": "7ad34ec0-9110-48cf-90b6-691ccbf01cbd",
      "name": "Google Sheets Trigger",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "4HkdJcbjLdqN2Ie3",
          "name": "Google Sheets Trigger info@tailwind.es"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d56c1a5f-1dc2-4a0d-86fb-e47d652cbd19",
              "name": "nombre_codificado",
              "value": "={{ ($json[\"Nombre\"]) }}",
              "type": "string"
            },
            {
              "id": "e4352ddf-8332-45d5-8e3b-397216fa0b9c",
              "name": "apellido_codificado",
              "value": "={{ $json[\"Apellido\"] }}",
              "type": "string"
            },
            {
              "id": "d74065a3-f051-49f0-ae26-f4412aefdd88",
              "name": "telefono",
              "value": "={{ $json[\"Tel√©fono M√≥vil\"] }}",
              "type": "number"
            },
            {
              "id": "a50d5b0a-c301-4ff3-916e-8c2a0508d9ef",
              "name": "link_aprobar",
              "value": "==https://n8n.tailwind.es/webhook/aprobar-profesor?email={{ $json[\"Correo Electr√≥nico\"] }}&nombre={{ encodeURIComponent($json.Nombre) }}&apellido={{ encodeURIComponent($json.Apellido) }}&telefono={{ encodeURIComponent($json[\"Tel√©fono M√≥vil\"]) }}&expiracion={{ $now.plus({hours: 48}).toMillis() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -544,
        -240
      ],
      "id": "7166c0e6-3862-4388-aab4-3633ecfc45a4",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "path": "aprobar-profesor",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -800,
        160
      ],
      "id": "0257e178-b89d-423f-adcc-f1054d17ebac",
      "name": "Webhook",
      "webhookId": "920a92c4-3002-455f-8e74-4289a8aee57c"
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
        "query": "mutation customerCreate($input: CustomerInput!) {\n  customerCreate(input: $input) {\n    customer {\n      id\n      email\n      phone\n      firstName\n      lastName\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"input\": {\n    \"firstName\": \"{{ $json.Nombre }}\",\n    \"lastName\": \"{{ $json.Apellido }}\",\n    \"email\": \"{{ $json[\"Correo Electr√≥nico\"] }}\",\n    \"phone\": \"{{ $json[\"Tel√©fono M√≥vil\"] }}\",\n    \"tags\": [\"Profesor\", \"DescuentoProfesor\"],\n    \"emailMarketingConsent\": {\n      \"marketingState\": \"SUBSCRIBED\",\n      \"marketingOptInLevel\": \"SINGLE_OPT_IN\"\n    },\n    \"note\": \"Alta validada autom√°ticamente v√≠a WhatsApp el {{ $now.toFormat('dd/MM/yyyy') }}\"\n  }\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        -96,
        128
      ],
      "id": "e9db9940-52f1-4808-b41a-190c763d237e",
      "name": "GraphQL",
      "credentials": {
        "httpHeaderAuth": {
          "id": "THkhgrtze1uBo6Ft",
          "name": "Token Informes Shopify"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Confirmaci√≥n</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f0fdf4;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 10px;\">‚úÖ</div>\n\n        <h1 style=\"color: #16a34a; margin: 0 0 15px 0; font-size: 28px;\">¬°Hecho!</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Se ha creado la cuenta en Shopify para:\n        </p>\n\n        <div style=\"background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">\n            <h3 style=\"margin: 0; color: #1f2937; font-size: 18px; word-wrap: break-word;\">\n                {{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}\n            </h3>\n        </div>\n\n        <p style=\"color: #6b7280; font-size: 14px; margin: 0;\">\n            üì© Se le ha enviado el correo de bienvenida.\n        </p>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        720,
        192
      ],
      "id": "7093e262-a20b-4d2a-af66-afb1179f1e76",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://services.leadconnectorhq.com/hooks/50G0wYa58T0KnxpEocxd/webhook-trigger/343b67dc-f4a0-4162-843d-9dd404db2b05",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nombre\": \"{{ $json.nombre_codificado }}\",\n  \"apellido\": \"{{ $json.apellido_codificado }}\",\n  \"nombre_completo\": \"{{ $json.nombre_codificado }} {{ $json.apellido_codificado }}\",\n  \"email\": \"{{ $('Google Sheets Trigger').item.json['Correo Electr√≥nico'] }}\",\n  \"telefono\": \"{{ $('Google Sheets Trigger').item.json['Tel√©fono M√≥vil'] }}\",\n  \"doc_vida_laboral\": \"{{ $('Google Sheets Trigger').item.json['Adjuntar Vida Laboral Actual'] }}\",\n  \"doc_titulo\": \"{{ $('Google Sheets Trigger').item.json['Adjuntar T√≠tulo / Certificaci√≥n de Profesor'] }}\",\n  \"link_aprobar\": \"{{ $json.link_aprobar }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -352,
        -240
      ],
      "id": "a6c03a51-6008-4851-940e-89f821e808d6",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "content": "## Respuesta Formulario Google\n**Coge la respuesta mediante una hoja de calculo de info@tailwind.es y manda los datos de GoHighLevel (crm) para que mande el mensaje de Whatsapp desde ah√≠**",
        "height": 288,
        "width": 1136,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -848,
        -368
      ],
      "id": "6e93fbd5-e446-4120-b6bf-7ed09395520c",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Validaci√≥n Aprobada\n**Aprueba el link de validaci√≥n, crea la cuenta de Shopify para que pueda usar el 40%PROFESOR y le manda un mensaje de que ha sido aceptado mediante correo electr√≥nico**",
        "height": 528,
        "width": 2368,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -848,
        -64
      ],
      "id": "43e75f41-d3b7-4d36-89d8-d17b3659dc10",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Confirmaci√≥n</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f0fdf4;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 10px;\">‚úÖ</div>\n\n        <h1 style=\"color: #16a34a; margin: 0 0 15px 0; font-size: 28px;\">¬°Hecho!</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Se ha actualizado la cuenta en Shopify para:\n        </p>\n\n        <div style=\"background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">\n            <h3 style=\"margin: 0; color: #1f2937; font-size: 18px; word-wrap: break-word;\">\n                {{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}\n            </h3>\n        </div>\n\n        <p style=\"color: #6b7280; font-size: 14px; margin: 0;\">\n            üì© Se le ha enviado el correo de bienvenida.\n        </p>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        1296,
        32
      ],
      "id": "08ff5ebf-0680-4bce-a7d0-904cdb8e5f35",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Webhook').item.json.query.email }}",
        "subject": "‚úÖ Alta Aprobada: Cuenta Profesional Rules Shop",
        "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">\n    <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">\n        \n        <div style=\"background-color: #000000; padding: 20px; text-align: center;\">\n            <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>\n        </div>\n\n        <div style=\"padding: 40px 30px;\">\n            <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $json.data.customerUpdate.customer.firstName }} {{ $json.data.customerUpdate.customer.lastName }}</strong>,</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">¬°Todo listo! Hemos <strong>actualizado tu ficha de cliente</strong> correctamente.</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">Al comprobar tus datos, vimos que ya ten√≠as una cuenta con nosotros. Tu perfil ha sido marcado como <strong style=\"color: #16a34a;\">AUTORIZADO ‚úÖ</strong> en tu usuario actual.</p>\n\n            <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">\n                <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #166534;\">Tu nivel de descuento</p>\n                \n                <div style=\"font-size: 24px; font-weight: bold; color: #15803d; margin: 15px 0; line-height: 1.3;\">\n                    40% en OAKLEY y<br>THE NORTH FACE\n                </div>\n                \n                <div style=\"border-top: 1px solid #bbf7d0; width: 60%; margin: 10px auto;\"></div>\n                \n                <div style=\"font-size: 20px; font-weight: bold; color: #15803d; margin-top: 10px;\">\n                    20% en Equipamiento\n                </div>\n            </div>\n            <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #d1d5db;\">\n                <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">‚ö†Ô∏è RESTRICCIONES DEL PROGRAMA:</h3>\n                <ul style=\"padding-left: 20px; margin-bottom: 0;\">\n                    <li style=\"margin-bottom: 8px;\">Este programa es un privilegio personal e intransferible.</li>\n                    <li style=\"margin-bottom: 8px;\">No permite compras para amigos, familiares ni regalos a terceros.</li>\n                    <li>Queda prohibida la reventa de productos adquiridos con este descuento.</li>\n                </ul>\n                <p style=\"margin-top: 15px; margin-bottom: 0; font-weight: bold; font-size: 12px;\">AL PARTICIPAR EN ESTE PROGRAMA, USTED ACEPTA ESTOS T√âRMINOS.</p>\n            </div>\n\n            <p style=\"margin-top: 30px; font-size: 16px;\">¬°Nos vemos en la nieve! ‚ùÑÔ∏è</p>\n            <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>\n        </div>\n        \n        <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">\n            <p style=\"margin: 0;\">Mensaje autom√°tico enviado desde Rules Shop.</p>\n        </div>\n    </div>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        912,
        32
      ],
      "id": "90dec506-0a68-4200-9fd4-bf78490b83b7",
      "name": "cuenta_existente",
      "webhookId": "1693779c-aabc-4da9-b317-e9623a9166d2",
      "credentials": {
        "gmailOAuth2": {
          "id": "2piqh63wCF24vapD",
          "name": "profesionales@rules-shop.es"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Webhook').item.json.query.email }}",
        "subject": "‚úÖ Alta Aprobada: Cuenta Profesional Rules Shop",
        "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">\n    <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">\n        \n        <div style=\"background-color: #000000; padding: 20px; text-align: center;\">\n            <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>\n        </div>\n\n        <div style=\"padding: 40px 30px;\">\n            <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $('Webhook').item.json.query.nombre }} {{ $('Webhook').item.json.query.apellido }}</strong>,</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">¬°Traemos buenas noticias! Tu perfil profesional ha sido <strong style=\"color: #16a34a;\">AUTORIZADO ‚úÖ</strong>.</p>\n            \n            <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">Ya puedes usar este mismo correo electr√≥nico para identificarte. Tu tarifa especial se aplicar√° autom√°ticamente.</p>\n\n            <div style=\"background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">\n                <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #166534;\">Tu nivel de descuento</p>\n                \n                <div style=\"font-size: 24px; font-weight: bold; color: #15803d; margin: 15px 0; line-height: 1.3;\">\n                    40% en OAKLEY y<br>THE NORTH FACE\n                </div>\n                \n                <div style=\"border-top: 1px solid #bbf7d0; width: 60%; margin: 10px auto;\"></div>\n                \n                <div style=\"font-size: 20px; font-weight: bold; color: #15803d; margin-top: 10px;\">\n                    20% en Equipamiento\n                </div>\n            </div>\n            <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #d1d5db;\">\n                <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">‚ö†Ô∏è RESTRICCIONES DEL PROGRAMA:</h3>\n                <ul style=\"padding-left: 20px; margin-bottom: 0;\">\n                    <li style=\"margin-bottom: 8px;\">Este programa es un privilegio personal e intransferible.</li>\n                    <li style=\"margin-bottom: 8px;\">No permite compras para amigos, familiares ni regalos a terceros.</li>\n                    <li>Queda prohibida la reventa de productos adquiridos con este descuento.</li>\n                </ul>\n                <p style=\"margin-top: 15px; margin-bottom: 0; font-weight: bold; font-size: 12px;\">AL PARTICIPAR EN ESTE PROGRAMA, USTED ACEPTA ESTOS T√âRMINOS.</p>\n            </div>\n\n            <p style=\"margin-top: 30px; font-size: 16px;\">¬°Nos vemos en la nieve! ‚ùÑÔ∏è</p>\n            <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>\n        </div>\n        \n        <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">\n            <p style=\"margin: 0;\">Mensaje autom√°tico enviado desde Rules Shop.</p>\n        </div>\n    </div>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        272,
        192
      ],
      "id": "c9751bd3-9bd1-41cd-85cc-4aaee7940a73",
      "name": "cuenta_creada",
      "webhookId": "1693779c-aabc-4da9-b317-e9623a9166d2",
      "credentials": {
        "gmailOAuth2": {
          "id": "2piqh63wCF24vapD",
          "name": "profesionales@rules-shop.es"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8b16a42d-b5d8-4566-b621-148f30b39911",
              "leftValue": "={{ $('Webhook').item.json.query.expiracion.toNumber() }}",
              "rightValue": "={{ $now.toMillis() }}",
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -304,
        288
      ],
      "id": "084ffaf6-da30-4f74-92e7-d169a22b429b",
      "name": "Verificar_Caducidad"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Enlace Caducado</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #fef2f2;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 15px;\">‚è≥</div>\n        \n        <h1 style=\"color: #dc2626; margin: 0 0 15px 0; font-size: 24px;\">Tiempo Agotado</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Este enlace de validaci√≥n ha caducado porque han pasado m√°s de 48 horas.\n        </p>\n        \n        <div style=\"background-color: #fee2e2; padding: 15px; border-radius: 8px; color: #991b1b; font-size: 14px; line-height: 1.4;\">\n            üîí Por seguridad, los documentos ya no pueden ser procesados mediante este link.\n        </div>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        80,
        304
      ],
      "id": "201815e8-520f-4f99-a1dc-389365815099",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.query.email }}",
        "subject": "üìÑ Actualizaci√≥n sobre tu solicitud: Cuenta Profesional Rules Shop",
        "message": "=<div style=\"background-color: #f3f4f6; padding: 40px 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333;\">     <div style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\">                  <div style=\"background-color: #000000; padding: 20px; text-align: center;\">             <h1 style=\"color: #ffffff; margin: 0; font-size: 24px;\">Rules Shop PRO üèÇ</h1>         </div>          <div style=\"padding: 40px 30px;\">             <p style=\"font-size: 18px; line-height: 1.6;\">Hola <strong>{{ $json.query.nombre }} {{ $json.query.apellido }}</strong>,</p>                          <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">                 Gracias por tu inter√©s en formar parte del programa de profesionales de Rules Shop y por enviarnos tu documentaci√≥n.             </p>                          <p style=\"font-size: 16px; line-height: 1.6; color: #4b5563;\">                 Nuestro equipo ha revisado tu solicitud detalladamente. En esta ocasi√≥n, <strong>no hemos podido validar tu perfil</strong> para acceder a las tarifas especiales del programa PRO.             </p>              <div style=\"background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 20px; margin: 25px 0; text-align: center;\">                 <p style=\"margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #991b1b;\">Estado de la solicitud</p>                 <div style=\"font-size: 24px; font-weight: bold; color: #dc2626; margin: 10px 0;\">NO APROBADA ‚úã</div>                 <p style=\"font-size: 14px; color: #7f1d1d; margin: 0;\">La documentaci√≥n aportada no cumple con los requisitos actuales.</p>             </div>              <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 6px; font-size: 13px; color: #6b7280; border-left: 4px solid #9ca3af;\">                 <h3 style=\"margin-top: 0; color: #374151; font-size: 14px;\">¬øCrees que es un error?</h3>                 <p style=\"margin: 0; line-height: 1.5;\">                     Si consideras que ha habido una equivocaci√≥n o dispones de documentaci√≥n actualizada (T√≠tulo vigente o Vida laboral reciente), te invitamos a responder a este correo adjuntando los nuevos archivos para una segunda revisi√≥n.                 </p>             </div>              <p style=\"margin-top: 30px; font-size: 16px;\">                 Sigues siendo bienvenido en nuestra tienda y comunidad. ¬°Esperamos verte pronto disfrutando de la temporada!             </p>                          <p style=\"margin-top: 30px; font-size: 16px;\">Un saludo,</p>             <p style=\"font-style: italic; color: #6b7280;\">El equipo de Rules Shop.</p>         </div>                  <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; font-size: 12px; color: #9ca3af;\">             <p style=\"margin: 0;\">&copy; Rules Shop. Sierra Nevada.</p>         </div>     </div> </div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -96,
        304
      ],
      "id": "46434455-9b52-49de-adf3-98a0321ae548",
      "name": "Send a message",
      "webhookId": "a8ec28c0-85f5-441d-9bcd-a3152df9be95",
      "credentials": {
        "gmailOAuth2": {
          "id": "2piqh63wCF24vapD",
          "name": "profesionales@rules-shop.es"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
        "query": "query findCustomer($busqueda_shopify: String!) {\n  customers(first: 1, query: $busqueda_shopify) {\n    edges {\n      node {\n        id\n        tags\n        email\n        phone\n      }\n    }\n  }\n}",
        "variables": "={\n  \"busqueda_shopify\": \"{{ [ $json['mi_email'] ? 'email:' + $json['mi_email'] : null, $json['mi_telefono'] ? 'phone:' + $json['mi_telefono'] : null ].filter(v => v).join(' OR ') }}\"\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        480,
        32
      ],
      "id": "7884e8ab-01e6-4870-ae2f-c9a0f6ec816b",
      "name": "Buscar_ID_Cliente",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OPt2Cl0dnwcU4qRk",
          "name": "ShopifyInformes"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
          "mode": "list",
          "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 512939465,
          "mode": "list",
          "cachedResultName": "Respuestas de formulario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Correo Electr√≥nico",
              "lookupValue": "={{ $json.query.email.trim() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -640,
        160
      ],
      "id": "43538da5-809f-446e-9cb2-dc0405cb3bb7",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RCuKUCifcA4jENcY",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Enlace Ya Utilizado</title>\n</head>\n<body style=\"\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #fffbeb; /* Fondo Crema */\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\">\n    <div style=\"\n        background: white;\n        padding: 30px 20px;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n        width: 90%;\n        max-width: 400px;\n        text-align: center;\n        box-sizing: border-box;\n    \">\n        <div style=\"font-size: 48px; margin-bottom: 15px;\">‚ö†Ô∏è</div>\n        \n        <h1 style=\"color: #b45309; margin: 0 0 15px 0; font-size: 24px;\">Enlace ya utilizado</h1>\n        \n        <p style=\"color: #4b5563; font-size: 16px; line-height: 1.5; margin-bottom: 20px;\">\n            Esta solicitud ya fue validada anteriormente.\n        </p>\n        \n        <div style=\"background-color: #fef3c7; padding: 15px; border-radius: 8px; color: #92400e; font-size: 14px; line-height: 1.4;\">\n            ‚úÖ El profesor ya deber√≠a tener sus permisos activos en Shopify. No es necesaria ninguna acci√≥n adicional.\n        </div>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        -304,
        64
      ],
      "id": "16d5d421-37ed-4c9a-be44-d0f46e8c3694",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b1e06889-96b0-4a31-b619-398f5d8c9105",
              "leftValue": "={{ $json[\"Estado Validaci√≥n\"] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -480,
        160
      ],
      "id": "71288c43-1b35-4991-9617-83dfe097af79",
      "name": "Estado_Validacion"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9bf25cb0-2a3d-4f83-87e2-9c615918f2ea",
              "leftValue": "={{ $json.data.customerCreate.userErrors[0].message }}",
              "rightValue": "Email has already been taken",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "8943729c-107b-4206-aff1-cb17e33e5eeb",
              "leftValue": "={{ $json.data.customerCreate.userErrors[0].message }}",
              "rightValue": "Phone has already been taken",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        80,
        128
      ],
      "id": "e471444b-f471-49d9-bb4f-de659a9ebae7",
      "name": "Si_Existe"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
          "mode": "list",
          "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 512939465,
          "mode": "list",
          "cachedResultName": "Respuestas de formulario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Get row(s) in sheet').item.json.row_number}}",
            "Estado Validaci√≥n": "VALIDADO"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Marca temporal",
              "displayName": "Marca temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Apellido",
              "displayName": "Apellido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Correo Electr√≥nico",
              "displayName": "Correo Electr√≥nico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tel√©fono M√≥vil",
              "displayName": "Tel√©fono M√≥vil",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Adjuntar Vida Laboral Actual",
              "displayName": "Adjuntar Vida Laboral Actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
              "displayName": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Aceptaci√≥n de condiciones",
              "displayName": "Aceptaci√≥n de condiciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Estado Validaci√≥n",
              "displayName": "Estado Validaci√≥n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1120,
        32
      ],
      "id": "40ba9e2d-8950-4fa2-bf34-1a3e5221bcc6",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RCuKUCifcA4jENcY",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
          "mode": "list",
          "cachedResultName": "Solicitud de Alta - Profesionales Rules Oakley (respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 512939465,
          "mode": "list",
          "cachedResultName": "Respuestas de formulario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c/edit#gid=512939465"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Get row(s) in sheet').item.json.row_number }}",
            "Estado Validaci√≥n": "VALIDADO"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Marca temporal",
              "displayName": "Marca temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Apellido",
              "displayName": "Apellido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Correo Electr√≥nico",
              "displayName": "Correo Electr√≥nico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tel√©fono M√≥vil",
              "displayName": "Tel√©fono M√≥vil",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Adjuntar Vida Laboral Actual",
              "displayName": "Adjuntar Vida Laboral Actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
              "displayName": "Adjuntar T√≠tulo / Certificaci√≥n de Profesor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Aceptaci√≥n de condiciones",
              "displayName": "Aceptaci√≥n de condiciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Estado Validaci√≥n",
              "displayName": "Estado Validaci√≥n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        480,
        192
      ],
      "id": "88c9b20b-20c3-462a-b6c6-acf00666d7ee",
      "name": "Update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "RCuKUCifcA4jENcY",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
        "query": "mutation customerUpdate($input: CustomerInput!) {\n  customerUpdate(input: $input) {\n    customer {\n      id\n      email\n      firstName\n      lastName\n      tags\n      phone\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"input\": {\n    \"id\": \"{{ $('Buscar_ID_Cliente').item.json.data.customers.edges[0].node.id }}\",\n    \"firstName\": \"{{ $('Webhook').item.json.query.nombre }}\",\n    \"lastName\": \"{{ $('Webhook').item.json.query.apellido }}\",\n    \n    \"tags\": \"{{ ($('Buscar_ID_Cliente').item.json.data.customers.edges[0].node.tags || []).concat(['Profesor', 'DescuentoProfesor']) }}\",\n    \n    \"note\": \"Perfil actualizado y validado autom√°ticamente v√≠a WhatsApp el {{ $now.toFormat('dd/MM/yyyy') }}\",\n    \"phone\": \"{{ $('Webhook').item.json.query.telefono && $('Webhook').item.json.query.telefono.toString().replace(/\\D/g,'').length > 8 ? ($('Webhook').item.json.query.telefono.toString().includes('+') ? $('Webhook').item.json.query.telefono.toString().replace(/ /g,'') : '+34' + $('Webhook').item.json.query.telefono.toString().replace(/\\D/g,'')) : null }}\"\n  }\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        720,
        32
      ],
      "id": "20b324c0-a79a-434e-864f-8aeb88eb1a38",
      "name": "Actualizar_Cliente",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OPt2Cl0dnwcU4qRk",
          "name": "ShopifyInformes"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Capturamos los datos limpios\nconst email = $('Webhook').item.json.query.email;\nconst telefono = $('Webhook').item.json.query.telefono;\n\nreturn {\n  // Estas dos son para que t√∫ las veas separadas en el output:\n  \"mi_email\": email,\n  \"mi_telefono\": telefono,\n  \n  // Esta es la variable combinada que OBLIGATORIAMENTE necesita Shopify:\n  \"busqueda_shopify\": `email:${email} OR phone:${telefono}`\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        32
      ],
      "id": "dc4ffbab-3b2b-4f6f-86e8-e0b06b329928",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-12-12T07:23:55.982Z",
      "createdAt": "2025-12-12T07:23:55.982Z",
      "role": "workflow:owner",
      "workflowId": "cnuDKnZrHmDy4QDh",
      "projectId": "x5UZcmGQw2OWHuXb"
    }
  ],
  "staticData": {
    "node:Gmail Trigger": {
      "Gmail Trigger": {
        "lastTimeChecked": 1768935411
      }
    },
    "node:Google Sheets Trigger": {
      "documentId": "16auxC5pQ4ydDh1LxCKiPC5ClQ1WCN3R5ogY1Smmbm4c",
      "sheetId": 512939465,
      "lastIndexChecked": 8
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2026-01-30T10:45:42.484Z",
  "versionId": "70ae61e7-3847-4bc7-a755-381a42e04c37"
}