{
  "active": false,
  "connections": {
    "Webhook JSON": {
      "main": [
        [
          {
            "node": "Generar TXT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar TXT": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk": {
      "main": [
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-29T08:38:38.521Z",
  "id": "3EsLWbaigVn4UtgZ",
  "isArchived": false,
  "meta": null,
  "name": "Webhook a impresión TXT",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "recibir-json",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Webhook JSON",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        304,
        208
      ],
      "id": "fda7dd9e-27a2-4cd6-8159-66c5a240bb19",
      "webhookId": "ffdc2af4-9530-4929-9958-ea16db076770"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\n\n// En tu webhook, los line_items están en data.body\nconst lineItems = data.body?.line_items;\n\nif (!lineItems || !lineItems.length) {\n    return [\n        {\n            json: { error: \"No se encontró 'line_items' o está vacío.\", received: data }\n        }\n    ];\n}\n\n// Ancho de columnas\nconst colWidths = { name: 30, id: 12, stock: 8 };\nfunction padCol(text, width) {\n    return String(text ?? \"\").padEnd(width, ' ');\n}\n\nlet tableText = '';\n\n// Construir filas usando 'name' (minúscula) como prioridad\nfor (let i = 0; i < lineItems.length; i++) {\n    const item = lineItems[i];\n\n    // Prioriza 'name' en minúscula; si no existe, usa otros campos como fallback\n    const name = item.name ?? item.Name ?? item.product_name ?? \"N/A\";\n    const id = item.product_id ?? item.id ?? item.sku ?? \"N/A\";\n    const stock = item.current_stock_level ?? item.stock ?? item.quantity ?? \"N/A\";\n\n    tableText += `${padCol(name, colWidths.name)} | ${padCol(id, colWidths.id)} | ${padCol(stock, colWidths.stock)}\\n`;\n\n    // Añadir separador entre filas, pero no al final\n    if (i !== lineItems.length - 1) {\n        tableText += `${'-'.repeat(colWidths.name + colWidths.id + colWidths.stock + 6)}\\n`;\n    }\n}\n\nreturn [\n    {\n        json: { file_content_preview: tableText },\n        binary: {\n            archivo: {\n                data: Buffer.from(tableText).toString(\"base64\"),\n                mimeType: \"text/plain\",\n                fileName: \"line_items.txt\"\n            }\n        }\n    }\n];\n\n"
      },
      "name": "Generar TXT",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        208
      ],
      "id": "02bd23e5-542c-414b-9eb6-4814745c400d"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/tmp/impresora/archivo.txt",
        "dataPropertyName": "archivo",
        "options": {
          "append": true
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        976,
        208
      ],
      "id": "46f0b331-3792-4df4-9ec1-2fbd2ef9ac85",
      "name": "Read/Write Files from Disk"
    },
    {
      "parameters": {
        "command": "curl -X POST -F \"archivo=@/tmp/impresora/archivo.txt\" http://2.136.43.122:8080/imprimir\n"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        1216,
        208
      ],
      "id": "870f7d36-2e6f-46ac-bcf2-1d550f3a6b90",
      "name": "Execute Command"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        432,
        800
      ],
      "id": "cce206c1-a4a2-4a29-83a2-955d7109509e",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/tmp/impresora/archivo.txt",
        "dataPropertyName": "archivo",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        1120,
        800
      ],
      "id": "cab07711-ea79-44eb-92a5-7615d5590099",
      "name": "Read/Write Files from Disk1"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: {},\n    binary: {\n      archivo: {\n        data: Buffer.from(\"\").toString(\"base64\"),\n        mimeType: \"text/plain\",\n        fileName: \"archivo.txt\"\n      }\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        800
      ],
      "id": "74f54ace-fa11-405e-a821-3fe63db34f7b",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-29T08:38:38.527Z",
      "createdAt": "2025-11-29T08:38:38.527Z",
      "role": "workflow:owner",
      "workflowId": "3EsLWbaigVn4UtgZ",
      "projectId": "x5UZcmGQw2OWHuXb"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-12-04T09:47:30.000Z",
  "versionId": "d5942d85-77eb-436b-bd12-380e77e2f7d0"
}