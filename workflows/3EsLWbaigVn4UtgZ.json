{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-02-26T14:42:39.000Z",
    "createdAt": "2026-02-26T14:42:37.775Z",
    "versionId": "5d411736-f00e-487d-9f26-1ca4b9753032",
    "workflowId": "3EsLWbaigVn4UtgZ",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "venta-descuento-10",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -256,
          -656
        ],
        "id": "c7a0c58a-8754-4239-9c22-da42447ffdbc",
        "name": "Webhook",
        "webhookId": "7bb61142-4257-48c7-b86e-f8751080012e"
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
          "query": "query getCustomerMetafields($customerId: ID!) {\n  customer(id: $customerId) {\n    id\n    firstName\n    lastName\n    email\n    phone\n    metafields(first: 10) {\n      edges {\n        node {\n          id\n          namespace\n          key\n          value\n          type\n        }\n      }\n    }\n  }\n}",
          "variables": "={\n  \"customerId\": \"{{ $json.body.customer.admin_graphql_api_id }}\"\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          432,
          -160
        ],
        "id": "29b8c95c-1feb-4b70-ae06-9788cb88b619",
        "name": "Obtener datos cliente",
        "credentials": {
          "httpHeaderAuth": {
            "id": "THkhgrtze1uBo6Ft",
            "name": "Token Informes Shopify"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const cleanData = [];\n\nfor (const item of $input.all()) {\n  const customer = item.json?.data?.customer;\n  if (!customer) continue;\n\n  const rawId = customer.id || \"\";\n  const extractedNumericId = rawId ? rawId.split('/').pop() : null;\n\n  const cleanItem = {\n    customerId: rawId || null,\n    numericId: extractedNumericId,\n    firstName: customer.firstName || \"\",\n    lastName: customer.lastName || \"\",\n    metafields: {},\n    hasDiscountOf10: false, // Empezamos asumiendo que es falso\n    totalAmount: null // Preparamos un espacio para el monto total\n  };\n\n  const edges = customer.metafields?.edges || [];\n  \n  for (const edge of edges) {\n    const node = edge?.node;\n    \n    if (node && node.key && node.value !== null && node.value !== undefined) {\n      \n      // Manejamos los descuentos (number_integer)\n      if (node.type === \"number_integer\") {\n        const discountValue = parseInt(node.value, 10);\n        cleanItem.metafields[node.key] = discountValue;\n        \n        // Si encontramos UN descuento que sea exactamente 10, lo marcamos como true\n        if (discountValue === 10) {\n          cleanItem.hasDiscountOf10 = true;\n        }\n      } \n      // Manejamos el nuevo campo de dinero (money)\n      else if (node.type === \"money\" && node.key === \"monto_total\") {\n        try {\n          const moneyData = JSON.parse(node.value);\n          cleanItem.totalAmount = parseFloat(moneyData.amount);\n        } catch (e) {\n          // Si el JSON falla, no rompemos el código\n          cleanItem.totalAmount = null; \n        }\n      }\n    }\n  }\n\n  cleanData.push({ json: cleanItem });\n}\n\nreturn cleanData;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          608,
          -160
        ],
        "id": "a8ad481f-8078-4bcf-8e86-66d8899a3ada",
        "name": "Limpiar Datos"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "where": {
            "values": [
              {
                "column": "id_cliente",
                "value": "={{ $json.numericId }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          976,
          -400
        ],
        "id": "d00ef68a-1776-4e68-afc6-1b99f546aa11",
        "name": "Obtener Datos Supabase",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          432,
          32
        ],
        "id": "f88d1129-33b8-4d5a-98f3-a3ef12a701d0",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "99d01e4c-a02f-4c7c-b184-ff08551b12ea",
                "leftValue": "={{ $json.body.discount_codes[0].code }}",
                "rightValue": "GRACIAS10",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -32,
          -656
        ],
        "id": "5d45aaa9-d5c7-4064-93b5-9b95d14dea03",
        "name": "Si Usa Descuento"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "99d01e4c-a02f-4c7c-b184-ff08551b12ea",
                "leftValue": "={{ $json.body.contact_email }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          240,
          -64
        ],
        "id": "ee879842-3340-4ba0-adb6-b0507747f9d2",
        "name": "Si usa correo"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "9de76f66-78f3-460b-a48b-2d9d75440555",
                "leftValue": "={{ $json.hasDiscountOf10 }}",
                "rightValue": "false",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          768,
          -160
        ],
        "id": "4da891d3-c1ee-4c1f-b192-c86087fdbe45",
        "name": "Si no tiene los descuentos activos"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "38def29d-b85b-4c27-822d-421036a309f2",
                "leftValue": "={{ $json.id_cliente }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1152,
          -400
        ],
        "id": "e43b75b1-5fd7-43fe-bb12-8cdf5cee9886",
        "name": "Si Está en la Base de Datos"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1360,
          -496
        ],
        "id": "b97951cf-bf32-481f-b1b0-9d920643013d",
        "name": "No Operation, do nothing1"
      },
      {
        "parameters": {
          "operation": "upsert",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id_cliente": "={{ $('Limpiar Datos').item.json.numericId }}",
              "sucursal_rules": 10,
              "sucursal_oakley": 10,
              "sucursal_thenorthface": 10,
              "sucursal_surfin": 10,
              "sucursal_nuance": 10,
              "sucursal_nuancelodge": 10,
              "sucursal_melia": 10,
              "correo": "={{ $('Obtener datos cliente').item.json.data.customer.email }}",
              "Nombre": "={{ $('Obtener datos cliente').item.json.data.customer.firstName }} {{ $('Obtener datos cliente').item.json.data.customer.lastName }}",
              "Teléfono": "={{ $('Obtener datos cliente').item.json.data.customer.phone }}"
            },
            "matchingColumns": [
              "id_cliente"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1360,
          -304
        ],
        "id": "0fe723f3-9430-4710-a3f1-0862ad5039c4",
        "name": "Crear Cliente en la Base de Datos",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "where": {
            "values": [
              {
                "column": "id_cliente",
                "value": "={{ $json.numericId }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          976,
          96
        ],
        "id": "7350b2f2-99fc-460c-9e53-239d60f226e1",
        "name": "Obtener Datos Supabase1",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "38def29d-b85b-4c27-822d-421036a309f2",
                "leftValue": "={{ $json.id_cliente }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1152,
          96
        ],
        "id": "f6eb175f-a4a1-4add-b7c8-3ebe7028e726",
        "name": "Si Está en la Base de Datos1"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1360,
          0
        ],
        "id": "f4fcad3f-882d-450c-bcb3-91844eca2516",
        "name": "No Operation, do nothing2"
      },
      {
        "parameters": {
          "operation": "upsert",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id_cliente": "={{ $('Limpiar Datos').item.json.numericId }}",
              "sucursal_rules": 10,
              "sucursal_oakley": 10,
              "sucursal_thenorthface": 10,
              "sucursal_surfin": 10,
              "sucursal_nuance": 10,
              "sucursal_nuancelodge": 10,
              "sucursal_melia": 10,
              "Nombre": "={{ $('Obtener datos cliente').item.json.data.customer.firstName }} {{ $('Obtener datos cliente').item.json.data.customer.lastName }}",
              "correo": "={{ $('Obtener datos cliente').item.json.data.customer.email }}",
              "Teléfono": "={{ $('Obtener datos cliente').item.json.data.customer.phone }}"
            },
            "matchingColumns": [
              "id_cliente"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": false
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1360,
          192
        ],
        "id": "52472a3c-c7de-4ade-b1bc-d562e82f6810",
        "name": "Crear Cliente en la Base de Datos1",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "where": {
            "values": [
              {
                "column": "correo",
                "value": "={{ $json.body.contact_email }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          208,
          -1104
        ],
        "id": "ce745342-7c3c-4cef-8db3-9981c1069c22",
        "name": "Obtener Datos Supabase2",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "38def29d-b85b-4c27-822d-421036a309f2",
                "leftValue": "={{ $json.id_cliente }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          416,
          -1104
        ],
        "id": "ef142d16-3fee-4d20-8d9b-b699edb1445e",
        "name": "Si Está en la Base de Datos2"
      },
      {
        "parameters": {
          "sendTo": "emiliano@tailwind.es",
          "subject": "ERROR EN LA BASE DE DATOS DE SUPABASE",
          "message": "=Se ha producido una situación imposible, el cliente {{ $('Webhook').item.json.body.customer.first_name || \"Nombre\"}} {{ $('Webhook').item.json.body.customer.last_name }} ha utilizado el código de descuento de la promoción (10%) pero no está en la base de datos.",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          592,
          -880
        ],
        "id": "8e84baa3-9b4c-4777-8ad5-82f7c02f4246",
        "name": "Send a message",
        "webhookId": "5e37c03c-e87e-4feb-98dd-d5a7fd89c8ce",
        "credentials": {
          "gmailOAuth2": {
            "id": "wR7U82S8bmDH4odC",
            "name": "info@tailwind.es"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 99759620443,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      },
                      "id": "f7bd3a7d-d6a7-4e37-9340-9a9ac7b605f1"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "a12b5903-dd55-4cea-a0ff-9607f476687f",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 99018441051,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "827ce9e5-d118-4026-b8f9-c7c0cd2c73fb",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 108915917147,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "62e9eed5-3337-49ac-a6cb-9de8c99cc989",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 108790317403,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "6194b202-f053-444c-a009-724559da04c3",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 108916146523,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "7a9fecf7-5d91-441e-8fc1-4d8352810087",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 108916244827,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "8542fd23-7401-44b4-b227-85d81ae7b43d",
                      "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                      "rightValue": 110334542171,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          592,
          -1200
        ],
        "id": "17702954-7e6e-4700-9b63-26f121b5bc7c",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_rules": 0,
              "pedido_rules": "={{ $('Webhook').item.json.body.id }}",
              "correo": "={{ $json.correo }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -1552
        ],
        "id": "702019b7-b389-46f0-963d-923a278efcaa",
        "name": "Actualizar Rules",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_oakley": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_oakley": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -1408
        ],
        "id": "5af642bf-a804-4d61-b7e0-4f977001f358",
        "name": "Actualizar Oakley",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_thenorthface": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_thenorthface": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -1264
        ],
        "id": "48414727-d4cc-46a3-9a7a-0379c1397e7f",
        "name": "Actualizar North Face",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_surfin": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_surfin": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -1120
        ],
        "id": "d31eb78d-0c84-4428-939e-350a1d512f82",
        "name": "Actualizar Surfin",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_nuance": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_nuance": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -976
        ],
        "id": "12f13519-82d7-46d5-8ab1-1d4b1e0fa73f",
        "name": "Actualizar Nuance",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_nuancelodge": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_nuancelodge": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -832
        ],
        "id": "0587274a-3836-4777-8f64-8a49be7ac4c2",
        "name": "Actualizar Lodge",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "sucursal_melia": 0,
              "correo": "={{ $json.body.contact_email }}",
              "pedido_melia": "={{ $('Webhook').item.json.body.id }}"
            },
            "matchingColumns": [
              "correo"
            ],
            "schema": [
              {
                "id": "correo",
                "displayName": "correo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal_rules",
                "displayName": "sucursal_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_oakley",
                "displayName": "sucursal_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_thenorthface",
                "displayName": "sucursal_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_surfin",
                "displayName": "sucursal_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuance",
                "displayName": "sucursal_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_nuancelodge",
                "displayName": "sucursal_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_melia",
                "displayName": "sucursal_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "id_cliente",
                "displayName": "id_cliente",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_rules",
                "displayName": "pedido_rules",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_oakley",
                "displayName": "pedido_oakley",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_thenorthface",
                "displayName": "pedido_thenorthface",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_surfin",
                "displayName": "pedido_surfin",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuance",
                "displayName": "pedido_nuance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_nuancelodge",
                "displayName": "pedido_nuancelodge",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pedido_melia",
                "displayName": "pedido_melia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          864,
          -688
        ],
        "id": "10669ced-64d0-43dc-b86e-75bcf772e087",
        "name": "Actualizar Melia",
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_rules\",\n      \"value\": \"{{ $json.sucursal_rules }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_oakley\",\n      \"value\": \"{{ $json.sucursal_oakley }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_thenorthface\",\n      \"value\": \"{{ $json.sucursal_thenorthface }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_surfin\",\n      \"value\": \"{{ $json.sucursal_surfin }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuance\",\n      \"value\": \"{{ $json.sucursal_nuance }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuancelodge\",\n      \"value\": \"{{ $json.sucursal_nuancelodge }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_melia\",\n      \"value\": \"{{ $json.sucursal_melia }}\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1648,
          -64
        ],
        "id": "bf5b2cb5-4c02-4957-b2ef-22301a1be761",
        "name": "Crear Cliente",
        "credentials": {
          "httpHeaderAuth": {
            "id": "THkhgrtze1uBo6Ft",
            "name": "Token Informes Shopify"
          }
        }
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_rules\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -1552
        ],
        "id": "ea9d5966-051b-42e8-93b3-70a8a4eb8f55",
        "name": "Graph Rules",
        "credentials": {
          "httpHeaderAuth": {
            "id": "THkhgrtze1uBo6Ft",
            "name": "Token Informes Shopify"
          }
        }
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_oakley\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -1408
        ],
        "id": "773e824e-cfb8-4e2d-bff6-8c485924904c",
        "name": "Graph Oakley"
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_thenorthface\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -1264
        ],
        "id": "7d197ec2-e509-4ee9-9ae2-4cac17408065",
        "name": "Graph North Face"
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_surfin\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -1120
        ],
        "id": "46e7165f-39ec-4860-be56-da244eed5c78",
        "name": "Graph Surfin"
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuance\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -976
        ],
        "id": "9e13b40f-4bc4-4b2c-ad94-d15a6a5a93d4",
        "name": "Graph Nuance"
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuancelodge\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -832
        ],
        "id": "15e3e8f9-de34-4aae-8eeb-53d56c6072e7",
        "name": "Graph Lodge"
      },
      {
        "parameters": {
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
          "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_melia\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          1056,
          -688
        ],
        "id": "e7a454c0-112c-4cbc-a2d5-72071acdf555",
        "name": "Graph Melia"
      },
      {
        "parameters": {
          "path": "leerqr",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          2512,
          -752
        ],
        "id": "50d47124-56fb-448c-95b1-1aff6feb6b2f",
        "name": "Leerqr",
        "webhookId": "b9dc3bb5-70bc-4d91-b08a-192f8a1bf4eb"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Tus Descuentos</title>\n  <style>\n    body { \n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n      padding: 20px; \n      max-width: 1000px; \n      margin: 0 auto; \n      color: #333;\n      background-color: #fcfcfc;\n    }\n    .main-header { text-align: center; margin-bottom: 40px; }\n    h2 { color: #000; margin-bottom: 5px; font-size: 2rem; }\n    p { color: #555; }\n    \n    /* Layout de dos columnas */\n    .container {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 40px;\n    }\n    .column {\n      flex: 1;\n      min-width: 320px;\n      background: #fff;\n      padding: 25px;\n      border-radius: 12px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n    }\n    .section-title {\n      margin-top: 0;\n      padding-bottom: 10px;\n      border-bottom: 2px solid #eee;\n      font-size: 1.3rem;\n      color: #000;\n    }\n\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 15px; \n      border-radius: 8px;\n      overflow: hidden;\n      border: 1px solid #f0f0f0;\n    }\n    th, td { \n      padding: 12px 15px; \n      text-align: left; \n      border-bottom: 1px solid #f0f0f0; \n      vertical-align: middle;\n      font-size: 14px;\n    }\n    th { \n      background-color: #f8f9fa; \n      font-weight: 600; \n      color: #333;\n    }\n    tr:last-child td { border-bottom: none; }\n    \n    .discount-badge { \n      background-color: #000; \n      color: #fff; \n      padding: 4px 10px; \n      border-radius: 20px; \n      font-weight: bold; \n      font-size: 13px;\n    }\n    .no-data { text-align: center; padding: 30px; color: #666; background: #f9f9f9; border-radius: 8px; font-size: 14px;}\n    \n    .map-btn {\n      display: inline-block;\n      background-color: #f4f6f8;\n      color: #333;\n      padding: 6px 12px;\n      border-radius: 6px;\n      text-decoration: none;\n      font-size: 12px;\n      font-weight: 600;\n      border: 1px solid #ddd;\n      transition: all 0.2s;\n    }\n    .map-btn:hover { background-color: #e2e6ea; color: #000; border-color: #ccc; }\n\n    /* Estilos específicos compras e imágenes */\n    .sucursal-name {\n      margin-top: 25px;\n      margin-bottom: 5px;\n      font-size: 1.1rem;\n      color: #222;\n    }\n    .price-original { text-decoration: line-through; color: #999; font-size: 0.9em; }\n    .price-discount { color: #27ae60; font-weight: bold; font-size: 1.1em; }\n    .savings-text { display: block; font-size: 0.8em; color: #27ae60; margin-top: 2px; }\n    \n    .product-cell {\n      display: flex;\n      align-items: center;\n      gap: 15px;\n    }\n    .product-img {\n      width: 45px;\n      height: 45px;\n      object-fit: cover;\n      border-radius: 6px;\n      border: 1px solid #eaeaea;\n      background-color: #fff;\n    }\n\n    /* NUEVO ESTILO: Nota legal al pie de página */\n    .footer-note {\n      text-align: center;\n      margin-top: 50px;\n      padding-top: 20px;\n      font-size: 12px;\n      color: #888;\n      border-top: 1px solid #eaeaea;\n    }\n  </style>\n</head>\n<body>\n\n  {{ \n    (() => {\n      const supabaseData = $node[\"If\"].json; \n      \n      if (!supabaseData) {\n        return `\n          <div class=\"main-header\"><h2>¡Hola!</h2></div>\n          <div class=\"no-data\"><p>No hemos encontrado tu perfil o hubo un error al leer el QR.</p></div>\n        `;\n      }\n\n      const sucursales = [\n        { key: 'sucursal_rules', orderKey: 'pedido_rules', name: 'Rules Outlet', url: 'https://maps.app.goo.gl/2zcHYJzYi4mku9Bw5' },\n        { key: 'sucursal_oakley', orderKey: 'pedido_oakley', name: 'Rules Oakley', url: 'https://maps.app.goo.gl/T81E6eXNTRWc86nj9' },\n        { key: 'sucursal_thenorthface', orderKey: 'pedido_thenorthface', name: 'Rules The North Face', url: 'https://maps.app.goo.gl/T81E6eXNTRWc86nj9' },\n        { key: 'sucursal_surfin', orderKey: 'pedido_surfin', name: 'Surfin', url: 'https://maps.app.goo.gl/18GNbRyLLukuo4m57' },\n        { key: 'sucursal_nuance', orderKey: 'pedido_nuance', name: 'Nuance', url: 'https://maps.app.goo.gl/Farx9QjYyZX294pe7' },\n        { key: 'sucursal_nuancelodge', orderKey: 'pedido_nuancelodge', name: 'Nuance Lodge', url: 'https://maps.app.goo.gl/ND7hyiUQMVSpJ2G96' },\n        { key: 'sucursal_melia', orderKey: 'pedido_melia', name: 'Meliá Sierra Nevada', url: 'https://maps.app.goo.gl/Cf146WRdUBgxN8KT8' }\n      ];\n\n      // --- COLUMNA IZQUIERDA ---\n      const descuentosActivos = sucursales.filter(s => parseInt(supabaseData[s.key] || 0) > 0);\n      \n      let leftColumn = '<div class=\"column\"><h3 class=\"section-title\">Tus descuentos activos</h3>';\n      if (descuentosActivos.length === 0) {\n        leftColumn += '<div class=\"no-data\"><p>Actualmente no tienes descuentos activos. ¡Sigue comprando para acumular más!</p></div>';\n      } else {\n        leftColumn += '<table><thead><tr><th>Sucursal</th><th>Descuento</th><th>Ubicación</th></tr></thead><tbody>';\n        descuentosActivos.forEach(s => {\n          leftColumn += `\n            <tr>\n              <td><strong>${s.name}</strong></td>\n              <td><span class=\"discount-badge\">${supabaseData[s.key]}%</span></td>\n              <td><a href=\"${s.url}\" target=\"_top\" rel=\"noopener noreferrer\" class=\"map-btn\">📍 Ver mapa</a></td>\n            </tr>\n          `;\n        });\n        leftColumn += '</tbody></table>';\n      }\n      leftColumn += '</div>';\n\n      // --- COLUMNA DERECHA ---\n      let rightColumn = '<div class=\"column\"><h3 class=\"section-title\">Descuentos utilizados</h3>';\n      let hasUsedDiscounts = false;\n\n      try {\n        const orders = $node[\"GraphQL1\"].json.data.nodes;\n        \n        if (orders && orders.length > 0) {\n          \n          const orderToSucursal = {};\n          sucursales.forEach(s => {\n            if (supabaseData[s.orderKey]) {\n               orderToSucursal[\"gid://shopify/Order/\" + supabaseData[s.orderKey]] = s.name;\n            }\n          });\n\n          orders.forEach(order => {\n            if (!order) return; \n            \n            const sucursalName = orderToSucursal[order.id] || 'Tienda';\n            const items = order.lineItems.edges;\n\n            if (items.length > 0) {\n              hasUsedDiscounts = true;\n              rightColumn += `\n                <h4 class=\"sucursal-name\">${sucursalName} <span style=\"font-size:12px; color:#888; font-weight:normal;\">(${order.name})</span></h4>\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Producto</th>\n                      <th>Precio Original</th>\n                      <th>Tu Precio</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n              `;\n\n              items.forEach(item => {\n                const node = item.node;\n                const originalPrice = parseFloat(node.originalTotalSet.shopMoney.amount);\n                const discountedPrice = parseFloat(node.discountedTotalSet.shopMoney.amount);\n                const savings = (originalPrice - discountedPrice).toFixed(2);\n\n                const imageUrl = node.image && node.image.url ? node.image.url : 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n                let originalHtml = '-';\n                let savingsHtml = '';\n                \n                if (originalPrice > discountedPrice) {\n                   originalHtml = `<span class=\"price-original\">${originalPrice.toFixed(2)}€</span>`;\n                   savingsHtml = `<span class=\"savings-text\">Ahorraste ${savings}€</span>`;\n                }\n\n                rightColumn += `\n                  <tr>\n                    <td>\n                      <div class=\"product-cell\">\n                        <img src=\"${imageUrl}\" alt=\"${node.title}\" class=\"product-img\" onerror=\"this.style.display='none'\">\n                        <div>\n                          <strong>${node.title}</strong><br>\n                          <span style=\"font-size: 0.85em; color: #666;\">Cant: ${node.quantity}</span>\n                        </div>\n                      </div>\n                    </td>\n                    <td>${originalHtml}</td>\n                    <td>\n                      <span class=\"price-discount\">${discountedPrice.toFixed(2)}€</span>\n                      ${savingsHtml}\n                    </td>\n                  </tr>\n                `;\n              });\n              rightColumn += `</tbody></table>`;\n            }\n          });\n        }\n      } catch (error) {\n        console.log(\"Error leyendo pedidos GraphQL: \", error);\n      }\n\n      if (!hasUsedDiscounts) {\n         rightColumn += '<div class=\"no-data\" style=\"margin-top:15px;\"><p>Aún no has utilizado ningún descuento en tus compras.</p></div>';\n      }\n      \n      rightColumn += '</div>';\n\n      // --- UNIMOS TODO (Aquí he añadido la clase .footer-note al final) ---\n      const finalHtml = `\n        <div class=\"main-header\">\n          <h2>¡Hola, ${supabaseData.Nombre || 'Cliente'}!</h2>\n          <p>Bienvenido a tu área personal.</p>\n        </div>\n        <div class=\"container\">\n          ${leftColumn}\n          ${rightColumn}\n        </div>\n        <p class=\"footer-note\">El descuento solo se aplicará a artículos que no tengan descuento de antemano.</p>\n      `;\n\n      return finalHtml;\n    })()\n  }}\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          3632,
          -848
        ],
        "id": "ba3dd16e-f146-4321-8ca0-9d6e1903c0d4",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "Descuentos_Omnicanal",
            "mode": "list",
            "cachedResultName": "Descuentos_Omnicanal"
          },
          "where": {
            "values": [
              {
                "column": "id_cliente",
                "value": "={{ $json.data.order.customer.id.split('/').pop() }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          2928,
          -752
        ],
        "id": "854c91f8-93f3-46f5-a1de-ec03fa9b4a3e",
        "name": "Select rows from a table",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "UPETCYNZNCReuZu8",
            "name": "Postgres Supabase"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "f21ae0da-a295-4cd1-8995-371cea53875c",
                "leftValue": "={{ $json.correo }}",
                "rightValue": "={{ $('Leerqr').item.json.query.cliente_id }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          3184,
          -752
        ],
        "id": "ceec1aba-9719-4440-b3ec-a563293b9876",
        "name": "If"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Tus Descuentos</title>\n  <style>\n    body { \n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n      padding: 20px; \n      max-width: 500px; \n      margin: 0 auto; \n      color: #333;\n    }\n    .header { text-align: center; margin-bottom: 30px; }\n    h2 { color: #000; margin-bottom: 5px; }\n    p { color: #555; }\n    .no-data { \n      text-align: center; \n      padding: 30px; \n      color: #666; \n      background: #f9f9f9; \n      border-radius: 8px; \n      line-height: 1.5;\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"header\">\n    <h2>¡Hola!</h2>\n  </div>\n  \n  <div class=\"no-data\">\n    <p><strong>No tienes cuenta de cliente.</strong></p>\n    <p>Puedes crearla haciendo una compra en una de nuestras sucursales y facilitando tu correo electrónico al empleado.</p>\n  </div>\n\n</body>\n</html>",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.5,
        "position": [
          3392,
          -656
        ],
        "id": "f38e9265-197e-4c46-9dff-bcc9cd8b5d68",
        "name": "Respond to Webhook1"
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "query getOrder($orderId: ID!) {\n  order(id: $orderId) {\n    name\n    email\n    customer {\n      id\n      email\n    }\n  }\n}",
          "variables": "={\n  \"orderId\": \"gid://shopify/Order/{{ $json.query.shop_id }}\"\n}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          2720,
          -752
        ],
        "id": "df362df3-7061-458d-9633-a1eb66b89be1",
        "name": "GraphQL",
        "credentials": {
          "httpHeaderAuth": {
            "id": "OPt2Cl0dnwcU4qRk",
            "name": "ShopifyInformes"
          }
        }
      },
      {
        "parameters": {
          "authentication": "headerAuth",
          "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
          "query": "query getMultipleOrders($orderIds: [ID!]!) {\n  nodes(ids: $orderIds) {\n    ... on Order {\n      id\n      name\n      lineItems(first: 10) {\n        edges {\n          node {\n            title\n            quantity\n            image {\n              url\n            }\n            originalTotalSet { shopMoney { amount } }\n            discountedTotalSet { shopMoney { amount } }\n          }\n        }\n      }\n    }\n  }\n}",
          "variables": "={{\n  {\n    \"orderIds\": [\n      $json.pedido_rules,\n      $json.pedido_oakley,\n      $json.pedido_thenorthface,\n      $json.pedido_surfin,\n      $json.pedido_nuance,\n      $json.pedido_nuancelodge,\n      $json.pedido_melia\n    ].filter(id => id != null && id != \"\").map(id => \"gid://shopify/Order/\" + id)\n  }\n}}"
        },
        "type": "n8n-nodes-base.graphql",
        "typeVersion": 1.1,
        "position": [
          3392,
          -848
        ],
        "id": "8f06d485-00b0-4ce8-9588-856fc96b7742",
        "name": "GraphQL1",
        "credentials": {
          "httpHeaderAuth": {
            "id": "THkhgrtze1uBo6Ft",
            "name": "Token Informes Shopify"
          }
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Si Usa Descuento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtener datos cliente": {
        "main": [
          [
            {
              "node": "Limpiar Datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiar Datos": {
        "main": [
          [
            {
              "node": "Si no tiene los descuentos activos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtener Datos Supabase": {
        "main": [
          [
            {
              "node": "Si Está en la Base de Datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si Usa Descuento": {
        "main": [
          [
            {
              "node": "Obtener Datos Supabase2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Si usa correo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si usa correo": {
        "main": [
          [
            {
              "node": "Obtener datos cliente",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si no tiene los descuentos activos": {
        "main": [
          [
            {
              "node": "Obtener Datos Supabase",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Obtener Datos Supabase1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si Está en la Base de Datos": {
        "main": [
          [
            {
              "node": "No Operation, do nothing1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Crear Cliente en la Base de Datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtener Datos Supabase1": {
        "main": [
          [
            {
              "node": "Si Está en la Base de Datos1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si Está en la Base de Datos1": {
        "main": [
          [
            {
              "node": "No Operation, do nothing2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Crear Cliente en la Base de Datos1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtener Datos Supabase2": {
        "main": [
          [
            {
              "node": "Si Está en la Base de Datos2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Si Está en la Base de Datos2": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Actualizar Rules",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar Oakley",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar North Face",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar Surfin",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar Nuance",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar Lodge",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualizar Melia",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crear Cliente en la Base de Datos": {
        "main": [
          [
            {
              "node": "Crear Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Rules": {
        "main": [
          [
            {
              "node": "Graph Rules",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Oakley": {
        "main": [
          [
            {
              "node": "Graph Oakley",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar North Face": {
        "main": [
          [
            {
              "node": "Graph North Face",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Surfin": {
        "main": [
          [
            {
              "node": "Graph Surfin",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Nuance": {
        "main": [
          [
            {
              "node": "Graph Nuance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Lodge": {
        "main": [
          [
            {
              "node": "Graph Lodge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualizar Melia": {
        "main": [
          [
            {
              "node": "Graph Melia",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crear Cliente en la Base de Datos1": {
        "main": [
          [
            {
              "node": "Crear Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Leerqr": {
        "main": [
          [
            {
              "node": "GraphQL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Select rows from a table": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "GraphQL1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Respond to Webhook1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GraphQL": {
        "main": [
          [
            {
              "node": "Select rows from a table",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GraphQL1": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Tailwind Media",
    "name": "Version 5d411736",
    "description": "",
    "autosaved": false
  },
  "activeVersionId": "5d411736-f00e-487d-9f26-1ca4b9753032",
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Si Usa Descuento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener datos cliente": {
      "main": [
        [
          {
            "node": "Limpiar Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpiar Datos": {
      "main": [
        [
          {
            "node": "Si no tiene los descuentos activos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Datos Supabase": {
      "main": [
        [
          {
            "node": "Si Está en la Base de Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si Usa Descuento": {
      "main": [
        [
          {
            "node": "Obtener Datos Supabase2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Si usa correo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si usa correo": {
      "main": [
        [
          {
            "node": "Obtener datos cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si no tiene los descuentos activos": {
      "main": [
        [
          {
            "node": "Obtener Datos Supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener Datos Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si Está en la Base de Datos": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crear Cliente en la Base de Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Datos Supabase1": {
      "main": [
        [
          {
            "node": "Si Está en la Base de Datos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si Está en la Base de Datos1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crear Cliente en la Base de Datos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Datos Supabase2": {
      "main": [
        [
          {
            "node": "Si Está en la Base de Datos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si Está en la Base de Datos2": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Actualizar Rules",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar Oakley",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar North Face",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar Surfin",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar Nuance",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar Lodge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar Melia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Cliente en la Base de Datos": {
      "main": [
        [
          {
            "node": "Crear Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Rules": {
      "main": [
        [
          {
            "node": "Graph Rules",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Oakley": {
      "main": [
        [
          {
            "node": "Graph Oakley",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar North Face": {
      "main": [
        [
          {
            "node": "Graph North Face",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Surfin": {
      "main": [
        [
          {
            "node": "Graph Surfin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Nuance": {
      "main": [
        [
          {
            "node": "Graph Nuance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Lodge": {
      "main": [
        [
          {
            "node": "Graph Lodge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Melia": {
      "main": [
        [
          {
            "node": "Graph Melia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Cliente en la Base de Datos1": {
      "main": [
        [
          {
            "node": "Crear Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Leerqr": {
      "main": [
        [
          {
            "node": "GraphQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "GraphQL1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GraphQL": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GraphQL1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-29T08:38:38.521Z",
  "id": "3EsLWbaigVn4UtgZ",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Cuenta_Cliente_Shopify",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "venta-descuento-10",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -256,
        -656
      ],
      "id": "c7a0c58a-8754-4239-9c22-da42447ffdbc",
      "name": "Webhook",
      "webhookId": "7bb61142-4257-48c7-b86e-f8751080012e"
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
        "query": "query getCustomerMetafields($customerId: ID!) {\n  customer(id: $customerId) {\n    id\n    firstName\n    lastName\n    email\n    phone\n    metafields(first: 10) {\n      edges {\n        node {\n          id\n          namespace\n          key\n          value\n          type\n        }\n      }\n    }\n  }\n}",
        "variables": "={\n  \"customerId\": \"{{ $json.body.customer.admin_graphql_api_id }}\"\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        432,
        -160
      ],
      "id": "29b8c95c-1feb-4b70-ae06-9788cb88b619",
      "name": "Obtener datos cliente",
      "credentials": {
        "httpHeaderAuth": {
          "id": "THkhgrtze1uBo6Ft",
          "name": "Token Informes Shopify"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const cleanData = [];\n\nfor (const item of $input.all()) {\n  const customer = item.json?.data?.customer;\n  if (!customer) continue;\n\n  const rawId = customer.id || \"\";\n  const extractedNumericId = rawId ? rawId.split('/').pop() : null;\n\n  const cleanItem = {\n    customerId: rawId || null,\n    numericId: extractedNumericId,\n    firstName: customer.firstName || \"\",\n    lastName: customer.lastName || \"\",\n    metafields: {},\n    hasDiscountOf10: false, // Empezamos asumiendo que es falso\n    totalAmount: null // Preparamos un espacio para el monto total\n  };\n\n  const edges = customer.metafields?.edges || [];\n  \n  for (const edge of edges) {\n    const node = edge?.node;\n    \n    if (node && node.key && node.value !== null && node.value !== undefined) {\n      \n      // Manejamos los descuentos (number_integer)\n      if (node.type === \"number_integer\") {\n        const discountValue = parseInt(node.value, 10);\n        cleanItem.metafields[node.key] = discountValue;\n        \n        // Si encontramos UN descuento que sea exactamente 10, lo marcamos como true\n        if (discountValue === 10) {\n          cleanItem.hasDiscountOf10 = true;\n        }\n      } \n      // Manejamos el nuevo campo de dinero (money)\n      else if (node.type === \"money\" && node.key === \"monto_total\") {\n        try {\n          const moneyData = JSON.parse(node.value);\n          cleanItem.totalAmount = parseFloat(moneyData.amount);\n        } catch (e) {\n          // Si el JSON falla, no rompemos el código\n          cleanItem.totalAmount = null; \n        }\n      }\n    }\n  }\n\n  cleanData.push({ json: cleanItem });\n}\n\nreturn cleanData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        -160
      ],
      "id": "a8ad481f-8078-4bcf-8e86-66d8899a3ada",
      "name": "Limpiar Datos"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "where": {
          "values": [
            {
              "column": "id_cliente",
              "value": "={{ $json.numericId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        976,
        -400
      ],
      "id": "d00ef68a-1776-4e68-afc6-1b99f546aa11",
      "name": "Obtener Datos Supabase",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        432,
        32
      ],
      "id": "f88d1129-33b8-4d5a-98f3-a3ef12a701d0",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "99d01e4c-a02f-4c7c-b184-ff08551b12ea",
              "leftValue": "={{ $json.body.discount_codes[0].code }}",
              "rightValue": "GRACIAS10",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -32,
        -656
      ],
      "id": "5d45aaa9-d5c7-4064-93b5-9b95d14dea03",
      "name": "Si Usa Descuento"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "99d01e4c-a02f-4c7c-b184-ff08551b12ea",
              "leftValue": "={{ $json.body.contact_email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        240,
        -64
      ],
      "id": "ee879842-3340-4ba0-adb6-b0507747f9d2",
      "name": "Si usa correo"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9de76f66-78f3-460b-a48b-2d9d75440555",
              "leftValue": "={{ $json.hasDiscountOf10 }}",
              "rightValue": "false",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        768,
        -160
      ],
      "id": "4da891d3-c1ee-4c1f-b192-c86087fdbe45",
      "name": "Si no tiene los descuentos activos"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "38def29d-b85b-4c27-822d-421036a309f2",
              "leftValue": "={{ $json.id_cliente }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1152,
        -400
      ],
      "id": "e43b75b1-5fd7-43fe-bb12-8cdf5cee9886",
      "name": "Si Está en la Base de Datos"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1360,
        -496
      ],
      "id": "b97951cf-bf32-481f-b1b0-9d920643013d",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cliente": "={{ $('Limpiar Datos').item.json.numericId }}",
            "sucursal_rules": 10,
            "sucursal_oakley": 10,
            "sucursal_thenorthface": 10,
            "sucursal_surfin": 10,
            "sucursal_nuance": 10,
            "sucursal_nuancelodge": 10,
            "sucursal_melia": 10,
            "correo": "={{ $('Obtener datos cliente').item.json.data.customer.email }}",
            "Nombre": "={{ $('Obtener datos cliente').item.json.data.customer.firstName }} {{ $('Obtener datos cliente').item.json.data.customer.lastName }}",
            "Teléfono": "={{ $('Obtener datos cliente').item.json.data.customer.phone }}"
          },
          "matchingColumns": [
            "id_cliente"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1360,
        -304
      ],
      "id": "0fe723f3-9430-4710-a3f1-0862ad5039c4",
      "name": "Crear Cliente en la Base de Datos",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "where": {
          "values": [
            {
              "column": "id_cliente",
              "value": "={{ $json.numericId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        976,
        96
      ],
      "id": "7350b2f2-99fc-460c-9e53-239d60f226e1",
      "name": "Obtener Datos Supabase1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "38def29d-b85b-4c27-822d-421036a309f2",
              "leftValue": "={{ $json.id_cliente }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1152,
        96
      ],
      "id": "f6eb175f-a4a1-4add-b7c8-3ebe7028e726",
      "name": "Si Está en la Base de Datos1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1360,
        0
      ],
      "id": "f4fcad3f-882d-450c-bcb3-91844eca2516",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cliente": "={{ $('Limpiar Datos').item.json.numericId }}",
            "sucursal_rules": 10,
            "sucursal_oakley": 10,
            "sucursal_thenorthface": 10,
            "sucursal_surfin": 10,
            "sucursal_nuance": 10,
            "sucursal_nuancelodge": 10,
            "sucursal_melia": 10,
            "Nombre": "={{ $('Obtener datos cliente').item.json.data.customer.firstName }} {{ $('Obtener datos cliente').item.json.data.customer.lastName }}",
            "correo": "={{ $('Obtener datos cliente').item.json.data.customer.email }}",
            "Teléfono": "={{ $('Obtener datos cliente').item.json.data.customer.phone }}"
          },
          "matchingColumns": [
            "id_cliente"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": false
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1360,
        192
      ],
      "id": "52472a3c-c7de-4ade-b1bc-d562e82f6810",
      "name": "Crear Cliente en la Base de Datos1",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "where": {
          "values": [
            {
              "column": "correo",
              "value": "={{ $json.body.contact_email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        208,
        -1104
      ],
      "id": "ce745342-7c3c-4cef-8db3-9981c1069c22",
      "name": "Obtener Datos Supabase2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "38def29d-b85b-4c27-822d-421036a309f2",
              "leftValue": "={{ $json.id_cliente }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        416,
        -1104
      ],
      "id": "ef142d16-3fee-4d20-8d9b-b699edb1445e",
      "name": "Si Está en la Base de Datos2"
    },
    {
      "parameters": {
        "sendTo": "emiliano@tailwind.es",
        "subject": "ERROR EN LA BASE DE DATOS DE SUPABASE",
        "message": "=Se ha producido una situación imposible, el cliente {{ $('Webhook').item.json.body.customer.first_name || \"Nombre\"}} {{ $('Webhook').item.json.body.customer.last_name }} ha utilizado el código de descuento de la promoción (10%) pero no está en la base de datos.",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        592,
        -880
      ],
      "id": "8e84baa3-9b4c-4777-8ad5-82f7c02f4246",
      "name": "Send a message",
      "webhookId": "5e37c03c-e87e-4feb-98dd-d5a7fd89c8ce",
      "credentials": {
        "gmailOAuth2": {
          "id": "wR7U82S8bmDH4odC",
          "name": "info@tailwind.es"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 99759620443,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "f7bd3a7d-d6a7-4e37-9340-9a9ac7b605f1"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "a12b5903-dd55-4cea-a0ff-9607f476687f",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 99018441051,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "827ce9e5-d118-4026-b8f9-c7c0cd2c73fb",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 108915917147,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "62e9eed5-3337-49ac-a6cb-9de8c99cc989",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 108790317403,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6194b202-f053-444c-a009-724559da04c3",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 108916146523,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7a9fecf7-5d91-441e-8fc1-4d8352810087",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 108916244827,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8542fd23-7401-44b4-b227-85d81ae7b43d",
                    "leftValue": "={{ $('Webhook').item.json.body.location_id }}",
                    "rightValue": 110334542171,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        592,
        -1200
      ],
      "id": "17702954-7e6e-4700-9b63-26f121b5bc7c",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_rules": 0,
            "pedido_rules": "={{ $('Webhook').item.json.body.id }}",
            "correo": "={{ $json.correo }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -1552
      ],
      "id": "702019b7-b389-46f0-963d-923a278efcaa",
      "name": "Actualizar Rules",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_oakley": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_oakley": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -1408
      ],
      "id": "5af642bf-a804-4d61-b7e0-4f977001f358",
      "name": "Actualizar Oakley",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_thenorthface": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_thenorthface": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -1264
      ],
      "id": "48414727-d4cc-46a3-9a7a-0379c1397e7f",
      "name": "Actualizar North Face",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_surfin": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_surfin": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -1120
      ],
      "id": "d31eb78d-0c84-4428-939e-350a1d512f82",
      "name": "Actualizar Surfin",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_nuance": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_nuance": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -976
      ],
      "id": "12f13519-82d7-46d5-8ab1-1d4b1e0fa73f",
      "name": "Actualizar Nuance",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_nuancelodge": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_nuancelodge": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -832
      ],
      "id": "0587274a-3836-4777-8f64-8a49be7ac4c2",
      "name": "Actualizar Lodge",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sucursal_melia": 0,
            "correo": "={{ $json.body.contact_email }}",
            "pedido_melia": "={{ $('Webhook').item.json.body.id }}"
          },
          "matchingColumns": [
            "correo"
          ],
          "schema": [
            {
              "id": "correo",
              "displayName": "correo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal_rules",
              "displayName": "sucursal_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_oakley",
              "displayName": "sucursal_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_thenorthface",
              "displayName": "sucursal_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_surfin",
              "displayName": "sucursal_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuance",
              "displayName": "sucursal_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_nuancelodge",
              "displayName": "sucursal_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_melia",
              "displayName": "sucursal_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_cliente",
              "displayName": "id_cliente",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_rules",
              "displayName": "pedido_rules",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_oakley",
              "displayName": "pedido_oakley",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_thenorthface",
              "displayName": "pedido_thenorthface",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_surfin",
              "displayName": "pedido_surfin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuance",
              "displayName": "pedido_nuance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_nuancelodge",
              "displayName": "pedido_nuancelodge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pedido_melia",
              "displayName": "pedido_melia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        864,
        -688
      ],
      "id": "10669ced-64d0-43dc-b86e-75bcf772e087",
      "name": "Actualizar Melia",
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2026-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_rules\",\n      \"value\": \"{{ $json.sucursal_rules }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_oakley\",\n      \"value\": \"{{ $json.sucursal_oakley }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_thenorthface\",\n      \"value\": \"{{ $json.sucursal_thenorthface }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_surfin\",\n      \"value\": \"{{ $json.sucursal_surfin }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuance\",\n      \"value\": \"{{ $json.sucursal_nuance }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuancelodge\",\n      \"value\": \"{{ $json.sucursal_nuancelodge }}\",\n      \"type\": \"number_integer\"\n    },\n    {\n      \"ownerId\": \"gid://shopify/Customer/{{ $json.id_cliente }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_melia\",\n      \"value\": \"{{ $json.sucursal_melia }}\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1648,
        -64
      ],
      "id": "bf5b2cb5-4c02-4957-b2ef-22301a1be761",
      "name": "Crear Cliente",
      "credentials": {
        "httpHeaderAuth": {
          "id": "THkhgrtze1uBo6Ft",
          "name": "Token Informes Shopify"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_rules\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -1552
      ],
      "id": "ea9d5966-051b-42e8-93b3-70a8a4eb8f55",
      "name": "Graph Rules",
      "credentials": {
        "httpHeaderAuth": {
          "id": "THkhgrtze1uBo6Ft",
          "name": "Token Informes Shopify"
        }
      }
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_oakley\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -1408
      ],
      "id": "773e824e-cfb8-4e2d-bff6-8c485924904c",
      "name": "Graph Oakley"
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_thenorthface\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -1264
      ],
      "id": "7d197ec2-e509-4ee9-9ae2-4cac17408065",
      "name": "Graph North Face"
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_surfin\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -1120
      ],
      "id": "46e7165f-39ec-4860-be56-da244eed5c78",
      "name": "Graph Surfin"
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuance\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -976
      ],
      "id": "9e13b40f-4bc4-4b2c-ad94-d15a6a5a93d4",
      "name": "Graph Nuance"
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_nuancelodge\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -832
      ],
      "id": "15e3e8f9-de34-4aae-8eeb-53d56c6072e7",
      "name": "Graph Lodge"
    },
    {
      "parameters": {
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "mutation metafieldsSet($metafields: [MetafieldsSetInput!]!) {\n  metafieldsSet(metafields: $metafields) {\n    metafields {\n      id\n      namespace\n      key\n      value\n      type\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}",
        "variables": "={\n  \"metafields\": [\n    {\n      \"ownerId\": \"{{ $('Webhook').item.json.body.customer.admin_graphql_api_id }}\",\n      \"namespace\": \"custom\",\n      \"key\": \"descuento_melia\",\n      \"value\": \"0\",\n      \"type\": \"number_integer\"\n    }\n  ]\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        1056,
        -688
      ],
      "id": "e7a454c0-112c-4cbc-a2d5-72071acdf555",
      "name": "Graph Melia"
    },
    {
      "parameters": {
        "path": "leerqr",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2512,
        -752
      ],
      "id": "50d47124-56fb-448c-95b1-1aff6feb6b2f",
      "name": "Leerqr",
      "webhookId": "b9dc3bb5-70bc-4d91-b08a-192f8a1bf4eb"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Tus Descuentos</title>\n  <style>\n    body { \n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n      padding: 20px; \n      max-width: 1000px; \n      margin: 0 auto; \n      color: #333;\n      background-color: #fcfcfc;\n    }\n    .main-header { text-align: center; margin-bottom: 40px; }\n    h2 { color: #000; margin-bottom: 5px; font-size: 2rem; }\n    p { color: #555; }\n    \n    /* Layout de dos columnas */\n    .container {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 40px;\n    }\n    .column {\n      flex: 1;\n      min-width: 320px;\n      background: #fff;\n      padding: 25px;\n      border-radius: 12px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n    }\n    .section-title {\n      margin-top: 0;\n      padding-bottom: 10px;\n      border-bottom: 2px solid #eee;\n      font-size: 1.3rem;\n      color: #000;\n    }\n\n    table { \n      width: 100%; \n      border-collapse: collapse; \n      margin-top: 15px; \n      border-radius: 8px;\n      overflow: hidden;\n      border: 1px solid #f0f0f0;\n    }\n    th, td { \n      padding: 12px 15px; \n      text-align: left; \n      border-bottom: 1px solid #f0f0f0; \n      vertical-align: middle;\n      font-size: 14px;\n    }\n    th { \n      background-color: #f8f9fa; \n      font-weight: 600; \n      color: #333;\n    }\n    tr:last-child td { border-bottom: none; }\n    \n    .discount-badge { \n      background-color: #000; \n      color: #fff; \n      padding: 4px 10px; \n      border-radius: 20px; \n      font-weight: bold; \n      font-size: 13px;\n    }\n    .no-data { text-align: center; padding: 30px; color: #666; background: #f9f9f9; border-radius: 8px; font-size: 14px;}\n    \n    .map-btn {\n      display: inline-block;\n      background-color: #f4f6f8;\n      color: #333;\n      padding: 6px 12px;\n      border-radius: 6px;\n      text-decoration: none;\n      font-size: 12px;\n      font-weight: 600;\n      border: 1px solid #ddd;\n      transition: all 0.2s;\n    }\n    .map-btn:hover { background-color: #e2e6ea; color: #000; border-color: #ccc; }\n\n    /* Estilos específicos compras e imágenes */\n    .sucursal-name {\n      margin-top: 25px;\n      margin-bottom: 5px;\n      font-size: 1.1rem;\n      color: #222;\n    }\n    .price-original { text-decoration: line-through; color: #999; font-size: 0.9em; }\n    .price-discount { color: #27ae60; font-weight: bold; font-size: 1.1em; }\n    .savings-text { display: block; font-size: 0.8em; color: #27ae60; margin-top: 2px; }\n    \n    .product-cell {\n      display: flex;\n      align-items: center;\n      gap: 15px;\n    }\n    .product-img {\n      width: 45px;\n      height: 45px;\n      object-fit: cover;\n      border-radius: 6px;\n      border: 1px solid #eaeaea;\n      background-color: #fff;\n    }\n\n    /* NUEVO ESTILO: Nota legal al pie de página */\n    .footer-note {\n      text-align: center;\n      margin-top: 50px;\n      padding-top: 20px;\n      font-size: 12px;\n      color: #888;\n      border-top: 1px solid #eaeaea;\n    }\n  </style>\n</head>\n<body>\n\n  {{ \n    (() => {\n      const supabaseData = $node[\"If\"].json; \n      \n      if (!supabaseData) {\n        return `\n          <div class=\"main-header\"><h2>¡Hola!</h2></div>\n          <div class=\"no-data\"><p>No hemos encontrado tu perfil o hubo un error al leer el QR.</p></div>\n        `;\n      }\n\n      const sucursales = [\n        { key: 'sucursal_rules', orderKey: 'pedido_rules', name: 'Rules Outlet', url: 'https://maps.app.goo.gl/2zcHYJzYi4mku9Bw5' },\n        { key: 'sucursal_oakley', orderKey: 'pedido_oakley', name: 'Rules Oakley', url: 'https://maps.app.goo.gl/T81E6eXNTRWc86nj9' },\n        { key: 'sucursal_thenorthface', orderKey: 'pedido_thenorthface', name: 'Rules The North Face', url: 'https://maps.app.goo.gl/T81E6eXNTRWc86nj9' },\n        { key: 'sucursal_surfin', orderKey: 'pedido_surfin', name: 'Surfin', url: 'https://maps.app.goo.gl/18GNbRyLLukuo4m57' },\n        { key: 'sucursal_nuance', orderKey: 'pedido_nuance', name: 'Nuance', url: 'https://maps.app.goo.gl/Farx9QjYyZX294pe7' },\n        { key: 'sucursal_nuancelodge', orderKey: 'pedido_nuancelodge', name: 'Nuance Lodge', url: 'https://maps.app.goo.gl/ND7hyiUQMVSpJ2G96' },\n        { key: 'sucursal_melia', orderKey: 'pedido_melia', name: 'Meliá Sierra Nevada', url: 'https://maps.app.goo.gl/Cf146WRdUBgxN8KT8' }\n      ];\n\n      // --- COLUMNA IZQUIERDA ---\n      const descuentosActivos = sucursales.filter(s => parseInt(supabaseData[s.key] || 0) > 0);\n      \n      let leftColumn = '<div class=\"column\"><h3 class=\"section-title\">Tus descuentos activos</h3>';\n      if (descuentosActivos.length === 0) {\n        leftColumn += '<div class=\"no-data\"><p>Actualmente no tienes descuentos activos. ¡Sigue comprando para acumular más!</p></div>';\n      } else {\n        leftColumn += '<table><thead><tr><th>Sucursal</th><th>Descuento</th><th>Ubicación</th></tr></thead><tbody>';\n        descuentosActivos.forEach(s => {\n          leftColumn += `\n            <tr>\n              <td><strong>${s.name}</strong></td>\n              <td><span class=\"discount-badge\">${supabaseData[s.key]}%</span></td>\n              <td><a href=\"${s.url}\" target=\"_top\" rel=\"noopener noreferrer\" class=\"map-btn\">📍 Ver mapa</a></td>\n            </tr>\n          `;\n        });\n        leftColumn += '</tbody></table>';\n      }\n      leftColumn += '</div>';\n\n      // --- COLUMNA DERECHA ---\n      let rightColumn = '<div class=\"column\"><h3 class=\"section-title\">Descuentos utilizados</h3>';\n      let hasUsedDiscounts = false;\n\n      try {\n        const orders = $node[\"GraphQL1\"].json.data.nodes;\n        \n        if (orders && orders.length > 0) {\n          \n          const orderToSucursal = {};\n          sucursales.forEach(s => {\n            if (supabaseData[s.orderKey]) {\n               orderToSucursal[\"gid://shopify/Order/\" + supabaseData[s.orderKey]] = s.name;\n            }\n          });\n\n          orders.forEach(order => {\n            if (!order) return; \n            \n            const sucursalName = orderToSucursal[order.id] || 'Tienda';\n            const items = order.lineItems.edges;\n\n            if (items.length > 0) {\n              hasUsedDiscounts = true;\n              rightColumn += `\n                <h4 class=\"sucursal-name\">${sucursalName} <span style=\"font-size:12px; color:#888; font-weight:normal;\">(${order.name})</span></h4>\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Producto</th>\n                      <th>Precio Original</th>\n                      <th>Tu Precio</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n              `;\n\n              items.forEach(item => {\n                const node = item.node;\n                const originalPrice = parseFloat(node.originalTotalSet.shopMoney.amount);\n                const discountedPrice = parseFloat(node.discountedTotalSet.shopMoney.amount);\n                const savings = (originalPrice - discountedPrice).toFixed(2);\n\n                const imageUrl = node.image && node.image.url ? node.image.url : 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\n\n                let originalHtml = '-';\n                let savingsHtml = '';\n                \n                if (originalPrice > discountedPrice) {\n                   originalHtml = `<span class=\"price-original\">${originalPrice.toFixed(2)}€</span>`;\n                   savingsHtml = `<span class=\"savings-text\">Ahorraste ${savings}€</span>`;\n                }\n\n                rightColumn += `\n                  <tr>\n                    <td>\n                      <div class=\"product-cell\">\n                        <img src=\"${imageUrl}\" alt=\"${node.title}\" class=\"product-img\" onerror=\"this.style.display='none'\">\n                        <div>\n                          <strong>${node.title}</strong><br>\n                          <span style=\"font-size: 0.85em; color: #666;\">Cant: ${node.quantity}</span>\n                        </div>\n                      </div>\n                    </td>\n                    <td>${originalHtml}</td>\n                    <td>\n                      <span class=\"price-discount\">${discountedPrice.toFixed(2)}€</span>\n                      ${savingsHtml}\n                    </td>\n                  </tr>\n                `;\n              });\n              rightColumn += `</tbody></table>`;\n            }\n          });\n        }\n      } catch (error) {\n        console.log(\"Error leyendo pedidos GraphQL: \", error);\n      }\n\n      if (!hasUsedDiscounts) {\n         rightColumn += '<div class=\"no-data\" style=\"margin-top:15px;\"><p>Aún no has utilizado ningún descuento en tus compras.</p></div>';\n      }\n      \n      rightColumn += '</div>';\n\n      // --- UNIMOS TODO (Aquí he añadido la clase .footer-note al final) ---\n      const finalHtml = `\n        <div class=\"main-header\">\n          <h2>¡Hola, ${supabaseData.Nombre || 'Cliente'}!</h2>\n          <p>Bienvenido a tu área personal.</p>\n        </div>\n        <div class=\"container\">\n          ${leftColumn}\n          ${rightColumn}\n        </div>\n        <p class=\"footer-note\">El descuento solo se aplicará a artículos que no tengan descuento de antemano.</p>\n      `;\n\n      return finalHtml;\n    })()\n  }}\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        3632,
        -848
      ],
      "id": "ba3dd16e-f146-4321-8ca0-9d6e1903c0d4",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "Descuentos_Omnicanal",
          "mode": "list",
          "cachedResultName": "Descuentos_Omnicanal"
        },
        "where": {
          "values": [
            {
              "column": "id_cliente",
              "value": "={{ $json.data.order.customer.id.split('/').pop() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2928,
        -752
      ],
      "id": "854c91f8-93f3-46f5-a1de-ec03fa9b4a3e",
      "name": "Select rows from a table",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "UPETCYNZNCReuZu8",
          "name": "Postgres Supabase"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f21ae0da-a295-4cd1-8995-371cea53875c",
              "leftValue": "={{ $json.correo }}",
              "rightValue": "={{ $('Leerqr').item.json.query.cliente_id }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        3184,
        -752
      ],
      "id": "ceec1aba-9719-4440-b3ec-a563293b9876",
      "name": "If"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Tus Descuentos</title>\n  <style>\n    body { \n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n      padding: 20px; \n      max-width: 500px; \n      margin: 0 auto; \n      color: #333;\n    }\n    .header { text-align: center; margin-bottom: 30px; }\n    h2 { color: #000; margin-bottom: 5px; }\n    p { color: #555; }\n    .no-data { \n      text-align: center; \n      padding: 30px; \n      color: #666; \n      background: #f9f9f9; \n      border-radius: 8px; \n      line-height: 1.5;\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"header\">\n    <h2>¡Hola!</h2>\n  </div>\n  \n  <div class=\"no-data\">\n    <p><strong>No tienes cuenta de cliente.</strong></p>\n    <p>Puedes crearla haciendo una compra en una de nuestras sucursales y facilitando tu correo electrónico al empleado.</p>\n  </div>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        3392,
        -656
      ],
      "id": "f38e9265-197e-4c46-9dff-bcc9cd8b5d68",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "query getOrder($orderId: ID!) {\n  order(id: $orderId) {\n    name\n    email\n    customer {\n      id\n      email\n    }\n  }\n}",
        "variables": "={\n  \"orderId\": \"gid://shopify/Order/{{ $json.query.shop_id }}\"\n}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        2720,
        -752
      ],
      "id": "df362df3-7061-458d-9633-a1eb66b89be1",
      "name": "GraphQL",
      "credentials": {
        "httpHeaderAuth": {
          "id": "OPt2Cl0dnwcU4qRk",
          "name": "ShopifyInformes"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://rulesshop.myshopify.com/admin/api/2024-01/graphql.json",
        "query": "query getMultipleOrders($orderIds: [ID!]!) {\n  nodes(ids: $orderIds) {\n    ... on Order {\n      id\n      name\n      lineItems(first: 10) {\n        edges {\n          node {\n            title\n            quantity\n            image {\n              url\n            }\n            originalTotalSet { shopMoney { amount } }\n            discountedTotalSet { shopMoney { amount } }\n          }\n        }\n      }\n    }\n  }\n}",
        "variables": "={{\n  {\n    \"orderIds\": [\n      $json.pedido_rules,\n      $json.pedido_oakley,\n      $json.pedido_thenorthface,\n      $json.pedido_surfin,\n      $json.pedido_nuance,\n      $json.pedido_nuancelodge,\n      $json.pedido_melia\n    ].filter(id => id != null && id != \"\").map(id => \"gid://shopify/Order/\" + id)\n  }\n}}"
      },
      "type": "n8n-nodes-base.graphql",
      "typeVersion": 1.1,
      "position": [
        3392,
        -848
      ],
      "id": "8f06d485-00b0-4ce8-9588-856fc96b7742",
      "name": "GraphQL1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "THkhgrtze1uBo6Ft",
          "name": "Token Informes Shopify"
        }
      }
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "connection": "upgrade",
            "host": "n8n.tailwind.es",
            "x-forwarded-for": "34.77.148.162",
            "x-forwarded-proto": "https",
            "content-length": "7969",
            "user-agent": "Shopify-Captain-Hook",
            "accept": "*/*",
            "accept-encoding": "gzip;q=1.0,deflate;q=0.6,identity;q=0.3",
            "content-type": "application/json",
            "x-shopify-api-version": "2026-01",
            "x-shopify-event-id": "3cc78615-4dab-4163-ba5b-75c9524ce963",
            "x-shopify-hmac-sha256": "2qp22RtCUFon/orHi0hLZrKFegPOTmOpVhUnc1Z1ntY=",
            "x-shopify-order-id": "7732659847515",
            "x-shopify-shop-domain": "surfin-store-spain.myshopify.com",
            "x-shopify-test": "false",
            "x-shopify-topic": "orders/create",
            "x-shopify-triggered-at": "2026-02-26T12:08:08.638675224Z",
            "x-shopify-webhook-id": "89e27a0a-83ae-52c8-8520-4bb7a317aa9a"
          },
          "params": {},
          "query": {},
          "body": {
            "id": 7732659847515,
            "admin_graphql_api_id": "gid://shopify/Order/7732659847515",
            "app_id": 129785,
            "browser_ip": "2.136.43.122",
            "buyer_accepts_marketing": false,
            "cancel_reason": null,
            "cancelled_at": null,
            "cart_token": null,
            "checkout_id": 48447535579483,
            "checkout_token": "45330b36-f1b2-4214-a4aa-7870a4b640e0",
            "client_details": {
              "accept_language": null,
              "browser_height": null,
              "browser_ip": "2.136.43.122",
              "browser_width": null,
              "session_hash": null,
              "user_agent": "Shopify POS/11.0.1/Android/16/samsung/SM-X626B/production"
            },
            "closed_at": "2026-02-26T13:08:08+01:00",
            "company": null,
            "confirmation_number": "FJ65PER5J",
            "confirmed": true,
            "contact_email": "prueba@prueba.com",
            "created_at": "2026-02-26T13:08:07+01:00",
            "currency": "EUR",
            "current_shipping_price_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "current_subtotal_price": "11.61",
            "current_subtotal_price_set": {
              "shop_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              }
            },
            "current_total_additional_fees_set": null,
            "current_total_discounts": "1.29",
            "current_total_discounts_set": {
              "shop_money": {
                "amount": "1.29",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "1.29",
                "currency_code": "EUR"
              }
            },
            "current_total_duties_set": null,
            "current_total_price": "11.61",
            "current_total_price_set": {
              "shop_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              }
            },
            "current_total_tax": "0.00",
            "current_total_tax_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "customer_locale": "es",
            "device_id": 2,
            "discount_codes": [
              {
                "code": "GRACIAS10",
                "amount": "1.29",
                "type": "percentage"
              }
            ],
            "duties_included": false,
            "email": "prueba@prueba.com",
            "estimated_taxes": false,
            "financial_status": "paid",
            "fulfillment_status": "fulfilled",
            "landing_site": null,
            "landing_site_ref": null,
            "location_id": 99759620443,
            "merchant_business_entity_id": "MTg3OTg3NjUwOTA3",
            "merchant_of_record_app_id": null,
            "name": "#73222",
            "note": null,
            "note_attributes": [],
            "number": 72222,
            "order_number": 73222,
            "order_status_url": "https://nuance-store.com/87987650907/orders/f33f7e6c4e3d5949ed9d38f4e16062ba/authenticate?key=94080182b32a87029290dac282fb6c58",
            "original_total_additional_fees_set": null,
            "original_total_duties_set": null,
            "payment_gateway_names": [
              "Venta Web"
            ],
            "phone": "+34666555666",
            "po_number": null,
            "presentment_currency": "EUR",
            "processed_at": "2026-02-26T13:08:06+01:00",
            "reference": null,
            "referring_site": null,
            "source_identifier": "99759620443-2-2304",
            "source_name": "pos",
            "source_url": null,
            "subtotal_price": "11.61",
            "subtotal_price_set": {
              "shop_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              }
            },
            "tags": "",
            "tax_exempt": false,
            "tax_lines": [],
            "taxes_included": true,
            "test": false,
            "token": "f33f7e6c4e3d5949ed9d38f4e16062ba",
            "total_cash_rounding_payment_adjustment_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "total_cash_rounding_refund_adjustment_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "total_discounts": "1.29",
            "total_discounts_set": {
              "shop_money": {
                "amount": "1.29",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "1.29",
                "currency_code": "EUR"
              }
            },
            "total_line_items_price": "12.90",
            "total_line_items_price_set": {
              "shop_money": {
                "amount": "12.90",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "12.90",
                "currency_code": "EUR"
              }
            },
            "total_outstanding": "0.00",
            "total_price": "11.61",
            "total_price_set": {
              "shop_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "11.61",
                "currency_code": "EUR"
              }
            },
            "total_shipping_price_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "total_tax": "0.00",
            "total_tax_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "EUR"
              }
            },
            "total_tip_received": "0.00",
            "total_weight": 0,
            "updated_at": "2026-02-26T13:08:08+01:00",
            "user_id": 127472533851,
            "billing_address": null,
            "customer": {
              "id": 9488191390043,
              "created_at": "2025-08-19T13:00:56+02:00",
              "updated_at": "2026-02-26T13:08:08+01:00",
              "first_name": "aaa",
              "last_name": "aaa",
              "state": "enabled",
              "note": "",
              "verified_email": true,
              "multipass_identifier": null,
              "tax_exempt": false,
              "email": "prueba@prueba.com",
              "phone": "+34666555666",
              "currency": "EUR",
              "tax_exemptions": [],
              "admin_graphql_api_id": "gid://shopify/Customer/9488191390043",
              "default_address": {
                "id": 12959882903899,
                "customer_id": 9488191390043,
                "first_name": "aaa",
                "last_name": "aaa",
                "company": "",
                "address1": "Calle Ruiz, 7\nCalle Ruiz, 7",
                "address2": "",
                "city": "Madrid",
                "province": "Murcia",
                "country": "Spain",
                "zip": "28004",
                "phone": "666555666",
                "name": "aaa aaa",
                "province_code": "MU",
                "country_code": "ES",
                "country_name": "Spain",
                "default": true
              }
            },
            "discount_applications": [
              {
                "target_type": "line_item",
                "type": "discount_code",
                "value": "10.0",
                "value_type": "percentage",
                "allocation_method": "across",
                "target_selection": "all",
                "code": "GRACIAS10"
              }
            ],
            "fulfillments": [
              {
                "id": 6767128183131,
                "admin_graphql_api_id": "gid://shopify/Fulfillment/6767128183131",
                "created_at": "2026-02-26T13:08:08+01:00",
                "location_id": 99759620443,
                "name": "#73222.1",
                "order_id": 7732659847515,
                "origin_address": {},
                "receipt": {},
                "service": "manual",
                "shipment_status": null,
                "status": "success",
                "tracking_company": null,
                "tracking_number": null,
                "tracking_numbers": [],
                "tracking_url": null,
                "tracking_urls": [],
                "updated_at": "2026-02-26T13:08:08+01:00",
                "line_items": [
                  {
                    "id": 18577214636379,
                    "admin_graphql_api_id": "gid://shopify/LineItem/18577214636379",
                    "attributed_staffs": [],
                    "current_quantity": 1,
                    "fulfillable_quantity": 0,
                    "fulfillment_service": "manual",
                    "fulfillment_status": "fulfilled",
                    "gift_card": false,
                    "grams": 0,
                    "name": "Reell Trunks Boxer - Olive / S",
                    "price": "12.90",
                    "price_set": {
                      "shop_money": {
                        "amount": "12.90",
                        "currency_code": "EUR"
                      },
                      "presentment_money": {
                        "amount": "12.90",
                        "currency_code": "EUR"
                      }
                    },
                    "product_exists": true,
                    "product_id": 10054401425755,
                    "properties": [],
                    "quantity": 1,
                    "requires_shipping": true,
                    "sku": "2100000264957",
                    "taxable": true,
                    "title": "Reell Trunks Boxer",
                    "total_discount": "0.00",
                    "total_discount_set": {
                      "shop_money": {
                        "amount": "0.00",
                        "currency_code": "EUR"
                      },
                      "presentment_money": {
                        "amount": "0.00",
                        "currency_code": "EUR"
                      }
                    },
                    "variant_id": 51185481122139,
                    "variant_inventory_management": "shopify",
                    "variant_title": "Olive / S",
                    "vendor": "Reell",
                    "tax_lines": [],
                    "duties": [],
                    "discount_allocations": [
                      {
                        "amount": "1.29",
                        "amount_set": {
                          "shop_money": {
                            "amount": "1.29",
                            "currency_code": "EUR"
                          },
                          "presentment_money": {
                            "amount": "1.29",
                            "currency_code": "EUR"
                          }
                        },
                        "discount_application_index": 0
                      }
                    ]
                  }
                ]
              }
            ],
            "line_items": [
              {
                "id": 18577214636379,
                "admin_graphql_api_id": "gid://shopify/LineItem/18577214636379",
                "attributed_staffs": [],
                "current_quantity": 1,
                "fulfillable_quantity": 0,
                "fulfillment_service": "manual",
                "fulfillment_status": "fulfilled",
                "gift_card": false,
                "grams": 0,
                "name": "Reell Trunks Boxer - Olive / S",
                "price": "12.90",
                "price_set": {
                  "shop_money": {
                    "amount": "12.90",
                    "currency_code": "EUR"
                  },
                  "presentment_money": {
                    "amount": "12.90",
                    "currency_code": "EUR"
                  }
                },
                "product_exists": true,
                "product_id": 10054401425755,
                "properties": [],
                "quantity": 1,
                "requires_shipping": true,
                "sales_line_item_group_id": null,
                "sku": "2100000264957",
                "taxable": true,
                "title": "Reell Trunks Boxer",
                "total_discount": "0.00",
                "total_discount_set": {
                  "shop_money": {
                    "amount": "0.00",
                    "currency_code": "EUR"
                  },
                  "presentment_money": {
                    "amount": "0.00",
                    "currency_code": "EUR"
                  }
                },
                "variant_id": 51185481122139,
                "variant_inventory_management": "shopify",
                "variant_title": "Olive / S",
                "vendor": "Reell",
                "tax_lines": [],
                "duties": [],
                "discount_allocations": [
                  {
                    "amount": "1.29",
                    "amount_set": {
                      "shop_money": {
                        "amount": "1.29",
                        "currency_code": "EUR"
                      },
                      "presentment_money": {
                        "amount": "1.29",
                        "currency_code": "EUR"
                      }
                    },
                    "discount_application_index": 0
                  }
                ]
              }
            ],
            "payment_terms": null,
            "refunds": [],
            "shipping_address": null,
            "shipping_lines": [],
            "returns": [],
            "line_item_groups": []
          },
          "webhookUrl": "https://n8n.tailwind.es/webhook/venta-descuento-10",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Leerqr": [
      {
        "json": {
          "headers": {
            "connection": "upgrade",
            "host": "n8n.tailwind.es",
            "x-forwarded-for": "2.136.43.122",
            "x-forwarded-proto": "https",
            "sec-ch-ua": "\"Not(A:Brand\";v=\"8\", \"Chromium\";v=\"144\", \"Brave\";v=\"144\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "upgrade-insecure-requests": "1",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
            "sec-gpc": "1",
            "accept-language": "es-ES,es;q=0.8",
            "sec-fetch-site": "same-site",
            "sec-fetch-mode": "navigate",
            "sec-fetch-dest": "iframe",
            "referer": "https://clientarea.tailwind.es/",
            "accept-encoding": "gzip, deflate, br, zstd",
            "cookie": "rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BV9ocwrf5sZKAZ84sclnSKoaVf7etXsrg%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2B6nug6a8u7blNBcZ1adVwerK%2FtQl6fPIc%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BVIG36b5XIv7js8b1cK5QssjHuy5qwkFIhvwII1uEdkB1dWxRSuSzWhzTYIW%2BPs%2FgMy%2Fa22%2FkaKA%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2BQ5%2Bl8vPX4zCSsZK5MtgVOTH0POe4SGhLqLVoNgr0JIfRSlAR%2Fi%2FKDhtBW1z5T4BULeO8ZP6tvLg3EJhJAb5RJkp1%2FfFUiMr%2BsuRo8ijabdJ9rVicf5Mr3dGvUgb%2FMlW3TyvjSbrl3EnbCRAt3A4gARr8z8ONjxs0%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX1%2BRCieWPTOD5vn8ogQKH4ibSpJcnUYHUn0eqOzfYpvWhTs4ayj5T%2FVWyD5MRqhP51X0oPXrfGNytbF9TJpVj9RdmnZkSnnKbJzor51TpIEaYSuZPr5cCUSU7Y%2Bv%2BmyjCLJ97XAgwhWe1CY4dFgWqhurdgclssF%2FY48%3D; rl_session=RudderEncrypt%3AU2FsdGVkX1%2B1o3fObVIMFgQPEnVUTTRGQaVTJ9vIdDNjsUQNzgx4T8nk3I6Efx2f29sbjBEqbHd73Z7YmtWPLcBMtxrz9q86nyh3T38ERVOA7Ifxvibu6Dnx0ElDNmiWuypqMUagp9V2TePICrgjtw%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22%24device_id%22%3A%22019c6590-a8c0-7936-9706-9d6324646ac4%22%2C%22distinct_id%22%3A%220f6825be298b3a005d52154ed2c929ac7758de54b6ab4a8d7eb7a8e83f623918%2308853e58-b9e7-4eaa-a226-f2a3e30187ec%22%2C%22%24sesid%22%3A%5B1772110215810%2C%22019c99ce-beeb-762c-9cd7-7b9fa814e621%22%2C1772106989291%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fn8n.tailwind.es%2F%22%7D%2C%22%24user_state%22%3A%22identified%22%7D",
            "if-none-match": "W/\"f98-1WxCZvkt4HgxbDl0j07p9cKWW00\""
          },
          "params": {},
          "query": {
            "cliente_id": "prueba@prueba.com",
            "shop_id": "7732477854043"
          },
          "body": {},
          "webhookUrl": "https://n8n.tailwind.es/webhook/leerqr",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "e80tfOpD4TdBh8EF"
  },
  "shared": [
    {
      "updatedAt": "2025-11-29T08:38:38.527Z",
      "createdAt": "2025-11-29T08:38:38.527Z",
      "role": "workflow:owner",
      "workflowId": "3EsLWbaigVn4UtgZ",
      "projectId": "x5UZcmGQw2OWHuXb"
    }
  ],
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2026-02-26T14:42:37.773Z",
  "versionId": "5d411736-f00e-487d-9f26-1ca4b9753032"
}